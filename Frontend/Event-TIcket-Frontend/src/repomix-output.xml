This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
api/
  endpoints/
    analytics.ts
    auth.ts
    events.ts
    organiser.ts
    publishedEvents.ts
    roles.ts
    staff.ts
    tickets.ts
  client.ts
components/
  common/
    Badge.tsx
    Button.tsx
    Card.tsx
    Input.tsx
    ProfileDropdown.tsx
    PromoteToOrganiserButton.tsx
    RoleBadges.tsx
  feedback/
    ErrorBoundary.tsx
    Spinner.tsx
  forms/
    EventForms.tsx
    TicketTypesForm.tsx
  layout/
    EventForm.tsx
    Header.tsx
    PageContainer.tsx
    Sidebar.tsx
    StaffLayout.tsx
  modals/
    StaffDetailModal.tsx
  organiser/
    analytics/
      AnalyticsPanel.tsx
      DashboardOverview.tsx
      DrillDownSection.tsx
      EventDetailsSummary.tsx
      MetricCard.tsx
  QRScanner.tsx
config/
  keycloak.ts
context/
  AuthContext.tsx
hooks/
  useAuth.ts
  useLocalStorage.ts
pages/
  auth/
    Callback.tsx
  organiser/
    Events/
      EventCreate.tsx
      EventDetails.tsx
      EventEdit.tsx
      EventList.tsx
      EventTickets.tsx
    Analytics.tsx
    Dashboard.tsx
    EventDashboard.tsx
    EventStaffManagement.tsx
    OrganiserLandingPage.css
    OrganiserLandingPage.tsx
    Settings.tsx
    StaffManagement.tsx
    Tickets.tsx
  public/
    BrowseEvents.tsx
    MyTickets.tsx
    PublishedEventDetails.tsx
  shared/
    NotFound.tsx
    Unauthorized.tsx
  staff/
    StaffValidation.tsx
routes/
  GlobalRouteGuard.tsx
  index.tsx
  ProtectedRoute.tsx
  RoleProtectedRoute.tsx
  StaffProtectedRoute.tsx
services/
  keycloakService.ts
types/
  analytics.ts
  index.ts
utils/
  constants.ts
  formatters.ts
  jwt.ts
  roles.ts
  validators.ts
App.tsx
index.css
main.tsx
vite-env.d.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="api/endpoints/analytics.ts">
import apiClient from '../client';
import {
    AnalyticsSummary,
    OrganiserCompleteAnalyticsDto,
    EventAnalyticsDto,
    TicketTypePerformanceDto
} from '@/types/analytics';

export const analyticsApi = {
    getSummary: async (): Promise<AnalyticsSummary> => {
        const response = await apiClient.get<AnalyticsSummary>('/analytics/summary');
        return response.data;
    },

    getCompleteAnalytics: async (): Promise<OrganiserCompleteAnalyticsDto> => {
        const response = await apiClient.get<OrganiserCompleteAnalyticsDto>('/analytics/complete');
        return response.data;
    },

    getEventAnalytics: async (eventId: string): Promise<EventAnalyticsDto> => {
        const response = await apiClient.get<EventAnalyticsDto>(`/analytics/events/${eventId}`);
        return response.data;
    },

    getTicketTypePerformance: async (): Promise<TicketTypePerformanceDto[]> => {
        // Note: The response structure in the requirements description says array of objects?
        // "Response Structure: interface TicketTypePerformanceDto { ... }"
        // Looking at "4. Get Ticket Type Performance", it likely returns a list. 
        // I'll assume it returns an array of TicketTypePerformanceDto based on typical API patterns for "performance" lists.
        // If it's a single object, I'll adjust. The prompt showed a single interface, but usually performance is a list or map.
        // Checking script.txt: "Use Case: See which ticket types perform best...". 
        // It's likely a list of types. The interface definition shows a single item structure. 
        // I will type it as TicketTypePerformanceDto[] for now.
        const response = await apiClient.get<TicketTypePerformanceDto[]>('/analytics/ticket-types/performance');
        return response.data;
    }
};
</file>

<file path="api/endpoints/auth.ts">
import apiClient from '../client';
import { User } from '@/types';

export const authApi = {
  // Get current user info (if backend provides this endpoint)
  getCurrentUser: async (): Promise<User> => {
    const response = await apiClient.get<User>('/auth/me');
    return response.data;
  },

  // Logout (if backend provides this endpoint)
  logout: async (): Promise<void> => {
    await apiClient.post('/auth/logout');
  },
};
</file>

<file path="api/endpoints/events.ts">
import apiClient from '../client';
import { PaginatedResponse } from '@/types';

// Ticket Type DTOs (matching backend CreateTicketTypeRequestDto)
export interface CreateTicketTypeDto {
  name: string;
  price: number;
  description?: string;
  totalAvailable?: number;
}

export interface UpdateTicketTypeRequestDto {
  id?: number;
  name?: string;
  price?: number;
  description?: string;
  totalAvailable?: number;
}

// Event DTOs (matching backend DTOs)
export interface Event {
  id: string;
  name: string;  // Changed from 'title' to 'name'
  description: string;
  startTime: string;  // Changed from 'startDate' to 'startTime'
  endTime: string;    // Changed from 'endDate' to 'endTime'
  venue: string;
  eventType:string;
  salesStartDate?: string;
  salesEndDate?: string;
  eventStatus: 'DRAFT' | 'PUBLISHED' | 'CANCELLED' | 'COMPLETED';
  ticketTypes: TicketTypeCreatedResponseDto[];
  createdAt: string;
  updatedAt: string;
}

export interface CreateEventDto {
  name: string;  // Changed from 'title' to 'name'
  description: string;
  startTime: string;  // Changed from 'startDate' to 'startTime'
  endTime: string;    // Changed from 'endDate' to 'endTime'
  venue: string;
  eventType:string;
  salesStartDate?: string;
  salesEndDate?: string;
  ticketTypes: CreateTicketTypeDto[];
}

export interface UpdateEventDto {
  name?: string;
  description?: string;
  startTime?: string;
  endTime?: string;
  venue?: string;
  eventType:string;
  salesStartDate?: string;
  salesEndDate?: string;
  ticketTypes?: UpdateTicketTypeRequestDto[];
}

// Response DTOs (matching backend response DTOs)
export interface EventCreatedResponseDto {
  id: string;
  name: string;
  description: string;
  startTime: string;
  endTime: string;
  venue: string;
  eventType:string;
  salesStartDate?: string;
  salesEndDate?: string;
  eventStatus: 'DRAFT' | 'PUBLISHED' | 'CANCELLED' | 'COMPLETED';
  ticketTypes: TicketTypeCreatedResponseDto[];
  createdAt: string;
  updatedAt: string;
}

export interface TicketTypeCreatedResponseDto {
  id: number;
  name: string;
  price: number;
  description?: string;
  totalAvailable?: number;
  createdAt: string;
  updatedAt: string;
}

export interface ListEventResponseDto {
  id: string;
  name: string;
  description: string;
  startTime: string;
  endTime: string;
  venue: string;
  eventType:string;
  salesStartDate?: string;
  salesEndDate?: string;
  eventStatus: 'DRAFT' | 'PUBLISHED' | 'CANCELLED' | 'COMPLETED';
  ticketTypes: ListEventTicketTypeResponseDto[];
}

export interface ListEventTicketTypeResponseDto {
  id: number;
  name: string;
  price: number;
  totalAvailable?: number;
}

export const eventsApi = {
  // GET /api/v1/events/listEvent
  getAll: async (page: number = 0, size: number = 10): Promise<PaginatedResponse<ListEventResponseDto>> => {
    const response = await apiClient.get<PaginatedResponse<ListEventResponseDto>>('/events/listEvent', {
      params: { page, size },
    });
    return response.data;
  },

  // GET /api/v1/events/getEvent/{id}
  getById: async (id: string): Promise<EventCreatedResponseDto> => {
    const response = await apiClient.get<EventCreatedResponseDto>(`/events/getEvent/${id}`);
    return response.data;
  },

  // POST /api/v1/events/createEvent
  create: async (data: CreateEventDto): Promise<EventCreatedResponseDto> => {
    const response = await apiClient.post<EventCreatedResponseDto>('/events/createEvent', data);
    return response.data;
  },

  // PATCH /api/v1/events/updateEvent/{id}
  update: async (id: string, data: UpdateEventDto): Promise<EventCreatedResponseDto> => {
    const response = await apiClient.patch<EventCreatedResponseDto>(`/events/updateEvent/${id}`, data);
    return response.data;
  },

  // Note: Backend doesn't have delete yet, but keeping for future
  delete: async (id: string): Promise<void> => {
    await apiClient.delete(`/events/${id}`);
  },
  deleteTicketType: async (eventId: string, ticketTypeId: string): Promise<void> => {
    await apiClient.delete(`/events/${eventId}/ticket-types/${ticketTypeId}`);
  },
};
</file>

<file path="api/endpoints/organiser.ts">
import apiClient from '../client';
import {
    PaginatedResponse,
    EventValidationStats,
    TicketTypeAttendance,
    StaffValidationStats,
    ValidationHistory,
} from '@/types';

export const organiserDashboardApi = {
    /**
     * Get overall event validation statistics
     * GET /api/v1/organiser/events/{eventId}/dashboard/stats
     */
    getEventStats: async (eventId: string): Promise<EventValidationStats> => {
        const response = await apiClient.get<EventValidationStats>(
            `/organiser/events/${eventId}/dashboard/stats`
        );
        return response.data;
    },

    /**
     * Get validations per ticket type
     * GET /api/v1/organiser/events/{eventId}/dashboard/ticket-types
     */
    getTicketTypeStats: async (eventId: string): Promise<TicketTypeAttendance[]> => {
        const response = await apiClient.get<TicketTypeAttendance[]>(
            `/organiser/events/${eventId}/dashboard/ticket-types`
        );
        return response.data;
    },

    /**
     * Get validations per staff member
     * GET /api/v1/organiser/events/{eventId}/dashboard/staff
     */
    getStaffStats: async (eventId: string): Promise<StaffValidationStats[]> => {
        const response = await apiClient.get<StaffValidationStats[]>(
            `/organiser/events/${eventId}/dashboard/staff`
        );
        return response.data;
    },

    /**
     * Get detailed attendee list validated by specific staff
     * GET /api/v1/organiser/events/{eventId}/dashboard/staff/{staffUserId}/validations
     */
    getStaffValidationDetails: async (
        eventId: string,
        staffUserId: string,
        page: number = 0,
        size: number = 20
    ): Promise<PaginatedResponse<ValidationHistory>> => {
        const response = await apiClient.get<PaginatedResponse<ValidationHistory>>(
            `/organiser/events/${eventId}/dashboard/staff/${staffUserId}/validations`,
            { params: { page, size } }
        );
        return response.data;
    },
};
</file>

<file path="api/endpoints/publishedEvents.ts">
import apiClient from '../client';
import { PaginatedResponse } from '@/types';

export interface PublishedEventDto {
  id: string;
  name: string;
  description: string;
  startTime: string;
  endTime: string;
  venue: string;
  eventType:string;
  salesStartDate?: string;
  salesEndDate?: string;
  eventStatus: 'PUBLISHED';
  ticketTypes: {
    id: number;
    name: string;
    price: number;
    totalAvailable?: number;
  }[];
  imageUrl?: string;
}

export const publishedEventsApi = {
  // GET /api/v1/published-events
  getAll: async (page: number = 0, size: number = 12, search?: string): Promise<PaginatedResponse<PublishedEventDto>> => {
    const params: any = { page, size };
    if (search && search.trim()) {
      params.search = search.trim();
    }
    
    const response = await apiClient.get<PaginatedResponse<PublishedEventDto>>('/published-events', {
      params,
    });
    return response.data;
  },

  // GET /api/v1/published-events/{id}
  getById: async (id: string): Promise<PublishedEventDto> => {
    const response = await apiClient.get<PublishedEventDto>(`/published-events/${id}`);
    return response.data;
  },
};
</file>

<file path="api/endpoints/roles.ts">
import apiClient from '../client';

export const rolesApi = {
    promoteToOrganiser: async (): Promise<void> => {
        await apiClient.post('/roles/promote-to-organiser');
    },
};
</file>

<file path="api/endpoints/staff.ts">
import apiClient from '../client';
import {
    StaffGenerationRequest,
    StaffGenerationResponse,
    StaffMemberDto,
    PaginatedResponse,
    PasswordResetResponse,
    ExtendValidityResponse,
    TicketValidationResponse,
    TicketSearchResult,
    StaffValidationStats,
} from '@/types';

// ============================================================
// ORGANISER APIs (for managing staff)
// These endpoints are for organisers to manage their staff
// ============================================================
export const staffApi = {
    /**
     * Generate staff accounts for a specific event
     */
    generateStaffForEvent: async (
        eventId: string,
        data: StaffGenerationRequest
    ): Promise<StaffGenerationResponse> => {
        const response = await apiClient.post<StaffGenerationResponse>(
            `/staff/events/${eventId}/generate`,
            data
        );
        return response.data;
    },

    /**
     * Get all staff members for an event (paginated)
     */
    getEventStaff: async (
        eventId: string,
        page: number = 0,
        size: number = 20
    ): Promise<PaginatedResponse<StaffMemberDto>> => {
        const response = await apiClient.get<PaginatedResponse<StaffMemberDto>>(
            `/staff/events/${eventId}`,
            { params: { page, size } }
        );
        return response.data;
    },

    /**
     * Get active staff members for an event (paginated)
     */
    getActiveEventStaff: async (
        eventId: string,
        page: number = 0,
        size: number = 20
    ): Promise<PaginatedResponse<StaffMemberDto>> => {
        const response = await apiClient.get<PaginatedResponse<StaffMemberDto>>(
            `/staff/events/${eventId}/active`,
            { params: { page, size } }
        );
        return response.data;
    },

    /**
     * Delete a staff member from an event
     */
    deleteStaffMember: async (eventId: string, userId: string): Promise<void> => {
        await apiClient.delete(`/staff/events/${eventId}/users/${userId}`);
    },

    /**
     * Reset password for a staff member
     */
    resetStaffPassword: async (
        eventId: string,
        userId: string
    ): Promise<PasswordResetResponse> => {
        const response = await apiClient.post<PasswordResetResponse>(
            `/staff/events/${eventId}/users/${userId}/reset-password`,
            {}
        );
        return response.data;
    },

    /**
     * Extend validity period for a staff member
     */
    extendStaffValidity: async (
        eventId: string,
        userId: string,
        hours: number
    ): Promise<ExtendValidityResponse> => {
        const response = await apiClient.post<ExtendValidityResponse>(
            `/staff/events/${eventId}/users/${userId}/extend-validity`,
            null,
            { params: { hours } }
        );
        return response.data;
    },
};

// ============================================================
// STAFF VALIDATION APIs (for staff members only)
// These endpoints require ROLE_STAFF
// Frontend guards prevent unauthorized calls for better UX
// ============================================================

/**
 * Helper to check if current user has STAFF role
 * Returns boolean based on stored user data
 */
const checkStaffRole = (): boolean => {
    try {
        const storedUser = localStorage.getItem('keycloak_user');
        if (!storedUser) return false;

        const user = JSON.parse(storedUser);
        return user?.roles?.includes('ROLE_STAFF') === true;
    } catch {
        return false;
    }
};

/**
 * Error thrown when non-staff user tries to call staff-only API
 */
class UnauthorizedRoleError extends Error {
    constructor() {
        super('You are not authorised to access staff validation features.');
        this.name = 'UnauthorizedRoleError';
    }
}

export const staffValidationApi = {
    /**
     * Validate ticket by QR code scan
     * POST /api/v1/staff/validation/scan
     * ⚠️ STAFF ROLE REQUIRED
     */
    validateByQR: async (qrCode: string): Promise<TicketValidationResponse> => {
        // Frontend guard: prevent API call if user is not STAFF
        if (!checkStaffRole()) {
            throw new UnauthorizedRoleError();
        }

        console.log('[API] Validating by QR with payload:', { qrCode });

        const response = await apiClient.post<TicketValidationResponse>(
            '/staff/validation/scan',
            { qrCode }
        );
        return response.data;
    },

    /**
     * Validate ticket manually by QR code (publicCode)
     * POST /api/v1/staff/validation/manual
     * Request body: { "qrCode": "STRING" }
     * ⚠️ STAFF ROLE REQUIRED
     */
    validateManually: async (qrCode: string): Promise<TicketValidationResponse> => {
        // Frontend guard: prevent API call if user is not STAFF
        if (!checkStaffRole()) {
            throw new UnauthorizedRoleError();
        }

        console.log('[API] Validating manually with payload:', { qrCode });

        const response = await apiClient.post<TicketValidationResponse>(
            '/staff/validation/manual',
            { qrCode }
        );
        return response.data;
    },

    /**
     * Search for ticket before manual validation
     * GET /api/v1/staff/validation/search?qrCode={qrCode}
     * ⚠️ STAFF ROLE REQUIRED
     */
    searchTicket: async (qrCode: string): Promise<TicketSearchResult[]> => {
        // Frontend guard: prevent API call if user is not STAFF
        if (!checkStaffRole()) {
            throw new UnauthorizedRoleError();
        }

        const response = await apiClient.get<TicketSearchResult[]>(
            '/staff/validation/search',
            { params: { qrCode } }
        );
        return response.data;
    },

    /**
     * Get staff's own validation statistics
     * GET /api/v1/staff/validation/stats
     * ⚠️ STAFF ROLE REQUIRED
     */
    getMyStats: async (): Promise<StaffValidationStats> => {
        // Frontend guard: prevent API call if user is not STAFF
        if (!checkStaffRole()) {
            throw new UnauthorizedRoleError();
        }

        const response = await apiClient.get<StaffValidationStats>(
            '/staff/validation/stats'
        );
        return response.data;
    },
};
</file>

<file path="api/endpoints/tickets.ts">
import apiClient from '../client';
import { PaginatedResponse } from '@/types';

// ============================================================================
// TICKET DTOs (matching backend)
// ============================================================================

export interface TicketPurchasedDto {
  id: string;
  price: number;
  status: 'PURCHASED' | 'USED' | 'CANCELLED' | 'EXPIRED' | 'INVALID';
  ticketType: TicketTypeDtoForTicketPurchase;
  event: EventDtoForTicketPurchase;
}

export interface TicketPurchasedDetails {
  id: string;
  price: number;
  status: 'PURCHASED' | 'USED' | 'CANCELLED' | 'EXPIRED' | 'INVALID';
  ticketType: TicketTypeDetails;
  purchasedAt: string;
}

export interface TicketTypeDtoForTicketPurchase {
  id: number;
  name: string;
  totalAvailable: number;
  price: number;
}

export interface TicketTypeDetails {
  id: number;
  name: string;
  price: number;
}

export interface EventDtoForTicketPurchase {
  id: string;
  name: string;
  startTime: string;
  endTime: string;
}

// ============================================================================
// QR CODE DTOs (matching backend)
// ============================================================================

export interface QrCodeDetails {
  id: string;
  publicCode: string;
  qrCodeStatus: 'ACTIVE' | 'EXPIRED' | 'USED';
  generatedDateTime: string;
}

// ============================================================================
// TICKETS API
// ============================================================================

export const ticketsApi = {
  /**
   * Purchase a ticket for a specific ticket type
   * POST /api/v1/tickets/purchase/{ticketTypeId}
   * 
   * Backend creates ticket with PURCHASED status
   * NO QR code is generated at this stage
   */
  purchaseTicket: async (ticketTypeId: number): Promise<TicketPurchasedDto> => {
    const response = await apiClient.post<TicketPurchasedDto>(
      `/tickets/purchase/${ticketTypeId}`
    );
    return response.data;
  },

  /**
   * List all tickets purchased by the authenticated user (paginated)
   * GET /api/v1/tickets
   */
  listMyTickets: async (
    page: number = 0,
    size: number = 10
  ): Promise<PaginatedResponse<TicketPurchasedDto>> => {
    const response = await apiClient.get<PaginatedResponse<TicketPurchasedDto>>(
      '/tickets',
      { params: { page, size } }
    );
    return response.data;
  },

  /**
   * Get detailed information about a specific ticket
   * GET /api/v1/tickets/{ticketId}
   * 
   * Returns ticket details WITHOUT generating QR code
   * This is read-only - QR metadata fetched separately
   */
  getTicketDetails: async (ticketId: string): Promise<TicketPurchasedDetails> => {
    const response = await apiClient.get<TicketPurchasedDetails>(
      `/tickets/${ticketId}`
    );
    return response.data;
  },

  /**
   * Get QR code metadata for a ticket (read-only)
   * GET /api/v1/tickets/{ticketId}/qr
   * 
   * Returns QR details if one exists
   * Does NOT generate a new QR code
   */
  getQrCodeDetails: async (ticketId: string): Promise<QrCodeDetails | null> => {
    try {
      const response = await apiClient.get<QrCodeDetails>(
        `/tickets/${ticketId}/qr`
      );
      return response.data;
    } catch (error: any) {
      // If no QR exists yet, return null instead of throwing
      if (error.status === 404 || error.response?.status === 404) {
        return null;
      }
      throw error;
    }
  },

  /**
   * Generate QR code image for a ticket
   * POST /api/v1/tickets/{ticketId}/qr
   * 
   * This is the ONLY endpoint that generates QR codes
   * Backend validates ticket status and either:
   * - Reuses existing ACTIVE QR if not expired
   * - Generates new QR if none exists or previous expired
   * 
   * Returns binary image data (PNG)
   */
  generateQrCode: async (ticketId: string): Promise<Blob> => {
    const response = await apiClient.post(
      `/tickets/${ticketId}/qr`,
      {},
      {
        responseType: 'blob', // Important: receive binary data
      }
    );
    return response.data;
  },

  /**
   * Scan/validate QR code at venue
   * POST /api/v1/tickets/scanQr?publicCode={publicCode}
   * 
   * Backend validates:
   * - QR exists and is ACTIVE
   * - QR not expired (based on generation time + expiry window)
   * - Ticket status is PURCHASED
   * 
   * If valid, marks both QR and ticket as USED (atomic operation)
   */
  scanQrCode: async (publicCode: string): Promise<void> => {
    await apiClient.post('/tickets/scanQr', null, {
      params: { publicCode },
    });
  },

  /**
   * Cancel a ticket (restore availability)
   * POST /api/v1/tickets/{ticketId}/cancel
   * 
   * Only allowed for PURCHASED tickets (not USED)
   */
  cancelTicket: async (ticketId: string): Promise<void> => {
    await apiClient.post(`/tickets/${ticketId}/cancel`);
  },
};
</file>

<file path="api/client.ts">
import axios, { AxiosInstance, InternalAxiosRequestConfig, AxiosError, AxiosResponse } from 'axios';
import { API_BASE_URL } from '@/utils/constants';
import { ApiError } from '@/types';

// Create axios instance
const apiClient: AxiosInstance = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// List of public endpoints that don't require authentication
const PUBLIC_ENDPOINTS = [
  '/published-events',
];

// Helper function to check if URL is public
const isPublicEndpoint = (url?: string): boolean => {
  if (!url) return false;
  return PUBLIC_ENDPOINTS.some(endpoint => url.startsWith(endpoint));
};

// Request interceptor - Add JWT token from Keycloak (skip for public endpoints)
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    // Skip auth for public endpoints
    if (isPublicEndpoint(config.url)) {
      return config;
    }

    // Get token from localStorage (set by Keycloak integration)
    const token = localStorage.getItem('keycloak_token');

    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }

    return config;
  },
  (error: unknown) => {
    return Promise.reject(error);
  }
);

// Response interceptor - Handle errors
apiClient.interceptors.response.use(
  (response: AxiosResponse) => response,
  (error: AxiosError<{ message?: string; error?: string; errors?: Record<string, string[]> }>) => {
    const apiError: ApiError = {
      message: error.message || 'An error occurred',
      status: error.response?.status,
    };

    // Handle 401 Unauthorized - Token expired or invalid (skip for public endpoints)
    if (error.response?.status === 401 && !isPublicEndpoint(error.config?.url)) {
      // Clear token and redirect to Keycloak login
      localStorage.removeItem('keycloak_token');
      localStorage.removeItem('keycloak_user');
      // Import dynamically to avoid circular dependency
      import('@/services/keycloakService').then(({ redirectToKeycloakLogin }) => {
        redirectToKeycloakLogin();
      });
    }

    // Handle validation errors (400)
    if (error.response?.status === 400 && error.response.data) {
      const data = error.response.data as any;
      console.log('[API Error] 400 Bad Request Details:', {
        url: error.config?.url,
        data: data
      });

      // Check for various error message formats from backend
      if (data.error) {
        apiError.message = data.error;
      } else if (data.message) {
        apiError.message = data.message;
      } else if (data.errors) {
        apiError.errors = data.errors;
        // Get first error message
        const firstError = Object.values(data.errors)[0];
        if (Array.isArray(firstError) && firstError.length > 0) {
          apiError.message = firstError[0];
        }
      }
    }

    // Handle 404 Not Found
    if (error.response?.status === 404) {
      const data = error.response.data as any;
      if (data?.message) {
        apiError.message = data.message;
      } else if (data?.error) {
        apiError.message = data.error;
      } else {
        apiError.message = 'Resource not found';
      }
    }

    // Handle 500 Internal Server Error
    if (error.response?.status === 500) {
      const data = error.response.data as any;
      if (data?.error) {
        apiError.message = data.error;
      } else if (data?.message) {
        apiError.message = data.message;
      } else {
        apiError.message = 'Internal server error. Please try again later.';
      }
    }

    // Handle other error responses
    if (error.response?.data) {
      const data = error.response.data as any;

      // Try to extract error message in order of priority
      if (data.error && typeof data.error === 'string') {
        apiError.message = data.error;
      } else if (data.message && typeof data.message === 'string') {
        apiError.message = data.message;
      }
    }

    return Promise.reject(apiError);
  }
);

export default apiClient;
</file>

<file path="components/common/Badge.tsx">
import { ReactNode } from 'react';

interface BadgeProps {
  children: ReactNode;
  variant?: 'success' | 'warning' | 'danger' | 'info' | 'default';
  className?: string;
}

export const Badge = ({ children, variant = 'default', className = '' }: BadgeProps) => {
  const variants = {
    success: 'bg-green-100 text-green-800',
    warning: 'bg-yellow-100 text-yellow-800',
    danger: 'bg-red-100 text-red-800',
    info: 'bg-blue-100 text-blue-800',
    default: 'bg-gray-100 text-gray-800',
  };

  return (
    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${variants[variant]} ${className}`}>
      {children}
    </span>
  );
};
</file>

<file path="components/common/Button.tsx">
import { ButtonHTMLAttributes, ReactNode } from 'react';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'danger' | 'outline';
  size?: 'sm' | 'md' | 'lg';
  isLoading?: boolean;
  children: ReactNode;
}

export const Button = ({
  variant = 'primary',
  size = 'md',
  isLoading = false,
  disabled,
  className = '',
  children,
  ...props
}: ButtonProps) => {
  const baseStyles = 'font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2';
  
  const variants = {
    primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500',
    secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500',
    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',
    outline: 'border-2 border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500',
  };

  const sizes = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-6 py-3 text-lg',
  };

  return (
    <button
      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className} ${
        (disabled || isLoading) ? 'opacity-50 cursor-not-allowed' : ''
      }`}
      disabled={disabled || isLoading}
      {...props}
    >
      {isLoading ? 'Loading...' : children}
    </button>
  );
};
</file>

<file path="components/common/Card.tsx">
import { ReactNode } from 'react';

interface CardProps {
  children: ReactNode;
  className?: string;
  onClick?: () => void;
}

export const Card = ({ children, className = '', onClick }: CardProps) => {
  return (
    <div
      className={`bg-white rounded-lg shadow-md p-6 ${onClick ? 'cursor-pointer hover:shadow-lg transition-shadow' : ''} ${className}`}
      onClick={onClick}
    >
      {children}
    </div>
  );
};
</file>

<file path="components/common/Input.tsx">
import { InputHTMLAttributes, forwardRef } from 'react';

interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
}

export const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ label, error, className = '', ...props }, ref) => {
    return (
      <div className="w-full">
        {label && (
          <label className="block text-sm font-medium text-gray-700 mb-1">
            {label}
          </label>
        )}
        <input
          ref={ref}
          className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
            error ? 'border-red-500' : 'border-gray-300'
          } ${className}`}
          {...props}
        />
        {error && <p className="mt-1 text-sm text-red-600">{error}</p>}
      </div>
    );
  }
);

Input.displayName = 'Input';
</file>

<file path="components/common/ProfileDropdown.tsx">
import { useState, useEffect, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '@/hooks/useAuth';
import { PromoteToOrganiserButton } from './PromoteToOrganiserButton';
import { RoleBadges } from './RoleBadges';

export const ProfileDropdown = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [showAccountSettings, setShowAccountSettings] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const navigate = useNavigate();
  const { user, logout, isAuthenticated } = useAuth();

  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setIsOpen(false);
        setShowAccountSettings(false);
      }
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  const handleLogout = () => {
    logout();
    setIsOpen(false);
    setShowAccountSettings(false);
  };

  const handleListYourShow = () => {
    setIsOpen(false);
    navigate('/organiser');
  };

  const handleYourTickets = () => {
    setIsOpen(false);
    navigate('/my-tickets');
  };

  const toggleAccountSettings = () => {
    setShowAccountSettings(!showAccountSettings);
  };

  const goBackToMenu = () => {
    setShowAccountSettings(false);
  };

  return (
    <div className="relative" ref={dropdownRef}>
      {/* Profile Button */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors"
      >
        <div className="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center text-white font-semibold">
          {user?.name ? user.name.charAt(0).toUpperCase() : 'U'}
        </div>
        <svg
          className={`w-4 h-4 text-gray-600 transition-transform ${isOpen ? 'rotate-180' : ''}`}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      {/* Dropdown Menu */}
      {isOpen && (
        <div className="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-xl border border-gray-200 py-2 z-50">
          {!showAccountSettings ? (
            // Main Menu
            <>
              {/* User Info */}
              {isAuthenticated && user && (
                <div className="px-4 py-3 border-b border-gray-100">
                  <p className="text-sm font-semibold text-gray-900">Hi, {user.name || 'Guest'}!</p>
                  <p className="text-xs text-gray-500 mb-2">{user.email}</p>
                  <RoleBadges roles={user.roles || []} />
                </div>
              )}

              {/* Menu Items */}
              <div className="py-1">
                <button
                  onClick={handleYourTickets}
                  className="w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors flex items-center space-x-3"
                >
                  <svg className="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                  </svg>
                  <div>
                    <p className="text-sm font-medium text-gray-900">Your Tickets</p>
                    <p className="text-xs text-gray-500">View all your bookings</p>
                  </div>
                </button>

                <button
                  onClick={toggleAccountSettings}
                  className="w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors flex items-center justify-between"
                >
                  <div className="flex items-center space-x-3">
                    <svg className="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <div>
                      <p className="text-sm font-medium text-gray-900">Account & Settings</p>
                      <p className="text-xs text-gray-500">Manage your account</p>
                    </div>
                  </div>
                  <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                  </svg>
                </button>



                <div className="border-t border-gray-100 my-1"></div>

                {user?.roles.includes('ROLE_ORGANISER') ? (
                  <button
                    onClick={handleListYourShow}
                    className="w-full px-4 py-3 text-left hover:bg-blue-50 transition-colors flex items-center space-x-3"
                  >
                    <svg className="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    <div>
                      <p className="text-sm font-semibold text-blue-600">Organiser Dashboard</p>
                      <p className="text-xs text-gray-500">Manage events</p>
                    </div>
                  </button>
                ) : (
                  <div className="p-2">
                    <PromoteToOrganiserButton />
                  </div>
                )}
              </div>
            </>
          ) : (
            // Account Settings Submenu
            <>
              <div className="px-4 py-3 border-b border-gray-100 flex items-center">
                <button onClick={goBackToMenu} className="mr-2">
                  <svg className="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                  </svg>
                </button>
                <p className="text-sm font-semibold text-gray-900">Account & Settings</p>
              </div>

              <div className="py-2">
                <div className="px-4 py-3 bg-gray-50">
                  <p className="text-xs text-gray-500 mb-1">Username</p>
                  <p className="text-sm font-medium text-gray-900">{user?.name || 'Not set'}</p>
                </div>

                <div className="px-4 py-3">
                  <p className="text-xs text-gray-500 mb-1">Email</p>
                  <p className="text-sm font-medium text-gray-900">{user?.email || 'Not set'}</p>
                </div>

                <div className="border-t border-gray-100 mt-2"></div>

                <button
                  onClick={handleLogout}
                  className="w-full px-4 py-3 text-left hover:bg-red-50 transition-colors flex items-center space-x-3 text-red-600"
                >
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  <span className="text-sm font-medium">Logout</span>
                </button>
              </div>
            </>
          )}
        </div>
      )}
    </div>
  );
};
</file>

<file path="components/common/PromoteToOrganiserButton.tsx">
import { useState } from 'react';
import { Button } from './Button';
import { rolesApi } from '@/api/endpoints/roles';
import { useAuth } from '@/hooks/useAuth';

export const PromoteToOrganiserButton = () => {
    const { user, logout } = useAuth();
    const [isLoading, setIsLoading] = useState(false);
    const [showConfirm, setShowConfirm] = useState(false);

    // If user is already organiser, don't show button
    if (user?.roles.includes('ROLE_ORGANISER')) {
        return null;
    }

    const handlePromote = async () => {
        try {
            setIsLoading(true);
            await rolesApi.promoteToOrganiser();

            // Promotion successful, require re-login
            if (confirm('Promotion successful! You need to log out and log in again to access Organiser features. Log out now?')) {
                logout();
            } else {
                // If they cancel, we should probably warn them or just let them be, but features won't work.
                // Force logout is safer usually, but let's stick to prompt. 
                // Actually, let's auto-logout with a message if possible, but basic confirm is fine.
                logout();
            }
        } catch (error) {
            console.error('Failed to promote:', error);
            alert('Failed to process request. Please try again.');
        } finally {
            setIsLoading(false);
            setShowConfirm(false);
        }
    };

    if (showConfirm) {
        return (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div className="bg-white p-6 rounded-lg max-w-sm w-full">
                    <h3 className="text-lg font-bold mb-2">Become an Organiser?</h3>
                    <p className="text-gray-600 mb-4">
                        This will enable you to list events.
                        <strong>You will be logged out immediately</strong> to update your permissions.
                    </p>
                    <div className="flex justify-end space-x-3">
                        <Button variant="outline" onClick={() => setShowConfirm(false)} disabled={isLoading}>
                            Cancel
                        </Button>
                        <Button
                            variant="primary"
                            onClick={handlePromote}
                            isLoading={isLoading}
                        >
                            Confirm & Logout
                        </Button>
                    </div>
                </div>
            </div>
        )
    }

    return (
        <Button
            variant="primary"
            onClick={() => setShowConfirm(true)}
            className="w-full justify-center" // Ensure it looks good in dropdown
        >
            Become an Organiser
        </Button>
    );
};
</file>

<file path="components/common/RoleBadges.tsx">
import { Badge } from './Badge';

interface RoleBadgesProps {
    roles: string[];
}

export const RoleBadges = ({ roles }: RoleBadgesProps) => {
    const getBadgeVariant = (role: string) => {
        switch (role) {
            case 'ROLE_ORGANISER':
                return 'success';
            case 'ROLE_STAFF':
                return 'warning';
            case 'ROLE_ATTENDEE':
                return 'info';
            default:
                return 'default';
        }
    };

    const formatRoleName = (role: string) => {
        return role.replace('ROLE_', '').toLowerCase().replace(/^\w/, c => c.toUpperCase());
    };

    // Filter relevant roles
    const relevantRoles = roles.filter(role => role.startsWith('ROLE_'));

    if (relevantRoles.length === 0) return null;

    return (
        <div className="flex flex-wrap gap-2">
            {relevantRoles.map(role => (
                <Badge key={role} variant={getBadgeVariant(role)}>
                    {formatRoleName(role)}
                </Badge>
            ))}
        </div>
    );
};
</file>

<file path="components/feedback/ErrorBoundary.tsx">
import { Component, ReactNode, ErrorInfo } from 'react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('ErrorBoundary caught an error:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        this.props.fallback || (
          <div className="flex items-center justify-center min-h-screen">
            <div className="text-center">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Something went wrong</h2>
              <p className="text-gray-600 mb-4">{this.state.error?.message}</p>
              <button
                onClick={() => window.location.reload()}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
              >
                Reload Page
              </button>
            </div>
          </div>
        )
      );
    }

    return this.props.children;
  }
}
</file>

<file path="components/feedback/Spinner.tsx">
interface SpinnerProps {
  size?: 'sm' | 'md' | 'lg';
  className?: string;
}

export const Spinner = ({ size = 'md', className = '' }: SpinnerProps) => {
  const sizes = {
    sm: 'w-4 h-4',
    md: 'w-8 h-8',
    lg: 'w-12 h-12',
  };

  return (
    <div className={`${sizes[size]} ${className}`}>
      <div className="animate-spin rounded-full border-4 border-gray-200 border-t-blue-600"></div>
    </div>
  );
};
</file>

<file path="components/forms/EventForms.tsx">
import { useEffect } from 'react';
import { useForm, useFieldArray } from 'react-hook-form';
import { Button } from '@/components/common/Button';
import { Input } from '@/components/common/Input';
import { Card } from '@/components/common/Card';
import { 
  EventCreatedResponseDto, 
  ListEventResponseDto
} from '@/api/endpoints/events';

// ============================================================================
// FORM DATA TYPES
// ============================================================================

interface TicketTypeFormData {
  id?: number;
  name: string;
  price: number;
  description?: string;
  totalAvailable?: number;
}

interface EventFormData {
  name: string;
  description: string;
  venue: string;
  eventType:string;
  startTime: string;
  endTime: string;
  salesStartDate?: string;
  salesEndDate?: string;
  ticketTypes: TicketTypeFormData[];
}

// ============================================================================
// COMPONENT PROPS
// ============================================================================

interface EventFormProps {
  mode: 'create' | 'edit';
  initialData?: EventCreatedResponseDto | ListEventResponseDto;
  onSubmit: (data: EventFormData) => Promise<void>;
  onCancel: () => void;
  isLoading?: boolean;
}

// ============================================================================
// EVENT FORM COMPONENT
// ============================================================================

export const EventForm = ({ 
  mode, 
  initialData, 
  onSubmit, 
  onCancel,
  isLoading = false 
}: EventFormProps) => {
  const {
    register,
    handleSubmit,
    control,
    reset,
    formState: { errors },
  } = useForm<EventFormData>({
    defaultValues: {
      name: '',
      description: '',
      venue: '',
      eventType:'',
      startTime: '',
      endTime: '',
      salesStartDate: '',
      salesEndDate: '',
      ticketTypes: [
        {
          name: '',
          price: 0,
          description: '',
          totalAvailable: 0,
        },
      ],
    },
  });

  const { fields, append, remove } = useFieldArray({
    control,
    name: 'ticketTypes',
  });

  // Helper function to safely get ticket type description
  const getTicketDescription = (ticket: any): string => {
    // Check if ticket has description property
    if ('description' in ticket && typeof ticket.description === 'string') {
      return ticket.description;
    }
    return '';
  };

  // Helper function to safely get ticket type totalAvailable
  const getTicketTotalAvailable = (ticket: any): number | undefined => {
    // Check if ticket has totalAvailable property
    if ('totalAvailable' in ticket && ticket.totalAvailable !== undefined) {
      return ticket.totalAvailable;
    }
    return undefined;
  };

  // Populate form with initial data in edit mode
  useEffect(() => {
    if (mode === 'edit' && initialData) {
      reset({
        name: initialData.name,
        description: initialData.description,
        venue: initialData.venue,
        eventType: initialData.eventType,
        startTime: formatDateTimeForInput(initialData.startTime),
        endTime: formatDateTimeForInput(initialData.endTime),
        salesStartDate: initialData.salesStartDate ? formatDateTimeForInput(initialData.salesStartDate) : '',
        salesEndDate: initialData.salesEndDate ? formatDateTimeForInput(initialData.salesEndDate) : '',
        ticketTypes: (initialData.ticketTypes || []).map(tt => ({
          id: tt.id,
          name: tt.name,
          price: tt.price,
          description: getTicketDescription(tt),
          totalAvailable: getTicketTotalAvailable(tt),
        })),
      });
    }
  }, [mode, initialData, reset]);

  // Format datetime for backend
  const formatDateForBackend = (dateString?: string): string | undefined => {
    if (!dateString || dateString.trim() === '') return undefined;
    
    // If time format is YYYY-MM-DDTHH:mm, add :00 seconds
    if (dateString.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/)) {
      return `${dateString}:00`;
    }
    
    return dateString;
  };

  const handleFormSubmit = async (data: EventFormData) => {
    // Format dates for backend
    const formattedData: EventFormData = {
      ...data,
      startTime: formatDateForBackend(data.startTime) || '',
      endTime: formatDateForBackend(data.endTime) || '',
      salesStartDate: formatDateForBackend(data.salesStartDate),
      salesEndDate: formatDateForBackend(data.salesEndDate),
      ticketTypes: data.ticketTypes.map(ticket => ({
        ...ticket,
        price: Number(ticket.price),
        totalAvailable: ticket.totalAvailable ? Number(ticket.totalAvailable) : undefined
      }))
    };

    await onSubmit(formattedData);
  };

  return (
    <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-6">
      {/* Basic Information */}
      <Card>
        <h2 className="text-xl font-semibold mb-4">Basic Information</h2>
        
        <div className="space-y-4">
          <Input
            label="Event Name *"
            {...register('name', { required: 'Event name is required' })}
            error={errors.name?.message}
            placeholder="Enter event name"
          />

<div>
      <label className="block text-sm font-medium text-gray-700 mb-1">
        Event Type *
      </label>
      <select
        {...register('eventType', { required: 'Event type is required' })}
        className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
          errors.eventType ? 'border-red-500' : 'border-gray-300'
        }`}
      >
        <option value="">Select event type</option>
        <option value="PERFORMANCES">Performances</option>
        <option value="EXPERIENCES">Experiences</option>
        <option value="PARTIES">Parties</option>
        <option value="SPORTS">Sports</option>
        <option value="CONFERENCES">Conferences</option>
      </select>
      {errors.eventType && (
        <p className="mt-1 text-sm text-red-600">
          {errors.eventType.message}
        </p>
      )}
    </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Description *
            </label>
            <textarea
              {...register('description', { required: 'Description is required' })}
              className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                errors.description ? 'border-red-500' : 'border-gray-300'
              }`}
              rows={4}
              placeholder="Describe your event"
            />
            {errors.description && (
              <p className="mt-1 text-sm text-red-600">{errors.description.message}</p>
            )}
          </div>

          <Input
            label="Venue *"
            {...register('venue', { required: 'Venue is required' })}
            error={errors.venue?.message}
            placeholder="Enter venue location"
          />
        </div>
      </Card>

      {/* Event Timing */}
      <Card>
        <h2 className="text-xl font-semibold mb-4">Event Timing</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <Input
            label="Event Start Time *"
            type="datetime-local"
            {...register('startTime', { required: 'Start time is required' })}
            error={errors.startTime?.message}
          />
          
          <Input
            label="Event End Time *"
            type="datetime-local"
            {...register('endTime', { required: 'End time is required' })}
            error={errors.endTime?.message}
          />
        </div>
      </Card>

      {/* Sales Period */}
      <Card>
        <h2 className="text-xl font-semibold mb-4">Ticket Sales Period</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <Input
            label="Sales Start Date"
            type="datetime-local"
            {...register('salesStartDate')}
            error={errors.salesStartDate?.message}
          />
          
          <Input
            label="Sales End Date"
            type="datetime-local"
            {...register('salesEndDate')}
            error={errors.salesEndDate?.message}
          />
        </div>
        <p className="text-sm text-gray-500 mt-2">
          If sales dates are not specified, event will be saved as DRAFT
        </p>
      </Card>

      {/* Ticket Types */}
      <Card>
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-xl font-semibold">Ticket Types *</h2>
          <Button
            type="button"
            variant="outline"
            size="sm"
            onClick={() =>
              append({
                name: '',
                price: 0,
                description: '',
                totalAvailable: 0,
              })
            }
          >
            + Add Ticket Type
          </Button>
        </div>

        <div className="space-y-6">
          {fields.map((field, index) => (
            <div key={field.id} className="p-4 border border-gray-200 rounded-lg bg-gray-50">
              <div className="flex justify-between items-center mb-3">
                <h3 className="font-medium text-gray-900">
                  Ticket Type {index + 1}
                  {field.id && <span className="text-xs text-gray-500 ml-2">(ID: {field.id})</span>}
                </h3>
                {fields.length > 1 && (
                  <Button
                    type="button"
                    variant="danger"
                    size="sm"
                    onClick={() => remove(index)}
                  >
                    Remove
                  </Button>
                )}
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <Input
                  label="Ticket Name *"
                  {...register(`ticketTypes.${index}.name`, {
                    required: 'Ticket name is required',
                  })}
                  error={errors.ticketTypes?.[index]?.name?.message}
                  placeholder="e.g., General Admission"
                />

                <Input
                  label="Price *"
                  type="number"
                  step="0.01"
                  min="0"
                  {...register(`ticketTypes.${index}.price`, {
                    required: 'Price is required',
                    valueAsNumber: true,
                    min: { value: 0, message: 'Price cannot be negative' },
                  })}
                  error={errors.ticketTypes?.[index]?.price?.message}
                  placeholder="0.00"
                />

                <Input
                  label="Total Available"
                  type="number"
                  min="0"
                  {...register(`ticketTypes.${index}.totalAvailable`, {
                    valueAsNumber: true,
                    min: { value: 0, message: 'Cannot be negative' },
                  })}
                  error={errors.ticketTypes?.[index]?.totalAvailable?.message}
                  placeholder="Leave empty for unlimited"
                />

                <div className="md:col-span-2">
                  <Input
                    label="Description (Optional)"
                    {...register(`ticketTypes.${index}.description`)}
                    placeholder="Ticket description"
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
        
        {fields.length === 0 && (
          <div className="text-center py-8 border-2 border-dashed border-gray-300 rounded-lg mt-4">
            <p className="text-gray-500 mb-2">No ticket types added</p>
            <p className="text-sm text-gray-400 mb-4">Events need at least one ticket type</p>
            <Button
              type="button"
              variant="outline"
              onClick={() => append({ name: '', price: 0, description: '', totalAvailable: 0 })}
            >
              Add First Ticket Type
            </Button>
          </div>
        )}
      </Card>

      {/* Form Actions */}
      <div className="flex justify-end space-x-4">
        <Button type="button" variant="outline" onClick={onCancel} disabled={isLoading}>
          Cancel
        </Button>
        <Button type="submit" isLoading={isLoading}>
          {mode === 'create' ? 'Create Event' : 'Update Event'}
        </Button>
      </div>
    </form>
  );
};

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================

/**
 * Format ISO-8601 datetime to datetime-local input format
 * @param isoString ISO-8601 datetime string
 * @returns Formatted string for datetime-local input (YYYY-MM-DDTHH:mm)
 */
function formatDateTimeForInput(isoString?: string): string {
  if (!isoString) return '';
  
  const date = new Date(isoString);
  if (isNaN(date.getTime())) return '';
  
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  
  return `${year}-${month}-${day}T${hours}:${minutes}`;
}
</file>

<file path="components/forms/TicketTypesForm.tsx">
// components/forms/TicketTypeForm.tsx
import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { Input } from '@/components/common/Input';
import { Button } from '@/components/common/Button';
import { Card } from '@/components/common/Card';

export interface TicketTypeData {
  name: string;
  description?: string;
  price: number;
  quantity: number;
  saleStartDate?: string;  // Optional - can use event defaults
  saleEndDate?: string;    // Optional - can use event defaults
}

interface TicketTypeFormProps {
  onAddTicketType: (data: TicketTypeData) => void;
  onCancel?: () => void;
  defaultSaleStartDate?: string;
  defaultSaleEndDate?: string;
}

export const TicketTypeForm = ({
  onAddTicketType,
  onCancel,
  defaultSaleStartDate,
  defaultSaleEndDate
}: TicketTypeFormProps) => {
  const { register, handleSubmit, formState: { errors } } = useForm<TicketTypeData>({
    defaultValues: {
      saleStartDate: defaultSaleStartDate,
      saleEndDate: defaultSaleEndDate
    }
  });

  const [useCustomDates, setUseCustomDates] = useState(false);

  const onSubmit = (data: TicketTypeData) => {
    // If not using custom dates, clear them
    if (!useCustomDates) {
      data.saleStartDate = undefined;
      data.saleEndDate = undefined;
    }
    onAddTicketType(data);
  };

  return (
    <Card className="mb-4">
      <h3 className="text-lg font-semibold mb-4">Add Ticket Type</h3>
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <Input
            label="Ticket Name *"
            {...register('name', { required: 'Name is required' })}
            error={errors.name?.message}
            placeholder="e.g., General Admission"
          />

          <Input
            label="Price ($) *"
            type="number"
            step="0.01"
            min="0"
            {...register('price', {
              required: 'Price is required',
              min: { value: 0, message: 'Price must be positive' },
              valueAsNumber: true
            })}
            error={errors.price?.message}
          />
        </div>

        <Input
          label="Description"
          {...register('description')}
          placeholder="What does this ticket include?"
        />

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <Input
            label="Quantity Available *"
            type="number"
            min="1"
            {...register('quantity', {
              required: 'Quantity is required',
              min: { value: 1, message: 'At least 1 ticket required' },
              valueAsNumber: true
            })}
            error={errors.quantity?.message}
          />
        </div>

        {/* Custom Sales Dates Toggle */}
        <div className="pt-2 border-t">
          <label className="flex items-center space-x-2 cursor-pointer">
            <input
              type="checkbox"
              checked={useCustomDates}
              onChange={(e) => setUseCustomDates(e.target.checked)}
              className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
            />
            <span className="text-sm font-medium text-gray-700">
              Set custom sales dates for this ticket type
            </span>
          </label>

          <p className="text-sm text-gray-500 mt-1 mb-3">
            If unchecked, will use the event's sales period
          </p>
        </div>

        {/* Custom Sales Dates (Conditional) */}
        {useCustomDates && (
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-3 bg-gray-50 rounded-lg">
            <Input
              label="Sales Start Date"
              type="datetime-local"
              {...register('saleStartDate')}
            />

            <Input
              label="Sales End Date"
              type="datetime-local"
              {...register('saleEndDate')}
            />
          </div>
        )}

        <div className="flex justify-end space-x-2 pt-4 border-t">
          {onCancel && (
            <Button type="button" variant="outline" onClick={onCancel}>
              Cancel
            </Button>
          )}
          <Button type="submit">Add Ticket Type</Button>
        </div>
      </form>
    </Card>
  );
};
</file>

<file path="components/layout/EventForm.tsx">

</file>

<file path="components/layout/Header.tsx">
import { Link } from 'react-router-dom';
import { useAuth } from '@/hooks/useAuth';
import { Button } from '@/components/common/Button';

export const Header = () => {
  const { user, logout } = useAuth();

  return (
    <header className="bg-white shadow-sm border-b">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          <div className="flex items-center">
            <Link to="/" className="text-xl font-bold text-blue-600">
              Event Platform
            </Link>
          </div>

          <nav className="flex items-center space-x-4">
            {user && (
              <>
                <span className="text-sm text-gray-700">{user.name || user.email}</span>
                <Button variant="outline" size="sm" onClick={logout}>
                  Logout
                </Button>
              </>
            )}
          </nav>
        </div>
      </div>
    </header>
  );
};
</file>

<file path="components/layout/PageContainer.tsx">
import { Outlet } from 'react-router-dom';
import { Header } from './Header';
import { Sidebar } from './Sidebar';

export const PageContainer = () => {
  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <div className="flex">
        <Sidebar />
        <main className="flex-1 p-6">
          <Outlet />
        </main>
      </div>
    </div>
  );
};
</file>

<file path="components/layout/Sidebar.tsx">
import { Link, useLocation } from 'react-router-dom';
import { useAuth } from '@/context/AuthContext';
import { isOrganiser, isStaff } from '@/utils/roles';
import { redirectToKeycloakLogin } from '@/services/keycloakService';

export const Sidebar = () => {
  const location = useLocation();
  const { user } = useAuth();

  const userIsStaff = isStaff(user);
  const userIsOrganiser = isOrganiser(user);

  // 🔒 STAFF PRIORITY RULE:
  // If user has ROLE_STAFF (even alongside ROLE_ORGANISER), they ONLY see staff items

  const navItems = [
    // ===== ORGANISER-ONLY ITEMS (hidden if user has STAFF role) =====
    { label: 'Dashboard', path: '/dashboard', show: userIsOrganiser && !userIsStaff },
    { label: 'Events', path: '/events', show: userIsOrganiser && !userIsStaff },
    { label: 'Tickets', path: '/tickets', show: userIsOrganiser && !userIsStaff },
    { label: 'Staff Management', path: '/staff', show: userIsOrganiser && !userIsStaff },
    { label: 'Analytics', path: '/analytics', show: userIsOrganiser && !userIsStaff },
    { label: 'Settings', path: '/settings', show: userIsOrganiser && !userIsStaff },

    // ===== STAFF ITEMS (shown if user has STAFF role, regardless of other roles) =====
    { label: 'Validate Tickets', path: '/staff/validation', show: userIsStaff },
  ];

  // Determine portal title based on STAFF priority
  const portalTitle = userIsStaff ? 'Staff Portal' : userIsOrganiser ? 'Organiser Portal' : 'Portal';

  /**
   * Handle Staff Portal access
   * Clears session and redirects to Keycloak login page
   */
  const handleStaffPortalAccess = async () => {
    console.log('[Sidebar] Staff Portal access clicked - clearing session');

    // Clear current session
    localStorage.removeItem('keycloak_token');
    localStorage.removeItem('keycloak_user');
    localStorage.removeItem('kc_state');
    localStorage.removeItem('kc_code_verifier');

    // Redirect to Keycloak login (force login screen)
    await redirectToKeycloakLogin({ prompt: 'login' });
  };

  return (
    <aside className="w-64 bg-gray-50 border-r min-h-screen flex flex-col">
      <nav className="p-4 flex-1">
        <div className="mb-6 px-4">
          <h2 className="text-xs font-semibold text-gray-500 uppercase tracking-wider">
            {portalTitle}
          </h2>
          {userIsStaff && (
            <p className="text-xs text-gray-400 mt-1">
              Ticket Validation Only
            </p>
          )}
        </div>
        <ul className="space-y-2">
          {navItems.filter(item => item.show).map((item) => {
            const isActive = location.pathname === item.path ||
              (item.path !== '/' && location.pathname.startsWith(item.path));
            return (
              <li key={item.path}>
                <Link
                  to={item.path}
                  className={`block px-4 py-2 rounded-lg transition-colors ${isActive
                    ? 'bg-blue-600 text-white'
                    : 'text-gray-700 hover:bg-gray-200'
                    }`}
                >
                  {item.label}
                </Link>
              </li>
            );
          })}

          {/* ===== STAFF PORTAL ACCESS (for Organisers only) ===== */}
          {userIsOrganiser && !userIsStaff && (
            <>
              {/* Divider */}
              <li className="my-4">
                <hr className="border-gray-200" />
              </li>
              {/* Staff Portal Button */}
              <li>
                <button
                  onClick={handleStaffPortalAccess}
                  className="w-full flex items-center gap-3 px-4 py-3 text-left bg-purple-600 text-white hover:bg-purple-700 rounded-lg transition-colors shadow-sm"
                >
                  <svg
                    className="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"
                    />
                  </svg>
                  <span className="font-medium">Staff Portal</span>
                </button>
                <p className="text-xs text-gray-400 mt-1 px-4">
                  Access ticket validation
                </p>
              </li>
            </>
          )}
        </ul>
      </nav>
    </aside>
  );
};
</file>

<file path="components/layout/StaffLayout.tsx">
import { Outlet } from 'react-router-dom';
import { useAuth } from '@/context/AuthContext';

/**
 * Minimal layout for STAFF users.
 * Staff experience a single-purpose ticket scanning application.
 * No navigation, no browse, no tickets - just validation.
 */
export const StaffLayout = () => {
    const { user, logout } = useAuth();

    return (
        <div className="min-h-screen bg-gray-100">
            {/* Minimal Header */}
            <header className="bg-white shadow-sm border-b">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex justify-between items-center h-16">
                        {/* Logo / Title */}
                        <div className="flex items-center">
                            <div className="flex-shrink-0">
                                <span className="text-xl font-bold text-blue-600">EventHub</span>
                                <span className="ml-2 text-sm text-gray-500 font-medium">Staff Portal</span>
                            </div>
                        </div>

                        {/* User Info & Logout */}
                        <div className="flex items-center gap-4">
                            <div className="text-right">
                                <p className="text-sm font-medium text-gray-900">{user?.name || user?.username || 'Staff'}</p>
                                <p className="text-xs text-gray-500">Ticket Validation</p>
                            </div>
                            <button
                                onClick={logout}
                                className="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                            >
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            {/* Main Content - No sidebar, full width */}
            <main className="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                <Outlet />
            </main>

            {/* Footer */}
            <footer className="fixed bottom-0 left-0 right-0 bg-white border-t py-3">
                <div className="max-w-7xl mx-auto px-4 text-center">
                    <p className="text-xs text-gray-400">
                        Staff Validation Terminal • Scan or search tickets to validate entry
                    </p>
                </div>
            </footer>
        </div>
    );
};
</file>

<file path="components/modals/StaffDetailModal.tsx">
import { useState, useEffect } from 'react';
import { organiserDashboardApi } from '@/api/endpoints/organiser';
import { ValidationHistory } from '@/types';
import { Button } from '@/components/common/Button';
import { Spinner } from '@/components/feedback/Spinner';
import { format } from 'date-fns';

interface StaffDetailModalProps {
    isOpen: boolean;
    onClose: () => void;
    eventId: string;
    staffUserId: string;
    staffName: string;
}

export const StaffDetailModal = ({ isOpen, onClose, eventId, staffUserId, staffName }: StaffDetailModalProps) => {
    const [history, setHistory] = useState<ValidationHistory[]>([]);
    const [isLoading, setIsLoading] = useState(true);

    useEffect(() => {
        if (isOpen && eventId && staffUserId) {
            const fetchHistory = async () => {
                try {
                    setIsLoading(true);
                    const response = await organiserDashboardApi.getStaffValidationDetails(eventId, staffUserId);
                    // Handle pagination if response is wrapped, or direct array
                    // Assuming the API might return Page<ValidationHistory> or ValidationHistory[]
                    // We'll safely check for .content
                    setHistory(Array.isArray(response) ? response : (response as any).content || []);
                } catch (err) {
                    console.error('Failed to fetch staff history', err);
                } finally {
                    setIsLoading(false);
                }
            };
            fetchHistory();
        }
    }, [isOpen, eventId, staffUserId]);

    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
            <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[80vh]">

                {/* Header */}
                <div className="px-6 py-4 border-b flex justify-between items-center bg-gray-50">
                    <h3 className="text-lg font-bold text-gray-900">Validation History: <span className="text-blue-600">{staffName}</span></h3>
                    <button onClick={onClose} className="text-gray-400 hover:text-gray-600">✕</button>
                </div>

                {/* Content */}
                <div className="p-6 overflow-y-auto flex-1">
                    {isLoading ? (
                        <div className="flex justify-center py-8"><Spinner size="md" /></div>
                    ) : history.length === 0 ? (
                        <p className="text-center text-gray-500">No validations found for this staff member.</p>
                    ) : (
                        <div className="space-y-4">
                            {history.map((record) => (
                                <div key={record.validationId} className="flex justify-between items-center p-3 border rounded-lg hover:bg-gray-50">
                                    <div>
                                        <p className="font-medium text-gray-900">{record.attendeeName}</p>
                                        <p className="text-sm text-gray-500">{record.attendeeEmail} • {record.ticketTypeName}</p>
                                    </div>
                                    <div className="text-right">
                                        <span className={`inline-block px-2 py-1 rounded text-xs font-semibold ${record.validationStatus === 'VALID' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`}>
                                            {record.validationStatus}
                                        </span>
                                        <p className="text-xs text-gray-400 mt-1">
                                            {format(new Date(record.validatedAt), 'PP p')}
                                        </p>
                                        <p className="text-xs text-gray-400 uppercase tracking-wider">{record.validationMethod}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>

                {/* Footer */}
                <div className="px-6 py-4 border-t bg-gray-50 flex justify-end">
                    <Button variant="outline" onClick={onClose}>Close</Button>
                </div>

            </div>
        </div>
    );
};
</file>

<file path="components/organiser/analytics/AnalyticsPanel.tsx">
import { EventAnalyticsDto } from '@/types/analytics';

interface AnalyticsPanelProps {
    analytics: EventAnalyticsDto | null;
}

interface MetricBoxProps {
    label: string;
    value: string | number;
}

const MetricBox = ({ label, value }: MetricBoxProps) => (
    <div className="bg-gray-50 p-4 rounded-lg">
        <p className="text-sm text-gray-500 font-medium">{label}</p>
        <p className="text-xl font-bold text-gray-900 mt-1">{value}</p>
    </div>
);

export const AnalyticsPanel = ({ analytics }: AnalyticsPanelProps) => {
    if (!analytics) return null;

    return (
        <div className="bg-white rounded-lg shadow-lg p-6 space-y-6">
            <h2 className="text-2xl font-bold">Complete Event Analytics</h2>

            {/* Overall Metrics */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <MetricBox label="Tickets Sold" value={analytics.totalTicketsSold} />
                <MetricBox label="Revenue" value={`$${analytics.totalRevenue.toLocaleString()}`} />
                <MetricBox label="Attendees" value={analytics.totalAttendeesValidated} />
                <MetricBox label="Attendance Rate" value={`${analytics.overallAttendanceRate.toFixed(1)}%`} />
            </div>

            {/* Ticket Type Table */}
            <div>
                <h3 className="text-xl font-semibold mb-4">Ticket Type Breakdown</h3>
                <div className="overflow-x-auto">
                    <table className="w-full border-collapse">
                        <thead>
                            <tr className="bg-gray-100 border-b">
                                <th className="p-3 text-left font-medium text-gray-700">Ticket Type</th>
                                <th className="p-3 text-right font-medium text-gray-700">Price</th>
                                <th className="p-3 text-right font-medium text-gray-700">Sold</th>
                                <th className="p-3 text-right font-medium text-gray-700">Revenue</th>
                                <th className="p-3 text-right font-medium text-gray-700">Validated</th>
                                <th className="p-3 text-right font-medium text-gray-700">Rate</th>
                                <th className="p-3 text-right font-medium text-gray-700">Remaining</th>
                            </tr>
                        </thead>
                        <tbody>
                            {analytics.ticketTypeAnalytics.map((type) => (
                                <tr key={type.ticketTypeId} className="border-b hover:bg-gray-50">
                                    <td className="p-3 font-semibold">{type.ticketTypeName}</td>
                                    <td className="p-3 text-right">${type.price}</td>
                                    <td className="p-3 text-right">{type.ticketsSold}</td>
                                    <td className="p-3 text-right text-green-600 font-medium">${type.revenue.toLocaleString()}</td>
                                    <td className="p-3 text-right">{type.attendeesValidated}</td>
                                    <td className="p-3 text-right">{type.attendanceRate.toFixed(1)}%</td>
                                    <td className="p-3 text-right">{type.remainingTickets}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
};
</file>

<file path="components/organiser/analytics/DashboardOverview.tsx">
import { useEffect, useState } from 'react';
import { analyticsApi } from '@/api/endpoints/analytics';
import { AnalyticsSummary } from '@/types/analytics';
import { MetricCard } from './MetricCard';
import { Spinner } from '@/components/feedback/Spinner';

export const DashboardOverview = () => {
    const [analytics, setAnalytics] = useState<AnalyticsSummary | null>(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);

    useEffect(() => {
        fetchAnalytics();

        // Auto-refresh every 30 seconds
        const interval = setInterval(fetchAnalytics, 30000);
        return () => clearInterval(interval);
    }, []);

    const fetchAnalytics = async () => {
        try {
            setError(null);
            console.log('Fetching analytics summary...');
            const data = await analyticsApi.getSummary();
            console.log('Received analytics data:', data);
            setAnalytics(data);
        } catch (err: any) {
            console.error('Failed to fetch analytics:', err);
            setError(err.message || 'Failed to load data');
        } finally {
            setLoading(false);
        }
    };

    if (loading) return <div className="flex justify-center p-8"><Spinner /></div>;

    if (error) {
        return (
            <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-8 text-center text-red-600">
                <p>Failed to load analytics: {error}</p>
                <button
                    onClick={() => { setLoading(true); fetchAnalytics(); }}
                    className="mt-2 text-sm font-medium underline hover:text-red-800"
                >
                    Retry
                </button>
            </div>
        );
    }

    return (
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <MetricCard
                title="Total Events"
                value={analytics?.totalEvents || 0}
                icon={
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                }
                description={`${analytics?.publishedEvents || 0} published`}
            />
            <MetricCard
                title="Total Tickets Sold"
                value={analytics?.totalTicketsSold || 0}
                icon={
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                    </svg>
                }
            />
            <MetricCard
                title="Total Revenue"
                value={`$${analytics?.totalRevenue?.toLocaleString() || 0}`}
                icon={
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                }
                highlight
            />
            <MetricCard
                title="Total Attendees"
                value={analytics?.totalAttendeesValidated || 0}
                icon={
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                }
                description={`${analytics?.averageAttendanceRate?.toFixed(1) || 0}% avg rate`}
            />
        </div>
    );
};
</file>

<file path="components/organiser/analytics/DrillDownSection.tsx">
import { EventAnalyticsDto } from '@/types/analytics';

interface DrillDownProps {
    type: 'revenue' | 'attendees' | 'tickets';
    analytics: EventAnalyticsDto | null;
    onClose: () => void;
}

export const DrillDownSection = ({ type, analytics, onClose }: DrillDownProps) => {
    const renderContent = () => {
        if (!analytics) return null;

        switch (type) {
            case 'revenue':
                return (
                    <div className="space-y-4">
                        <h3 className="text-xl font-bold">Revenue Breakdown by Ticket Type</h3>
                        {analytics.ticketTypeAnalytics.map((ticketType) => (
                            <div key={ticketType.ticketTypeId} className="flex justify-between p-4 bg-gray-50 rounded">
                                <span className="font-semibold">{ticketType.ticketTypeName}</span>
                                <div className="text-right">
                                    <div className="text-green-600 font-bold">
                                        ${ticketType.revenue.toLocaleString()}
                                    </div>
                                    <div className="text-sm text-gray-600">
                                        {ticketType.ticketsSold} tickets × ${ticketType.price}
                                    </div>
                                </div>
                            </div>
                        ))}
                        <div className="border-t pt-4 flex justify-between font-bold text-lg">
                            <span>Total Revenue</span>
                            <span className="text-green-600">${analytics.totalRevenue.toLocaleString()}</span>
                        </div>
                    </div>
                );

            case 'attendees':
                return (
                    <div className="space-y-4">
                        <h3 className="text-xl font-bold">Attendees by Ticket Type</h3>
                        {analytics.ticketTypeAnalytics.map((ticketType) => (
                            <div key={ticketType.ticketTypeId} className="flex justify-between p-4 bg-gray-50 rounded">
                                <span className="font-semibold">{ticketType.ticketTypeName}</span>
                                <div className="text-right">
                                    <div className="font-bold">
                                        {ticketType.attendeesValidated} / {ticketType.ticketsSold}
                                    </div>
                                    <div className="text-sm text-gray-600">
                                        {ticketType.attendanceRate.toFixed(1)}% attendance
                                    </div>
                                </div>
                            </div>
                        ))}
                        <div className="border-t pt-4 flex justify-between font-bold text-lg">
                            <span>Total Attendees</span>
                            <span>{analytics.totalAttendeesValidated}</span>
                        </div>
                    </div>
                );

            case 'tickets':
                return (
                    <div className="space-y-4">
                        <h3 className="text-xl font-bold">Tickets Sold by Type</h3>
                        {analytics.ticketTypeAnalytics.map((ticketType) => (
                            <div key={ticketType.ticketTypeId} className="flex justify-between p-4 bg-gray-50 rounded">
                                <span className="font-semibold">{ticketType.ticketTypeName}</span>
                                <div className="text-right">
                                    <div className="font-bold">{ticketType.ticketsSold} sold</div>
                                    <div className="text-sm text-gray-600">
                                        {ticketType.remainingTickets} remaining
                                    </div>
                                    <div className="text-xs text-gray-500">
                                        out of {ticketType.totalAvailable || 'unlimited'}
                                    </div>
                                </div>
                            </div>
                        ))}
                        <div className="border-t pt-4 flex justify-between font-bold text-lg">
                            <span>Total Tickets Sold</span>
                            <span>{analytics.totalTicketsSold}</span>
                        </div>
                    </div>
                );
        }
    };

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                <button
                    onClick={onClose}
                    className="float-right text-gray-600 hover:text-gray-800 p-1"
                >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                {renderContent()}
            </div>
        </div>
    );
};
</file>

<file path="components/organiser/analytics/EventDetailsSummary.tsx">
import { useEffect, useState } from 'react';
import { useParams } from 'react-router-dom';
import { analyticsApi } from '@/api/endpoints/analytics';
import { EventAnalyticsDto } from '@/types/analytics';
import { Spinner } from '@/components/feedback/Spinner';
import { DrillDownSection } from './DrillDownSection';
import { AnalyticsPanel } from './AnalyticsPanel';
import { Card } from '@/components/common/Card';

interface SummaryCardProps {
    title: string;
    value: string | number;
    subtitle?: string;
    icon?: React.ReactNode;
    onClick?: () => void;
    clickable?: boolean;
}

const SummaryCard = ({ title, value, subtitle, icon, onClick, clickable }: SummaryCardProps) => (
    <Card
        className={`p-6 shadow-sm transition-all ${clickable ? 'cursor-pointer hover:shadow-md hover:border-gray-300' : ''}`}
        onClick={onClick}
    >
        <div className="flex justify-between items-start">
            <div>
                <h3 className="text-sm font-medium text-gray-500 uppercase tracking-wider">{title}</h3>
                <p className="text-3xl font-bold text-gray-900 mt-2">{value}</p>
                {subtitle && <p className="text-sm text-gray-500 mt-1">{subtitle}</p>}
                {clickable && <p className="text-xs text-blue-600 mt-3 font-medium">Click to see breakdown</p>}
            </div>
            {icon && (
                <div className="p-3 bg-gray-100 rounded-lg text-gray-600">
                    {icon}
                </div>
            )}
        </div>
    </Card>
);

export const EventDetailsSummary = () => {
    const { eventId } = useParams<{ eventId: string }>();
    const [analytics, setAnalytics] = useState<EventAnalyticsDto | null>(null);
    const [loading, setLoading] = useState(true);
    const [selectedDrillDown, setSelectedDrillDown] = useState<'revenue' | 'attendees' | 'tickets' | null>(null);
    const [showAnalytics, setShowAnalytics] = useState(false);

    useEffect(() => {
        if (eventId) {
            fetchEventAnalytics();

            // Auto-refresh every 30 seconds
            const interval = setInterval(fetchEventAnalytics, 30000);
            return () => clearInterval(interval);
        }
    }, [eventId]);

    const fetchEventAnalytics = async () => {
        try {
            const data = await analyticsApi.getEventAnalytics(eventId!);
            setAnalytics(data);
        } catch (error) {
            console.error('Failed to fetch event analytics:', error);
        } finally {
            setLoading(false);
        }
    };

    if (loading) return <div className="flex justify-center p-8"><Spinner /></div>;

    return (
        <div className="space-y-6 mb-8">
            {/* Summary Cards Row */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <SummaryCard
                    title="Total Revenue"
                    value={`$${analytics?.totalRevenue?.toLocaleString() || 0}`}
                    icon={
                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    }
                    onClick={() => setSelectedDrillDown('revenue')}
                    clickable
                />
                <SummaryCard
                    title="Total Attendees"
                    value={analytics?.totalAttendeesValidated || 0}
                    subtitle={`${analytics?.overallAttendanceRate?.toFixed(1) || 0}% attendance rate`}
                    icon={
                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    }
                    onClick={() => setSelectedDrillDown('attendees')}
                    clickable
                />
                <SummaryCard
                    title="Total Tickets Sold"
                    value={analytics?.totalTicketsSold || 0}
                    icon={
                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                        </svg>
                    }
                    onClick={() => setSelectedDrillDown('tickets')}
                    clickable
                />
            </div>

            {/* Analytics Button */}
            <div className="flex justify-start">
                <button
                    onClick={() => setShowAnalytics(!showAnalytics)}
                    className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-medium flex items-center shadow-sm"
                >
                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    {showAnalytics ? 'Hide Full Analytics' : 'Show Full Analytics'}
                </button>
            </div>

            {/* Drill-down Modal/Section */}
            {selectedDrillDown && (
                <DrillDownSection
                    type={selectedDrillDown}
                    analytics={analytics}
                    onClose={() => setSelectedDrillDown(null)}
                />
            )}

            {/* Full Analytics Panel */}
            {showAnalytics && (
                <AnalyticsPanel analytics={analytics} />
            )}
        </div>
    );
};
</file>

<file path="components/organiser/analytics/MetricCard.tsx">
import { ReactNode } from 'react';
import { Card } from '@/components/common/Card';

interface MetricCardProps {
    title: string;
    value: string | number;
    icon?: ReactNode;
    description?: string;
    trend?: string;
    highlight?: boolean;
}

export const MetricCard = ({ title, value, icon, description, trend, highlight }: MetricCardProps) => {
    return (
        <Card className={`p-6 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden ${highlight ? 'border-l-4 border-green-500 bg-green-50/30' : ''}`}>
            <div className="flex justify-between items-start">
                <div className="space-y-2">
                    <h3 className="text-sm font-medium text-gray-500 uppercase tracking-wider">{title}</h3>
                    <div className="flex items-baseline gap-2">
                        <p className={`text-3xl font-bold ${highlight ? 'text-green-700' : 'text-gray-900'}`}>{value}</p>
                    </div>
                    {(description || trend) && (
                        <div className="flex flex-col gap-1">
                            {description && <p className="text-sm text-gray-500">{description}</p>}
                            {trend && <p className="text-sm font-medium text-green-600">{trend}</p>}
                        </div>
                    )}
                </div>
                {icon && (
                    <div className={`p-3 rounded-lg ${highlight ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600'}`}>
                        {icon}
                    </div>
                )}
            </div>
        </Card>
    );
};
</file>

<file path="components/QRScanner.tsx">
import { useState, useEffect } from 'react';
import { Scanner } from '@yudiel/react-qr-scanner';
import { Card } from '@/components/common/Card';
import { Button } from '@/components/common/Button';
import { Input } from '@/components/common/Input';
import { staffValidationApi } from '@/api/endpoints/staff';
import { TicketValidationResponse, TicketSearchResult } from '@/types';

interface QRScannerProps {
  onValidationComplete?: (result: TicketValidationResponse) => void;
  onError?: (error: string) => void;
}

export const QRScanner = ({ onValidationComplete, onError }: QRScannerProps) => {
  const [mode, setMode] = useState<'QR' | 'MANUAL'>('QR');

  // QR State
  const [isValidating, setIsValidating] = useState(false);
  const [scannedResult, setScannedResult] = useState<string | null>(null);
  const [manualCode, setManualCode] = useState('');

  // Manual & Search State
  const [searchTerm, setSearchTerm] = useState('');
  const [isSearching, setIsSearching] = useState(false);
  const [searchResults, setSearchResults] = useState<TicketSearchResult[]>([]);
  const [selectedTicket, setSelectedTicket] = useState<TicketSearchResult | null>(null);

  // Debounce scanning to prevent rapid duplicate calls
  useEffect(() => {
    if (scannedResult) {
      handleScanValidation(scannedResult);
      const timer = setTimeout(() => setScannedResult(null), 2000);
      return () => clearTimeout(timer);
    }
  }, [scannedResult]);

  // Handler for QR Scans (hits /scan endpoint)
  const handleScanValidation = async (code: string) => {
    if (!code || isValidating) return;

    try {
      setIsValidating(true);
      const output = await staffValidationApi.validateByQR(code);
      onValidationComplete?.(output);
      // Reset states
      setSelectedTicket(null);
      setSearchResults([]);
      setSearchTerm('');
    } catch (err: any) {
      handleValidationError(err);
    } finally {
      setIsValidating(false);
    }
  };

  // Handler for Manual Entry - typed or selected (hits /manual endpoint)
  const handleManualEntryValidation = async (code: string) => {
    if (!code || isValidating) return;

    try {
      setIsValidating(true);
      const output = await staffValidationApi.validateManually(code);
      onValidationComplete?.(output);
      // Reset states
      setSelectedTicket(null);
      setSearchResults([]);
      setSearchTerm('');
      setManualCode('');
    } catch (err: any) {
      handleValidationError(err);
    } finally {
      setIsValidating(false);
    }
  };

  const handleValidationError = (err: any) => {
    console.error('Validation error:', err);
    let errorMessage = err.message || 'Validation failed';

    if (errorMessage.includes('expired')) {
      errorMessage = "QR code has expired. Please ask attendee to regenerate.";
    } else if (errorMessage.includes('already used')) {
      errorMessage = "Ticket already used or invalid";
    } else if (errorMessage.includes('cancelled')) {
      errorMessage = "Ticket has been cancelled";
    } else if (errorMessage.includes('different event')) {
      errorMessage = "This ticket is for a different event";
    } else if (errorMessage.includes('not found')) {
      errorMessage = "Ticket not found";
    }

    onError?.(errorMessage);
  };

  const handleSearch = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!searchTerm.trim()) return;

    try {
      setIsSearching(true);
      setSearchResults([]);
      setSelectedTicket(null);
      const results = await staffValidationApi.searchTicket(searchTerm);
      if (results.length === 0) {
        onError?.("No tickets found matching your search.");
      }
      setSearchResults(results);
    } catch (err: any) {
      onError?.("Search failed. Please try again.");
    } finally {
      setIsSearching(false);
    }
  };

  const handleManualValidate = async () => {
    if (!selectedTicket) return;
    try {
      setIsValidating(true);
      // Use qrCode (publicCode) for manual validation, matching backend contract
      const output = await staffValidationApi.validateManually(selectedTicket.qrCode);
      onValidationComplete?.(output);
      setSearchResults([]);
      setSelectedTicket(null);
      setSearchTerm('');
    } catch (err: any) {
      let errorMessage = err.message || 'Validation failed';
      if (errorMessage.includes('already used')) errorMessage = "Ticket has already been used for entry";
      onError?.(errorMessage);
    } finally {
      setIsValidating(false);
    }
  };


  return (
    <div className="space-y-6">
      {/* Tab Switcher */}
      <div className="flex bg-gray-100 p-1 rounded-lg w-fit mx-auto md:mx-0">
        <button
          onClick={() => { setMode('QR'); setSelectedTicket(null); setSearchResults([]); }}
          className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${mode === 'QR'
            ? 'bg-white text-gray-900 shadow-sm'
            : 'text-gray-500 hover:text-gray-700'
            }`}
        >
          QR Scanner
        </button>
        <button
          onClick={() => setMode('MANUAL')}
          className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${mode === 'MANUAL'
            ? 'bg-white text-gray-900 shadow-sm'
            : 'text-gray-500 hover:text-gray-700'
            }`}
        >
          Manual Search
        </button>
      </div>

      <Card className="p-6">
        {mode === 'QR' ? (
          <div className="space-y-4">
            <div className="aspect-square bg-gray-900 rounded-lg overflow-hidden relative max-w-sm mx-auto">
              <Scanner
                onScan={(results) => {
                  if (results && results.length > 0) {
                    if (results[0].rawValue !== scannedResult) {
                      setScannedResult(results[0].rawValue);
                    }
                  }
                }}
                onError={(error: any) => console.log(error?.message)}
              />
              {isValidating && (
                <div className="absolute inset-0 flex items-center justify-center bg-black/50 text-white z-10">
                  Validating...
                </div>
              )}
              {/* Scan Area Overlay */}
              <div className="absolute inset-0 border-2 border-white/30 pointer-events-none">
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 border-2 border-blue-500 rounded-lg"></div>
              </div>
            </div>
            <p className="text-center text-sm text-gray-500">
              Point camera at ticket QR code
            </p>

            <div className="relative py-2">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-gray-200"></div>
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-2 bg-white text-gray-500">Or enter code manually</span>
              </div>
            </div>

            <form
              onSubmit={(e) => {
                e.preventDefault();
                // Use manual entry handler (hits /manual)
                handleManualEntryValidation(manualCode);
              }}
              className="flex gap-2"
            >
              <Input
                placeholder="Enter code (e.g. 8x29b...)"
                value={manualCode}
                onChange={(e) => setManualCode(e.target.value)}
                className="flex-1"
              />
              <Button
                type="submit"
                disabled={!manualCode.trim() || isValidating}
                isLoading={isValidating}
              >
                Validate
              </Button>
            </form>
          </div>
        ) : (
          <div className="space-y-6 max-w-md mx-auto">
            {/* Search Form */}
            <form onSubmit={handleSearch} className="flex gap-2">
              <Input
                placeholder="Enter QR code (publicCode)"
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="flex-1"
                autoFocus
              />
              <Button
                type="submit"
                isLoading={isSearching}
                disabled={!searchTerm.trim()}
              >
                Search
              </Button>
            </form>

            {/* Results List */}
            {searchResults.length > 0 && !selectedTicket && (
              <div className="border rounded-md divide-y max-h-60 overflow-y-auto">
                {searchResults.map(ticket => (
                  <div
                    key={ticket.ticketId}
                    className="p-3 hover:bg-gray-50 flex justify-between items-center cursor-pointer"
                    onClick={() => setSelectedTicket(ticket)}
                  >
                    <div>
                      <div className="font-medium text-gray-900">{ticket.attendeeName}</div>
                      <div className="text-xs text-gray-500">{ticket.ticketType} • {ticket.status}</div>
                    </div>
                    <Button size="sm" variant="outline">Select</Button>
                  </div>
                ))}
              </div>
            )}

            {/* Selected Ticket Preview */}
            {selectedTicket && (
              <div className="bg-gray-50 rounded-lg p-4 space-y-4 border border-blue-200">
                <div className="flex justify-between items-start">
                  <div>
                    <h4 className="font-bold text-lg text-gray-900">{selectedTicket.attendeeName}</h4>
                    <p className="text-sm text-gray-600">{selectedTicket.attendeeEmail}</p>
                  </div>
                  <button
                    onClick={() => setSelectedTicket(null)}
                    className="text-gray-400 hover:text-gray-600"
                  >
                    ✕
                  </button>
                </div>

                <div className="grid grid-cols-2 gap-2 text-sm">
                  <div className="bg-white p-2 rounded border">
                    <span className="text-xs text-gray-500 block">Type</span>
                    <span className="font-medium">{selectedTicket.ticketType}</span>
                  </div>
                  <div className="bg-white p-2 rounded border">
                    <span className="text-xs text-gray-500 block">Status</span>
                    <span className={`font-medium ${selectedTicket.status === 'PURCHASED' ? 'text-green-600' : 'text-yellow-600'}`}>
                      {selectedTicket.status}
                    </span>
                  </div>
                </div>

                <Button
                  className="w-full"
                  onClick={handleManualValidate}
                  isLoading={isValidating}
                  disabled={selectedTicket.status !== 'PURCHASED'}
                >
                  Confirm Validation
                </Button>
              </div>
            )}

            {!selectedTicket && searchResults.length === 0 && !isSearching && searchTerm && (
              <p className="text-center text-sm text-gray-500 mt-4">
                Enter a valid search term to find tickets.
              </p>
            )}

          </div>
        )}
      </Card>
    </div>
  );
};
</file>

<file path="config/keycloak.ts">
// Keycloak Configuration
export const keycloakConfig = {
  url: 'http://localhost:9090',
  realm: 'event-ticket-platform',
  clientId: 'event-ticket-platform-app',
  redirectUri: 'http://localhost:5173/callback',
};

// Keycloak endpoints
export const keycloakEndpoints = {
  authorization: `${keycloakConfig.url}/realms/${keycloakConfig.realm}/protocol/openid-connect/auth`,
  token: `${keycloakConfig.url}/realms/${keycloakConfig.realm}/protocol/openid-connect/token`,
  logout: `${keycloakConfig.url}/realms/${keycloakConfig.realm}/protocol/openid-connect/logout`,
  userInfo: `${keycloakConfig.url}/realms/${keycloakConfig.realm}/protocol/openid-connect/userinfo`,
};
</file>

<file path="context/AuthContext.tsx">
import { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import { User } from '@/types';
import { logoutFromKeycloak, redirectToKeycloakLogin } from '@/services/keycloakService';

interface AuthContextType {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  setAuth: (user: User | null, token: string | null) => void;
  login: () => void;          // ✅ ADD THIS
  logout: () => void;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const [user, setUser] = useState<User | null>(null);
  const [token, setToken] = useState<string | null>(null);
  const [isInitialized, setIsInitialized] = useState(false);

  // Initialize auth state from localStorage (set by Keycloak callback)
  useEffect(() => {
    const storedToken = localStorage.getItem('keycloak_token');
    const storedUser = localStorage.getItem('keycloak_user');

    if (storedToken) {
      setToken(storedToken);
    }

    if (storedUser) {
      try {
        setUser(JSON.parse(storedUser));
      } catch (error) {
        console.error('Failed to parse user data:', error);
      }
    }

    setIsInitialized(true);
  }, []);

  const setAuth = (newUser: User | null, newToken: string | null) => {
    setUser(newUser);
    setToken(newToken);

    if (newToken) {
      localStorage.setItem('keycloak_token', newToken);
    } else {
      localStorage.removeItem('keycloak_token');
    }

    if (newUser) {
      localStorage.setItem('keycloak_user', JSON.stringify(newUser));
    } else {
      localStorage.removeItem('keycloak_user');
    }
  };

  const logout = () => {
    setUser(null);
    setToken(null);
    logoutFromKeycloak();
  };

  const login = () => {
    console.log('Redirecting to Keycloak...');
    redirectToKeycloakLogin();
  };


  const value: AuthContextType = {
    user,
    token,
    isAuthenticated: !!token && !!user,
    setAuth,
    login,
    logout,
  };

  // Don't render children until auth state is initialized
  if (!isInitialized) {
    return null; // or a loading spinner
  }

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};

export const useAuth = (): AuthContextType => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};
</file>

<file path="hooks/useAuth.ts">
// Re-export useAuth from context for convenience
export { useAuth } from '@/context/AuthContext';
</file>

<file path="hooks/useLocalStorage.ts">
import { useState } from 'react';

export function useLocalStorage<T>(key: string, initialValue: T): [T, (value: T) => void] {
  // State to store our value
  const [storedValue, setStoredValue] = useState<T>(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(`Error reading localStorage key "${key}":`, error);
      return initialValue;
    }
  });

  // Return a wrapped version of useState's setter function that persists the new value to localStorage
  const setValue = (value: T) => {
    try {
      setStoredValue(value);
      window.localStorage.setItem(key, JSON.stringify(value));
    } catch (error) {
      console.error(`Error setting localStorage key "${key}":`, error);
    }
  };

  return [storedValue, setValue];
}
</file>

<file path="pages/auth/Callback.tsx">
import { useEffect, useState } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { exchangeCodeForToken, getUserInfo } from '@/services/keycloakService';
import { useAuth } from '@/hooks/useAuth';
import { User } from '@/types';
import { parseJwt } from '@/utils/jwt';
import { ROLES } from '@/utils/roles';

/**
 * Determine the redirect path based on effective role
 * Role precedence: STAFF > ORGANISER > ATTENDEE
 */
const getPostLoginRedirect = (roles: string[]): string => {
  // STAFF takes absolute precedence
  if (roles.includes(ROLES.STAFF)) {
    return '/staff/validation';
  }
  // ORGANISER is next
  if (roles.includes(ROLES.ORGANISER)) {
    return '/dashboard';
  }
  // Default: ATTENDEE or unknown → home page
  return '/';
};

export const Callback = () => {
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();
  const { setAuth } = useAuth();
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const handleCallback = async () => {
      const code = searchParams.get('code');
      const state = searchParams.get('state');
      const errorParam = searchParams.get('error');

      console.log('Callback received:', { code: !!code, state, error: errorParam });

      // Handle Keycloak errors
      if (errorParam) {
        setError(`Authentication failed: ${errorParam}`);
        setTimeout(() => {
          navigate('/');
        }, 3000);
        return;
      }

      // Validate required parameters
      if (!code) {
        console.error('Missing authorization code');
        setError('Missing authorization code');
        setTimeout(() => {
          navigate('/');
        }, 3000);
        return;
      }

      if (!state) {
        console.error('Missing state parameter');
        setError('Missing state parameter');
        setTimeout(() => {
          navigate('/');
        }, 3000);
        return;
      }

      try {
        console.log('Exchanging code for token...');
        // Exchange authorization code for access token
        const accessToken = await exchangeCodeForToken(code, state);
        console.log('Token received, fetching user info...');

        // Get user info from Keycloak
        const userInfo = await getUserInfo(accessToken);
        console.log('User info received:', userInfo);

        // Decode token to get roles
        const decodedToken = parseJwt(accessToken);
        const roles: string[] = decodedToken?.realm_access?.roles || [];

        console.log('User roles from token:', roles);

        // Map Keycloak user info to our User type
        const user: User = {
          id: userInfo.sub,
          email: userInfo.email || '',
          name: userInfo.name || userInfo.preferred_username || '',
          username: userInfo.preferred_username || '',
          roles: roles,
        };

        // Store token and user
        setAuth(user, accessToken);

        // 🔒 ROLE-BASED REDIRECT: Immediately send user to correct destination
        const redirectPath = getPostLoginRedirect(roles);
        console.log(`Authentication successful. Effective redirect: ${redirectPath}`);

        // Navigate immediately - no intermediate page
        navigate(redirectPath, { replace: true });

      } catch (err) {
        console.error('Callback error:', err);
        setError(err instanceof Error ? err.message : 'Authentication failed');
        setTimeout(() => {
          navigate('/');
        }, 3000);
      }
    };

    handleCallback();
  }, [searchParams, navigate, setAuth]);

  if (error) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center">
          <div className="mb-4">
            <svg className="mx-auto h-12 w-12 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <h2 className="text-2xl font-bold text-gray-900 mb-2">Authentication Error</h2>
          <p className="text-gray-600 mb-4">{error}</p>
          <p className="text-sm text-gray-500">Redirecting to home page...</p>
          <div className="mt-6">
            <div className="animate-spin rounded-full h-8 w-8 border-4 border-gray-200 border-t-red-600 mx-auto"></div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
      <div className="bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center">
        <div className="mb-6">
          <svg className="mx-auto h-12 w-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 className="text-2xl font-bold text-gray-900 mb-2">Completing authentication...</h2>
        <p className="text-gray-600 mb-6">Please wait while we log you in</p>
        <div className="flex justify-center">
          <div className="animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-blue-600"></div>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="pages/organiser/Events/EventCreate.tsx">
import { useNavigate } from 'react-router-dom';
import { useForm, useFieldArray } from 'react-hook-form';
import { Button } from '@/components/common/Button';
import { Input } from '@/components/common/Input';
import { Card } from '@/components/common/Card';
import { eventsApi, CreateEventDto } from '@/api/endpoints/events';

interface TicketTypeFormData {
  name: string;
  price: number;
  description?: string;
  totalAvailable?: number;
}

interface EventFormData {
  name: string;
  description: string;
  startTime: string;
  endTime: string;
  venue: string;
  eventType: string;
  salesStartDate?: string;
  salesEndDate?: string;
  ticketTypes: TicketTypeFormData[];
}

export const EventCreate = () => {
  const navigate = useNavigate();
  const {
    register,
    handleSubmit,
    control,
    formState: { errors, isSubmitting }
  } = useForm<EventFormData>({
    defaultValues: {
      name: '',
      description: '',
      startTime: '',
      endTime: '',
      venue: '',
      eventType: '',
      salesStartDate: '',
      salesEndDate: '',
      ticketTypes: [{ name: 'General Admission', price: 0, totalAvailable: 100 }]
    }
  });

  const { fields, append, remove } = useFieldArray({
    control,
    name: 'ticketTypes'
  });

  // Format date to include seconds for backend
  const formatDateForBackend = (dateString?: string): string | undefined => {
    if (!dateString || dateString.trim() === '') return undefined;

    // If time format is YYYY-MM-DDTHH:mm, add :00 seconds
    if (dateString.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/)) {
      return `${dateString}:00`;
    }

    return dateString;
  };

  const onSubmit = async (data: EventFormData) => {
    try {
      // Prepare payload matching backend DTO
      const payload: CreateEventDto = {
        name: data.name,
        description: data.description,
        startTime: formatDateForBackend(data.startTime) || '',
        endTime: formatDateForBackend(data.endTime) || '',
        venue: data.venue,
        eventType: data.eventType,
        salesStartDate: data.salesStartDate ? formatDateForBackend(data.salesStartDate) : undefined,
        salesEndDate: data.salesEndDate ? formatDateForBackend(data.salesEndDate) : undefined,
        ticketTypes: data.ticketTypes.map(ticket => ({
          name: ticket.name,
          price: Number(ticket.price),
          description: ticket.description || '',
          totalAvailable: ticket.totalAvailable ? Number(ticket.totalAvailable) : undefined
        }))
      };

      console.log('Creating event with payload:', payload);

      // Call API
      const response = await eventsApi.create(payload);
      console.log('Event created:', response);

      // Navigate to event details
      navigate(`/events/${response.id}`);
    } catch (error) {
      console.error('Failed to create event:', error);
      alert('Failed to create event. Please check the form data.');
    }
  };

  const addTicketType = () => {
    append({ name: '', price: 0 });
  };

  const removeTicketType = (index: number) => {
    if (fields.length > 1) {
      remove(index);
    }
  };

  return (
    <div>
      <h1 className="text-3xl font-bold text-gray-900 mb-6">Create Event</h1>

      <Card>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
          {/* Event Name */}
          <Input
            label="Event Name *"
            {...register('name', { required: 'Event name is required' })}
            error={errors.name?.message}
            placeholder="Enter event name"
          />

          {/* Event Description */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Description *
            </label>
            <textarea
              {...register('description', { required: 'Description is required' })}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              rows={4}
              placeholder="Describe your event"
            />
            {errors.description && (
              <p className="mt-1 text-sm text-red-600">{errors.description.message}</p>
            )}
          </div>

          {/* Event Date & Time */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <Input
              label="Start Time *"
              type="datetime-local"
              {...register('startTime', { required: 'Start time is required' })}
              error={errors.startTime?.message}
            />
            <Input
              label="End Time *"
              type="datetime-local"
              {...register('endTime', { required: 'End time is required' })}
              error={errors.endTime?.message}
            />
          </div>

          {/* Venue */}
          <Input
            label="Venue *"
            {...register('venue', { required: 'Venue is required' })}
            error={errors.venue?.message}
            placeholder="Enter venue address"
          />

          {/* Event Type */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Event Type *
            </label>
            <select
              {...register('eventType', { required: 'Event type is required' })}
              className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.eventType ? 'border-red-500' : 'border-gray-300'
                }`}
            >
              <option value="">Select event type</option>
              <option value="PERFORMANCES">Performances</option>
              <option value="EXPERIENCES">Experiences</option>
              <option value="PARTIES">Parties</option>
              <option value="SPORTS">Sports</option>
              <option value="CONFERENCES">Conferences</option>
            </select>
            {errors.eventType && (
              <p className="mt-1 text-sm text-red-600">
                {errors.eventType.message}
              </p>
            )}
          </div>


          {/* Sales Period */}
          <div className="border-t pt-6">
            <h3 className="text-lg font-medium text-gray-900 mb-4">Ticket Sales Period</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <Input
                label="Sales Start Date"
                type="datetime-local"
                {...register('salesStartDate')}
                error={errors.salesStartDate?.message}
              />
              <Input
                label="Sales End Date"
                type="datetime-local"
                {...register('salesEndDate')}
                error={errors.salesEndDate?.message}
              />
            </div>
            <p className="text-sm text-gray-500 mt-2">
              If not specified, event will be saved as DRAFT
            </p>
          </div>

          {/* Ticket Types */}
          <div className="border-t pt-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-medium text-gray-900">Ticket Types *</h3>
              <Button
                type="button"
                variant="outline"
                size="sm"
                onClick={addTicketType}
              >
                + Add Ticket Type
              </Button>
            </div>

            {fields.map((field, index) => (
              <div key={field.id} className="border rounded-lg p-4 mb-4 bg-gray-50">
                <div className="flex justify-between items-center mb-3">
                  <h4 className="font-medium text-gray-900">Ticket Type {index + 1}</h4>
                  {fields.length > 1 && (
                    <Button
                      type="button"
                      variant="danger"
                      size="sm"
                      onClick={() => removeTicketType(index)}
                    >
                      Remove
                    </Button>
                  )}
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <Input
                    label="Ticket Type Name *"
                    {...register(`ticketTypes.${index}.name`, {
                      required: 'Ticket type name is required'
                    })}
                    error={errors.ticketTypes?.[index]?.name?.message}
                    placeholder="e.g., General Admission, VIP"
                  />
                  <Input
                    label="Price *"
                    type="number"
                    step="0.01"
                    min="0"
                    {...register(`ticketTypes.${index}.price`, {
                      required: 'Price is required',
                      valueAsNumber: true,
                      min: { value: 0, message: 'Price cannot be negative' }
                    })}
                    error={errors.ticketTypes?.[index]?.price?.message}
                    placeholder="0.00"
                  />
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Input
                    label="Description"
                    {...register(`ticketTypes.${index}.description`)}
                    placeholder="Optional description"
                  />
                  <Input
                    label="Total Available"
                    type="number"
                    min="0"
                    {...register(`ticketTypes.${index}.totalAvailable`, {
                      valueAsNumber: true,
                      min: { value: 0, message: 'Cannot be negative' }
                    })}
                    placeholder="Leave empty for unlimited"
                  />
                </div>
              </div>
            ))}

            {fields.length === 0 && (
              <div className="text-center py-8 border-2 border-dashed border-gray-300 rounded-lg">
                <p className="text-gray-500 mb-2">No ticket types added</p>
                <p className="text-sm text-gray-400 mb-4">Events need at least one ticket type</p>
                <Button
                  type="button"
                  variant="outline"
                  onClick={addTicketType}
                >
                  Add First Ticket Type
                </Button>
              </div>
            )}
          </div>

          {/* Form Actions */}
          <div className="flex justify-end space-x-4 pt-6 border-t">
            <Button
              type="button"
              variant="outline"
              onClick={() => navigate('/events')}
              disabled={isSubmitting}
            >
              Cancel
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
            >
              {isSubmitting ? 'Creating...' : 'Create Event'}
            </Button>
          </div>
        </form>
      </Card>
    </div>
  );
};
</file>

<file path="pages/organiser/Events/EventDetails.tsx">
import { useState, useEffect } from 'react';
import { useParams, Link, useNavigate } from 'react-router-dom';
import { Card } from '@/components/common/Card';
import { Badge } from '@/components/common/Badge';
import { Button } from '@/components/common/Button';
import { Spinner } from '@/components/feedback/Spinner';
import { eventsApi } from '@/api/endpoints/events';
import { formatDate, formatCurrency } from '@/utils/formatters';

export const EventDetails = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const [event, setEvent] = useState<any>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [isDeleting, setIsDeleting] = useState(false);

  useEffect(() => {
    const fetchEvent = async () => {
      if (!id) return;

      try {
        setIsLoading(true);
        const eventData = await eventsApi.getById(id);
        console.log('Fetched event data:', eventData); // Debug log
        setEvent(eventData);
      } catch (err: any) {
        console.error('Failed to fetch event:', err);
        setError(err.message || 'Failed to load event');
      } finally {
        setIsLoading(false);
      }
    };

    fetchEvent();
  }, [id]);

  const handleDelete = async () => {
    if (!id || !window.confirm('Are you sure you want to delete this event?')) {
      return;
    }

    try {
      setIsDeleting(true);
      await eventsApi.delete(id);
      navigate('/events');
    } catch (err: any) {
      console.error('Failed to delete event:', err);
      alert(err.message || 'Failed to delete event');
    } finally {
      setIsDeleting(false);
    }
  };

  const getStatusVariant = (status: string): 'success' | 'warning' | 'danger' | 'info' | 'default' => {
    switch (status) {
      case 'PUBLISHED':
        return 'success';
      case 'DRAFT':
        return 'warning';
      case 'CANCELLED':
        return 'danger';
      case 'COMPLETED':
        return 'info';
      default:
        return 'default';
    }
  };

  // Safe date formatter that handles backend format
  const formatEventDate = (dateString?: string): string => {
    if (!dateString) return 'Not set';

    try {
      // Backend returns: "2025-01-29T22:37:00"
      // This is already in ISO format, just format it nicely
      const date = new Date(dateString);

      if (isNaN(date.getTime())) {
        console.error('Invalid date:', dateString);
        return 'Invalid date';
      }

      return formatDate(date, 'PPp'); // Jan 29, 2025 at 10:37 PM
    } catch (error) {
      console.error('Date formatting error:', error, dateString);
      return dateString; // Fallback to raw string
    }
  };

  if (isLoading) {
    return (
      <div className="flex justify-center items-center min-h-64">
        <Spinner />
      </div>
    );
  }

  if (error || !event) {
    return (
      <Card>
        <div className="text-center py-12">
          <p className="text-red-600 mb-4">Failed to load event</p>
          <p className="text-gray-500">{error || 'Event not found'}</p>
          <Link to="/events">
            <Button className="mt-4">Back to Events</Button>
          </Link>
        </div>
      </Card>
    );
  }

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold text-gray-900">Event Details</h1>
        <div className="flex space-x-2">
          <Link to={`/events/${id}/edit`}>
            <Button variant="outline">Edit</Button>
          </Link>
          <Link to={`/events/${id}/tickets`}>
            <Button>Manage Tickets</Button>
          </Link>
          <Link to={`/events/${id}/dashboard`}>
            <Button variant="outline">Dashboard</Button>
          </Link>
          <Link to={`/events/${id}/staff`}>
            <Button variant="outline">Manage Staff</Button>
          </Link>
          <Button variant="danger" onClick={handleDelete} isLoading={isDeleting}>
            Delete
          </Button>
        </div>
      </div>

      <Card>
        <div className="space-y-6">
          {/* Event Title and Status */}
          <div>
            <h2 className="text-2xl font-semibold mb-2">{event.name}</h2>
            <Badge variant={getStatusVariant(event.eventStatus)}>{event.eventStatus}</Badge> <Badge variant={getStatusVariant(event.eventType)}>{event.eventType}</Badge>
          </div>

          {/* Description */}
          <div>
            <h3 className="font-medium text-gray-700 mb-1">Description</h3>
            <p className="text-gray-600">{event.description}</p>
          </div>

          {/* Event Dates */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-4">
            <div>
              <h3 className="font-medium text-gray-700 mb-1">Start Date</h3>
              <p className="text-gray-900">{formatEventDate(event.startTime)}</p>
            </div>
            <div>
              <h3 className="font-medium text-gray-700 mb-1">End Date</h3>
              <p className="text-gray-900">{formatEventDate(event.endTime)}</p>
            </div>
          </div>

          {/* Venue */}
          <div className="border-t pt-4">
            <h3 className="font-medium text-gray-700 mb-1">Venue</h3>
            <p className="text-gray-600">{event.venue}</p>
          </div>

          {/* Sales Period */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-4">
            <div>
              <h3 className="font-medium text-gray-700 mb-1">Sales Start Date</h3>
              <p className="text-gray-900">{formatEventDate(event.salesStartDate)}</p>
            </div>
            <div>
              <h3 className="font-medium text-gray-700 mb-1">Sales End Date</h3>
              <p className="text-gray-900">{formatEventDate(event.salesEndDate)}</p>
            </div>
          </div>

          {/* Ticket Types */}
          {event.ticketTypes && event.ticketTypes.length > 0 && (
            <div className="border-t pt-6">
              <h3 className="font-medium text-gray-700 mb-3">Ticket Types</h3>
              <div className="space-y-3">
                {event.ticketTypes.map((ticket: any, index: number) => (
                  <div
                    key={ticket.id || index}
                    className="p-4 border border-gray-200 rounded-lg bg-gray-50"
                  >
                    <div className="flex justify-between items-start">
                      <div>
                        <h4 className="font-semibold text-lg">{ticket.name}</h4>
                        {ticket.description && (
                          <p className="text-sm text-gray-600 mt-1">{ticket.description}</p>
                        )}
                      </div>
                      <div className="text-right">
                        <p className="text-xl font-bold text-blue-600">
                          {formatCurrency(ticket.price)}
                        </p>
                        {ticket.totalAvailable !== undefined && (
                          <p className="text-sm text-gray-500">
                            {ticket.totalAvailable} available
                          </p>
                        )}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </Card>
    </div>
  );
};
</file>

<file path="pages/organiser/Events/EventEdit.tsx">
import { useParams, useNavigate } from 'react-router-dom';
import { useState, useEffect } from 'react';
import { useForm, useFieldArray } from 'react-hook-form';
import { Card } from '@/components/common/Card';
import { Spinner } from '@/components/feedback/Spinner';
import { Button } from '@/components/common/Button';
import { Input } from '@/components/common/Input';
import { eventsApi, UpdateEventDto, UpdateTicketTypeRequestDto } from '@/api/endpoints/events';
import apiClient from '@/api/client';

interface TicketTypeFormData {
  id?: number;
  name: string;
  price: number;
  description?: string;
  totalAvailable?: number;
}

interface EventFormData {
  name: string;
  description: string;
  startTime: string;
  endTime: string;
  venue: string;
  eventType: string;
  salesStartDate?: string;
  salesEndDate?: string;
  ticketTypes: TicketTypeFormData[];
}

export const EventEdit = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const [isLoading, setIsLoading] = useState(true);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Track IDs of ticket types that were deleted
  const [deletedTicketTypeIds, setDeletedTicketTypeIds] = useState<number[]>([]);

  const {
    register,
    handleSubmit,
    control,
    formState: { errors },
    reset,
    watch
  } = useForm<EventFormData>({
    defaultValues: {
      name: '',
      description: '',
      startTime: '',
      endTime: '',
      venue: '',
      eventType: '',
      salesStartDate: '',
      salesEndDate: '',
      ticketTypes: []
    }
  });

  const { fields, append, remove } = useFieldArray({
    control,
    name: 'ticketTypes'
  });

  // Watch ticket types to track changes
  const currentTicketTypes = watch('ticketTypes');

  const formatForInput = (isoString?: string): string => {
    if (!isoString) return '';

    try {
      const date = new Date(isoString);
      if (isNaN(date.getTime())) return '';

      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');

      return `${year}-${month}-${day}T${hours}:${minutes}`;
    } catch (error) {
      console.error('Date formatting error:', error);
      return '';
    }
  };

  const formatForBackend = (dateString?: string): string | undefined => {
    if (!dateString || dateString.trim() === '') return undefined;

    if (dateString.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/)) {
      return `${dateString}:00`;
    }

    return dateString;
  };

  useEffect(() => {
    const fetchEvent = async () => {
      if (!id) {
        setError('Event ID is required');
        setIsLoading(false);
        return;
      }

      try {
        setIsLoading(true);
        setError(null);

        console.log('Fetching event:', id);
        const eventData = await eventsApi.getById(id);
        console.log('Event data received:', eventData);

        // Store original ticket type IDs
        const originalIds = (eventData.ticketTypes || [])
          .map(ticket => ticket.id)
          .filter((id): id is number => id !== undefined);

        console.log('Original ticket type IDs:', originalIds);

        reset({
          name: eventData.name || '',
          description: eventData.description || '',
          startTime: formatForInput(eventData.startTime),
          endTime: formatForInput(eventData.endTime),
          venue: eventData.venue || '',
          eventType: eventData.eventType || '',
          salesStartDate: formatForInput(eventData.salesStartDate),
          salesEndDate: formatForInput(eventData.salesEndDate),
          ticketTypes: (eventData.ticketTypes || []).map(ticket => ({
            id: ticket.id,
            name: ticket.name,
            price: ticket.price,
            description: ticket.description || '',
            totalAvailable: ticket.totalAvailable
          }))
        });

      } catch (err: any) {
        console.error('Failed to fetch event:', err);
        setError(err.message || 'Failed to load event');
      } finally {
        setIsLoading(false);
      }
    };

    fetchEvent();
  }, [id, reset]);

  const addTicketType = () => {
    append({ name: '', price: 0, totalAvailable: 100 });
  };

  const removeTicketType = (index: number) => {
    const ticketTypeToRemove = currentTicketTypes[index];

    // If this ticket type has an ID (exists in database), track it for deletion
    if (ticketTypeToRemove?.id) {
      console.log('Marking ticket type for deletion:', ticketTypeToRemove.id);
      setDeletedTicketTypeIds(prev => [...prev, ticketTypeToRemove.id!]);
    }

    // Remove from form
    remove(index);
  };

  const onSubmit = async (data: EventFormData) => {
    if (!id) {
      setError('Event ID is required');
      return;
    }

    setIsSubmitting(true);
    setError(null);

    try {
      // Step 1: Delete removed ticket types first
      if (deletedTicketTypeIds.length > 0) {
        console.log('Deleting ticket types:', deletedTicketTypeIds);

        const deletePromises = deletedTicketTypeIds.map(async (ticketTypeId) => {
          try {
            // Call the delete API endpoint
            await apiClient.delete(`/events/${id}/ticket-types/${ticketTypeId}`);
            console.log('Deleted ticket type:', ticketTypeId);
          } catch (err) {
            console.error('Failed to delete ticket type:', ticketTypeId, err);
            throw err; // Re-throw to stop the update process
          }
        });

        // Wait for all deletions to complete
        await Promise.all(deletePromises);
      }

      // Step 2: Update event with remaining ticket types
      const updateData: UpdateEventDto = {
        name: data.name,
        description: data.description,
        startTime: formatForBackend(data.startTime),
        endTime: formatForBackend(data.endTime),
        venue: data.venue,
        eventType: data.eventType,
        salesStartDate: formatForBackend(data.salesStartDate),
        salesEndDate: formatForBackend(data.salesEndDate),
        ticketTypes: data.ticketTypes.map(ticket => ({
          id: ticket.id,
          name: ticket.name,
          price: Number(ticket.price),
          description: ticket.description || '',
          totalAvailable: ticket.totalAvailable ? Number(ticket.totalAvailable) : undefined
        } as UpdateTicketTypeRequestDto))
      };

      console.log('Submitting update with payload:', updateData);

      const updatedEvent = await eventsApi.update(id, updateData);
      console.log('Event updated successfully:', updatedEvent);

      alert('Event updated successfully!');

      // Clear deleted IDs tracking
      setDeletedTicketTypeIds([]);

      navigate(`/events/${id}`);
    } catch (err: any) {
      console.error('Failed to update event:', err);
      setError(err.message || 'Failed to update event. Please check your data.');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } finally {
      setIsSubmitting(false);
    }
  };

  if (isLoading) {
    return (
      <div className="flex justify-center items-center min-h-64">
        <Spinner size="lg" />
      </div>
    );
  }

  if (error && !fields.length) {
    return (
      <Card>
        <div className="text-center py-12">
          <p className="text-red-600 mb-4">Failed to load event</p>
          <p className="text-gray-500">{error}</p>
          <Button
            variant="outline"
            className="mt-4"
            onClick={() => navigate('/events')}
          >
            Back to Events
          </Button>
        </div>
      </Card>
    );
  }

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold text-gray-900">Edit Event</h1>
        <Button
          variant="outline"
          onClick={() => navigate(`/events/${id}`)}
          disabled={isSubmitting}
        >
          Cancel
        </Button>
      </div>

      {error && (
        <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
          <p className="text-red-800 font-medium">❌ {error}</p>
        </div>
      )}

      {/* Show deletion warning */}
      {deletedTicketTypeIds.length > 0 && (
        <div className="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
          <p className="text-yellow-800 font-medium">
            ⚠️ {deletedTicketTypeIds.length} ticket type(s) will be deleted when you save
          </p>
        </div>
      )}

      <Card>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
          <Input
            label="Event Name *"
            {...register('name', { required: 'Event name is required' })}
            error={errors.name?.message}
            placeholder="Enter event name"
          />

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Description *
            </label>
            <textarea
              {...register('description', { required: 'Description is required' })}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              rows={4}
              placeholder="Describe your event"
            />
            {errors.description && (
              <p className="mt-1 text-sm text-red-600">{errors.description.message}</p>
            )}
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <Input
              label="Start Time *"
              type="datetime-local"
              {...register('startTime', { required: 'Start time is required' })}
              error={errors.startTime?.message}
            />
            <Input
              label="End Time *"
              type="datetime-local"
              {...register('endTime', { required: 'End time is required' })}
              error={errors.endTime?.message}
            />
          </div>

          <Input
            label="Venue *"
            {...register('venue', { required: 'Venue is required' })}
            error={errors.venue?.message}
            placeholder="Enter venue address"
          />

          {/* Event Type */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Event Type *
            </label>
            <select
              {...register('eventType', { required: 'Event type is required' })}
              className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.eventType ? 'border-red-500' : 'border-gray-300'
                }`}
            >
              <option value="">Select event type</option>
              <option value="PERFORMANCES">Performances</option>
              <option value="EXPERIENCES">Experiences</option>
              <option value="PARTIES">Parties</option>
              <option value="SPORTS">Sports</option>
              <option value="CONFERENCES">Conferences</option>
            </select>
            {errors.eventType && (
              <p className="mt-1 text-sm text-red-600">
                {errors.eventType.message}
              </p>
            )}
          </div>


          <div className="border-t pt-6">
            <h3 className="text-lg font-medium text-gray-900 mb-4">Ticket Sales Period</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <Input
                label="Sales Start Date"
                type="datetime-local"
                {...register('salesStartDate')}
                error={errors.salesStartDate?.message}
              />
              <Input
                label="Sales End Date"
                type="datetime-local"
                {...register('salesEndDate')}
                error={errors.salesEndDate?.message}
              />
            </div>
          </div>

          <div className="border-t pt-6">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-medium text-gray-900">Ticket Types</h3>
              <Button
                type="button"
                variant="outline"
                size="sm"
                onClick={addTicketType}
              >
                + Add Ticket Type
              </Button>
            </div>

            {fields.map((field, index) => (
              <div key={field.id} className="border rounded-lg p-4 mb-4 bg-gray-50">
                <div className="flex justify-between items-center mb-3">
                  <h4 className="font-medium text-gray-900">
                    Ticket Type {index + 1}
                    {field.id && <span className="text-xs text-gray-500 ml-2">(ID: {field.id})</span>}
                  </h4>
                  <Button
                    type="button"
                    variant="danger"
                    size="sm"
                    onClick={() => {
                      if (window.confirm('Are you sure you want to remove this ticket type?')) {
                        removeTicketType(index);
                      }
                    }}
                  >
                    Remove
                  </Button>
                </div>

                <input
                  type="hidden"
                  {...register(`ticketTypes.${index}.id`)}
                />

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <Input
                    label="Ticket Type Name *"
                    {...register(`ticketTypes.${index}.name`, {
                      required: 'Ticket type name is required'
                    })}
                    error={errors.ticketTypes?.[index]?.name?.message}
                    placeholder="e.g., General Admission, VIP"
                  />
                  <Input
                    label="Price *"
                    type="number"
                    step="0.01"
                    min="0"
                    {...register(`ticketTypes.${index}.price`, {
                      required: 'Price is required',
                      valueAsNumber: true,
                      min: { value: 0, message: 'Price cannot be negative' }
                    })}
                    error={errors.ticketTypes?.[index]?.price?.message}
                    placeholder="0.00"
                  />
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Input
                    label="Description"
                    {...register(`ticketTypes.${index}.description`)}
                    placeholder="Optional description"
                  />
                  <Input
                    label="Total Available"
                    type="number"
                    min="0"
                    {...register(`ticketTypes.${index}.totalAvailable`, {
                      valueAsNumber: true,
                      min: { value: 0, message: 'Cannot be negative' }
                    })}
                    placeholder="Leave empty for unlimited"
                  />
                </div>
              </div>
            ))}

            {fields.length === 0 && (
              <div className="text-center py-8 border-2 border-dashed border-gray-300 rounded-lg">
                <p className="text-gray-500 mb-4">No ticket types configured</p>
                <Button
                  type="button"
                  variant="outline"
                  onClick={addTicketType}
                >
                  Add Ticket Type
                </Button>
              </div>
            )}
          </div>

          <div className="flex justify-end space-x-4 pt-6 border-t">
            <Button
              type="button"
              variant="outline"
              onClick={() => navigate(`/events/${id}`)}
              disabled={isSubmitting}
            >
              Cancel
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
            >
              {isSubmitting ? 'Updating...' : 'Update Event'}
            </Button>
          </div>
        </form>
      </Card>
    </div>
  );
};
</file>

<file path="pages/organiser/Events/EventList.tsx">
import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { Button } from '@/components/common/Button';
import { Card } from '@/components/common/Card';
import { Badge } from '@/components/common/Badge';
import { Spinner } from '@/components/feedback/Spinner';
import { eventsApi, ListEventResponseDto } from '@/api/endpoints/events';
import { formatDate } from '@/utils/formatters';

export const EventList = () => {
  const [events, setEvents] = useState<ListEventResponseDto[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [page, setPage] = useState(0);
  const [totalPages, setTotalPages] = useState(0);

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        setIsLoading(true);
        const response = await eventsApi.getAll();
        setEvents(response.content || []); // Use response.content (array of events)
        setTotalPages(response.totalPages || 0);
      } catch (err: any) {
        console.error('Failed to fetch events:', err);
        setError(err.message || 'Failed to load events');
      } finally {
        setIsLoading(false);
      }
    };

    fetchEvents();
  }, [page]);

  const getStatusVariant = (status: string): 'success' | 'warning' | 'danger' | 'info' | 'default' => {
    switch (status) {
      case 'PUBLISHED':
        return 'success';
      case 'DRAFT':
        return 'warning';
      case 'CANCELLED':
        return 'danger';
      case 'COMPLETED':
        return 'info';
      default:
        return 'default';
    }
  };

  const formatEventDate = (dateString: string): string => {
    if (!dateString) return 'Date not set';
    try {
      return formatDate(dateString, 'MMM dd, yyyy • HH:mm');
    } catch (error) {
      return dateString;
    }
  };

  if (isLoading) {
    return (
      <div className="flex justify-center items-center min-h-64">
        <Spinner size="lg" />
      </div>
    );
  }

  if (error) {
    return (
      <Card>
        <div className="text-center py-12">
          <p className="text-red-600 mb-4">Failed to load events</p>
          <p className="text-gray-500">{error}</p>
          <Button 
            variant="outline" 
            className="mt-4"
            onClick={() => window.location.reload()}
          >
            Retry
          </Button>
        </div>
      </Card>
    );
  }

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold text-gray-900">Events</h1>
        <Link to="/events/create">
          <Button>Create Event</Button>
        </Link>
      </div>

      {events.length === 0 ? (
        <Card>
          <div className="text-center py-12">
            <svg className="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <h3 className="mt-2 text-sm font-medium text-gray-900">No events</h3>
            <p className="mt-1 text-sm text-gray-500">Get started by creating your first event.</p>
            <div className="mt-6">
              <Link to="/events/create">
                <Button>Create Event</Button>
              </Link>
            </div>
          </div>
        </Card>
      ) : (
        <>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            {events.map((event) => (
              <Card key={event.id} className="hover:shadow-lg transition-shadow flex flex-col h-full">
                <div className="flex-1">
                  <div className="mb-4">
                    <h3 className="text-xl font-semibold mb-2 line-clamp-1">{event.name}</h3>
                    <Badge variant={getStatusVariant(event.eventStatus)}>{event.eventStatus}</Badge> <Badge variant={getStatusVariant(event.eventType)}>{event.eventType}</Badge>
                  </div>
                  <p className="text-gray-600 mb-4 line-clamp-2">{event.description}</p>
                  
                  <div className="space-y-2 text-sm text-gray-500 mb-4">
                    <div className="flex items-center">
                      <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                      </svg>
                      <span className="line-clamp-1">{event.venue}</span>
                    </div>
                    <div className="flex items-center">
                      <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                      <span>{formatEventDate(event.startTime)}</span>
                    </div>
                    
                    {/* Display ticket types summary */}
                    {event.ticketTypes && event.ticketTypes.length > 0 && (
                      <div className="pt-2 border-t">
                        <div className="flex items-center justify-between">
                          <span className="font-medium">Ticket Types:</span>
                          <span className="text-blue-600">{event.ticketTypes.length}</span>
                        </div>
                        <div className="flex flex-wrap gap-1 mt-1">
                          {event.ticketTypes.slice(0, 2).map((ticketType, idx) => (
                            <span key={idx} className="text-xs bg-gray-100 px-2 py-1 rounded">
                              {ticketType.name} - ${ticketType.price}
                            </span>
                          ))}
                          {event.ticketTypes.length > 2 && (
                            <span className="text-xs text-gray-500">
                              +{event.ticketTypes.length - 2} more
                            </span>
                          )}
                        </div>
                      </div>
                    )}
                  </div>
                </div>
                
                <div className="pt-4 border-t">
                  <Link to={`/events/${event.id}`}>
                    <Button variant="outline" size="sm" className="w-full">
                      View Details
                    </Button>
                  </Link>
                </div>
              </Card>
            ))}
          </div>

          {/* Pagination */}
          {totalPages > 1 && (
            <div className="flex justify-center items-center space-x-2">
              <Button
                variant="outline"
                size="sm"
                disabled={page === 0}
                onClick={() => setPage(prev => prev - 1)}
              >
                Previous
              </Button>
              <span className="text-sm text-gray-600">
                Page {page + 1} of {totalPages}
              </span>
              <Button
                variant="outline"
                size="sm"
                disabled={page >= totalPages - 1}
                onClick={() => setPage(prev => prev + 1)}
              >
                Next
              </Button>
            </div>
          )}
        </>
      )}
    </div>
  );
};
</file>

<file path="pages/organiser/Events/EventTickets.tsx">
// import { useParams } from 'react-router-dom';
import { Card } from '@/components/common/Card';
import { Button } from '@/components/common/Button';

export const EventTickets = () => {
  // const { id } = useParams<{ id: string }>();

  // TODO: Fetch tickets and ticket tiers for this event

  return (
    <div>
      <h1 className="text-3xl font-bold text-gray-900 mb-6">Manage Tickets</h1>

      <div className="mb-6">
        <Button>Add Ticket Tier</Button>
      </div>

      <Card>
        <h2 className="text-xl font-semibold mb-4">Ticket Tiers</h2>
        <p className="text-gray-500">No ticket tiers yet</p>
      </Card>

      <Card className="mt-6">
        <h2 className="text-xl font-semibold mb-4">Ticket Sales</h2>
        <p className="text-gray-500">No tickets sold yet</p>
      </Card>
    </div>
  );
};
</file>

<file path="pages/organiser/Analytics.tsx">
import { Card } from '@/components/common/Card';

export const Analytics = () => {
  return (
    <div>
      <h1 className="text-3xl font-bold text-gray-900 mb-6">Analytics & Reports</h1>
      
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card>
          <h2 className="text-xl font-semibold mb-4">Sales Overview</h2>
          <p className="text-gray-500">Charts will be displayed here</p>
        </Card>
        <Card>
          <h2 className="text-xl font-semibold mb-4">Event Performance</h2>
          <p className="text-gray-500">Event performance metrics will be displayed here</p>
        </Card>
      </div>
    </div>
  );
};
</file>

<file path="pages/organiser/Dashboard.tsx">
import { Link } from 'react-router-dom';
import { Card } from '@/components/common/Card';
import { Button } from '@/components/common/Button';
import { Badge } from '@/components/common/Badge';
import { useAuth } from '@/hooks/useAuth';

export const Dashboard = () => {
  const { user } = useAuth();

  // TODO: Fetch real data using React Query
  const stats = {
    totalEvents: 0,
    totalTicketsSold: 0,
    revenue: 0,
    upcomingEvents: 0,
  };

  const recentEvents: any[] = [];

  return (
    <div className="space-y-6">
      {/* Welcome Section */}
      <div className="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg p-8 text-white">
        <h1 className="text-4xl font-bold mb-2">
          Welcome back, {user?.name || 'Organiser'}!
        </h1>
        <p className="text-blue-100 text-lg">
          Manage your events and track your ticket sales from one place.
        </p>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <Card className="border-l-4 border-l-blue-500">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500 mb-1">Total Events</h3>
              <p className="text-3xl font-bold text-gray-900">{stats.totalEvents}</p>
            </div>
            <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
              <svg className="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
          </div>
        </Card>

        <Card className="border-l-4 border-l-green-500">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500 mb-1">Tickets Sold</h3>
              <p className="text-3xl font-bold text-gray-900">{stats.totalTicketsSold}</p>
            </div>
            <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
              <svg className="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
              </svg>
            </div>
          </div>
        </Card>



        {/* Main Content Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Recent Events */}
          <div className="lg:col-span-2">
            <Card>
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-xl font-semibold text-gray-900">Recent Events</h2>
                <Link to="/events">
                  <Button variant="outline" size="sm">View All</Button>
                </Link>
              </div>

              {recentEvents.length === 0 ? (
                <div className="text-center py-12">
                  <svg className="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  <h3 className="mt-2 text-sm font-medium text-gray-900">No events</h3>
                  <p className="mt-1 text-sm text-gray-500">Get started by creating your first event.</p>
                  <div className="mt-6">
                    <Link to="/events/create">
                      <Button>Create Event</Button>
                    </Link>
                  </div>
                </div>
              ) : (
                <div className="space-y-4">
                  {recentEvents.map((event) => (
                    <div key={event.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                      <div className="flex-1">
                        <h3 className="font-medium text-gray-900">{event.title}</h3>
                        <p className="text-sm text-gray-500 mt-1">{event.venue} • {event.startDate}</p>
                      </div>
                      <div className="flex items-center space-x-3">
                        <Badge variant={event.status === 'PUBLISHED' ? 'success' : 'warning'}>
                          {event.status}
                        </Badge>
                        <Link to={`/events/${event.id}`}>
                          <Button variant="outline" size="sm">View</Button>
                        </Link>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </Card>
          </div>

          {/* Quick Actions */}
          <div>
            <Card>
              <h2 className="text-xl font-semibold text-gray-900 mb-6">Quick Actions</h2>
              <div className="space-y-3">
                <Link to="/events/create" className="block">
                  <Button className="w-full" size="lg">
                    <svg className="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                    </svg>
                    Create New Event
                  </Button>
                </Link>

                <Link to="/events" className="block">
                  <Button variant="outline" className="w-full" size="lg">
                    <svg className="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    View All Events
                  </Button>
                </Link>

                <Link to="/analytics" className="block">
                  <Button variant="outline" className="w-full" size="lg">
                    <svg className="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    View Analytics
                  </Button>
                </Link>
              </div>
            </Card>

            {/* Help Section */}
            <Card className="mt-6 bg-blue-50 border-blue-200">
              <h3 className="font-semibold text-gray-900 mb-2">Need Help?</h3>
              <p className="text-sm text-gray-600 mb-4">
                Check out our guides or contact support for assistance.
              </p>
              <Button variant="outline" size="sm" className="w-full">
                Get Support
              </Button>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="pages/organiser/EventDashboard.tsx">
import { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { organiserDashboardApi } from '@/api/endpoints/organiser';
import { eventsApi, EventCreatedResponseDto } from '@/api/endpoints/events';
import {
    EventValidationStats,
    TicketTypeAttendance,
    StaffValidationStats,
} from '@/types';
import { Card } from '@/components/common/Card';
import { Spinner } from '@/components/feedback/Spinner';
import {
    BarChart,
    Bar,
    XAxis,
    YAxis,
    CartesianGrid,
    Tooltip,
    ResponsiveContainer,
} from 'recharts';

import { StaffDetailModal } from '@/components/modals/StaffDetailModal';
import { EventDetailsSummary } from '@/components/organiser/analytics/EventDetailsSummary';

const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];

export const EventDashboard = () => {
    const { eventId } = useParams<{ eventId: string }>();
    const [event, setEvent] = useState<EventCreatedResponseDto | null>(null);
    const [stats, setStats] = useState<EventValidationStats | null>(null);
    const [ticketStats, setTicketStats] = useState<TicketTypeAttendance[]>([]);
    const [staffStats, setStaffStats] = useState<StaffValidationStats[]>([]);
    const [isLoading, setIsLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);

    // Modal State
    const [selectedStaff, setSelectedStaff] = useState<StaffValidationStats | null>(null);
    const [isModalOpen, setIsModalOpen] = useState(false);

    useEffect(() => {
        const fetchData = async () => {
            if (!eventId) return;

            try {
                setIsLoading(true);
                setError(null);
                const [eventData, statsData, ticketData, staffData] = await Promise.all([
                    eventsApi.getById(eventId),
                    organiserDashboardApi.getEventStats(eventId),
                    organiserDashboardApi.getTicketTypeStats(eventId),
                    organiserDashboardApi.getStaffStats(eventId),
                ]);

                setEvent(eventData);
                setStats(statsData);
                setTicketStats(ticketData);
                setStaffStats(staffData);
            } catch (err: any) {
                console.error('Failed to fetch dashboard data', err);
                setError(err.message || 'Failed to load dashboard data');
            } finally {
                setIsLoading(false);
            }
        };

        fetchData();
    }, [eventId]);

    if (isLoading) return <div className="flex justify-center p-12"><Spinner size="lg" /></div>;
    if (error) return <div className="p-8 text-center text-red-600">{error}</div>;
    if (!stats) return <div className="p-8 text-center">No data available</div>;



    return (
        <div className="space-y-8 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            {/* Header */}
            <div>
                <h1 className="text-3xl font-bold text-gray-900 tracking-tight">Event Dashboard</h1>
                <p className="text-gray-600 text-lg">{event?.name}</p>
            </div>

            {/* Section 1: Analytics Overview */}
            <EventDetailsSummary />

            {/* Section 2: Ticket Type Breakdown */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <Card className="p-6 shadow-sm">
                    <h3 className="text-lg font-semibold mb-6 flex items-center">
                        <svg className="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
                        </svg>
                        Attendance by Ticket Type
                    </h3>
                    <div className="space-y-4">
                        {ticketStats.map((type, index) => (
                            <div key={type.ticketTypeId} className="space-y-2">
                                <div className="flex justify-between text-sm">
                                    <span className="font-medium text-gray-700">{type.ticketTypeName}</span>
                                    <span className="text-gray-600 font-medium">{type.validatedCount} checked in</span>
                                </div>
                                <div className="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                    <div
                                        className="h-full rounded-full transition-all duration-1000 ease-out"
                                        style={{
                                            width: `${Math.min(100, (type.validatedCount / (stats.totalTicketsSold || 1)) * 100)}%`,
                                            backgroundColor: COLORS[index % COLORS.length]
                                        }}
                                    ></div>
                                </div>
                            </div>
                        ))}
                    </div>
                </Card>

                {/* Staff Performance Chart */}
                <Card className="p-6 shadow-sm">
                    <h3 className="text-lg font-semibold mb-6 flex items-center">
                        <svg className="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        Staff Performance
                    </h3>
                    <div className="h-64">
                        <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={staffStats} margin={{ top: 20, right: 30, left: 0, bottom: 5 }}>
                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#E5E7EB" />
                                <XAxis
                                    dataKey="staffUsername"
                                    tick={{ fontSize: 12, fill: '#6B7280' }}
                                    axisLine={false}
                                    tickLine={false}
                                />
                                <YAxis
                                    allowDecimals={false}
                                    tick={{ fontSize: 12, fill: '#6B7280' }}
                                    axisLine={false}
                                    tickLine={false}
                                />
                                <Tooltip
                                    cursor={{ fill: '#F3F4F6' }}
                                    contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)' }}
                                />
                                <Bar dataKey="validatedCount" fill="#4F46E5" radius={[4, 4, 0, 0]} barSize={40} />
                            </BarChart>
                        </ResponsiveContainer>
                    </div>
                </Card>
            </div>

            {/* Section 3: Staff List */}
            <Card className="overflow-hidden shadow-sm">
                <div className="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                    <h3 className="font-semibold text-gray-900">Staff Validation Details</h3>
                    <span className="text-xs font-medium text-gray-500 bg-white px-2 py-1 rounded border">Ordered by Activity</span>
                </div>
                <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Staff Member</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Validations</th>
                            </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {staffStats.length === 0 ? (
                                <tr>
                                    <td colSpan={3} className="px-6 py-8 text-center text-gray-500">No staff activity yet</td>
                                </tr>
                            ) : (
                                staffStats
                                    .sort((a, b) => b.validatedCount - a.validatedCount)
                                    .map((staff) => (
                                        <tr
                                            key={staff.staffUserId}
                                            className="hover:bg-gray-50 transition-colors cursor-pointer"
                                            onClick={() => {
                                                setSelectedStaff(staff);
                                                setIsModalOpen(true);
                                            }}
                                        >
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                <div className="flex items-center">
                                                    <div className="h-8 w-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mr-3 font-bold text-xs">
                                                        {staff.staffUsername.substring(0, 2).toUpperCase()}
                                                    </div>
                                                    {staff.staffUsername}
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {staff.staffUsername}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-right">
                                                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    {staff.validatedCount}
                                                </span>
                                            </td>
                                        </tr>
                                    ))
                            )}
                        </tbody>
                    </table>
                </div>
            </Card>

            {/* Detail Modal */}
            {selectedStaff && (
                <StaffDetailModal
                    isOpen={isModalOpen}
                    onClose={() => setIsModalOpen(false)}
                    eventId={eventId || ''}
                    staffUserId={selectedStaff.staffUserId}
                    staffName={selectedStaff.staffUsername}
                />
            )}
        </div>
    );
};
</file>

<file path="pages/organiser/EventStaffManagement.tsx">
import { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { staffApi } from '@/api/endpoints/staff';
import { eventsApi, EventCreatedResponseDto } from '@/api/endpoints/events';
import {
    StaffGenerationRequest,
    StaffGenerationResponse,
    StaffMemberDto,
} from '@/types';
import { Button } from '@/components/common/Button';
import { Input } from '@/components/common/Input';
import { Card } from '@/components/common/Card';
import { format } from 'date-fns';

// Tab type
type TabType = 'generate' | 'manage';

export const EventStaffManagement = () => {
    const { eventId } = useParams<{ eventId: string }>();
    const [activeTab, setActiveTab] = useState<TabType>('generate');
    const [event, setEvent] = useState<EventCreatedResponseDto | null>(null);
    const [staffMembers, setStaffMembers] = useState<StaffMemberDto[]>([]);
    const [generatedResponse, setGeneratedResponse] = useState<StaffGenerationResponse | null>(null);
    const [isLoading, setIsLoading] = useState(false);
    const [isLoadingStaff, setIsLoadingStaff] = useState(false);
    const [error, setError] = useState<string | null>(null);
    const [showActiveOnly, setShowActiveOnly] = useState(false);
    const [page, setPage] = useState(0);
    const [totalPages, setTotalPages] = useState(0);
    const [totalElements, setTotalElements] = useState(0);

    // Action states
    const [actionLoading, setActionLoading] = useState<string | null>(null);
    const [resetPasswordResult, setResetPasswordResult] = useState<{ userId: string; password: string } | null>(null);
    const [confirmResetUserId, setConfirmResetUserId] = useState<string | null>(null);
    const [extendHours, setExtendHours] = useState<{ userId: string; hours: number } | null>(null);

    // ... (lines 38-113)

    // Reset password - Open Confirmation
    const handleResetPassword = (userId: string) => {
        setConfirmResetUserId(userId);
    };

    // Execute Reset Logic
    const executeResetPassword = async () => {
        if (!eventId || !confirmResetUserId) return;

        setActionLoading(confirmResetUserId);
        try {
            const result = await staffApi.resetStaffPassword(eventId, confirmResetUserId);
            // Close confirm modal
            setConfirmResetUserId(null);
            // Show result modal
            setResetPasswordResult({ userId: confirmResetUserId, password: result.newPassword });
        } catch (err: any) {
            alert(err.message || 'Failed to reset password');
            setConfirmResetUserId(null);
        } finally {
            setActionLoading(null);
        }
    };

    const { register, handleSubmit, formState: { errors }, reset } = useForm<StaffGenerationRequest>({
        defaultValues: {
            count: 5,
            validityHours: 48,
        },
    });

    // Fetch event details
    useEffect(() => {
        if (eventId) {
            eventsApi.getById(eventId).then(setEvent).catch(console.error);
        }
    }, [eventId]);

    // Fetch staff members
    const fetchStaffMembers = async () => {
        if (!eventId) return;

        setIsLoadingStaff(true);
        try {
            const response = showActiveOnly
                ? await staffApi.getActiveEventStaff(eventId, page, 20)
                : await staffApi.getEventStaff(eventId, page, 20);

            setStaffMembers(response.content);
            setTotalPages(response.totalPages);
            setTotalElements(response.totalElements);
        } catch (err: any) {
            console.error('Failed to fetch staff:', err);
        } finally {
            setIsLoadingStaff(false);
        }
    };

    useEffect(() => {
        if (activeTab === 'manage') {
            fetchStaffMembers();
        }
    }, [eventId, activeTab, page, showActiveOnly]);

    // Generate staff accounts
    const onSubmitGenerate = async (data: StaffGenerationRequest) => {
        if (!eventId) return;

        try {
            setIsLoading(true);
            setError(null);
            setGeneratedResponse(null);

            const response = await staffApi.generateStaffForEvent(eventId, data);
            setGeneratedResponse(response);
            reset();
        } catch (err: any) {
            setError(err.message || 'Failed to generate staff accounts');
            console.error(err);
        } finally {
            setIsLoading(false);
        }
    };

    // Delete staff member
    const handleDeleteStaff = async (userId: string, username: string) => {
        if (!eventId) return;
        if (!confirm(`Are you sure you want to delete staff member "${username}"?`)) return;

        setActionLoading(userId);
        try {
            await staffApi.deleteStaffMember(eventId, userId);
            await fetchStaffMembers();
        } catch (err: any) {
            alert(err.message || 'Failed to delete staff member');
        } finally {
            setActionLoading(null);
        }
    };



    // Extend validity
    const handleExtendValidity = async () => {
        if (!eventId || !extendHours) return;

        setActionLoading(extendHours.userId);
        try {
            const result = await staffApi.extendStaffValidity(eventId, extendHours.userId, extendHours.hours);
            alert(`Validity extended until ${format(new Date(result.newValidUntil), 'PPpp')}`);
            setExtendHours(null);
            await fetchStaffMembers();
        } catch (err: any) {
            alert(err.message || 'Failed to extend validity');
        } finally {
            setActionLoading(null);
        }
    };

    const formatDateTime = (dateStr: string) => {
        try {
            return format(new Date(dateStr), 'PPpp');
        } catch {
            return dateStr;
        }
    };

    return (
        <div className="space-y-6">
            {/* Header */}
            <div className="flex items-center justify-between">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Staff Management</h1>
                    {event && (
                        <p className="text-gray-600 mt-1">
                            Event: <span className="font-medium">{event.name}</span>
                        </p>
                    )}
                </div>
                <div className="flex items-center gap-2 text-sm text-gray-500">
                    <span className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full">
                        {totalElements} Staff Members
                    </span>
                </div>
            </div>

            {/* Tabs */}
            <div className="border-b border-gray-200">
                <nav className="flex space-x-8">
                    <button
                        onClick={() => setActiveTab('generate')}
                        className={`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${activeTab === 'generate'
                            ? 'border-blue-500 text-blue-600'
                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`}
                    >
                        Generate Staff
                    </button>
                    <button
                        onClick={() => setActiveTab('manage')}
                        className={`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${activeTab === 'manage'
                            ? 'border-blue-500 text-blue-600'
                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`}
                    >
                        Manage Staff
                    </button>
                </nav>
            </div>

            {/* Generate Tab */}
            {activeTab === 'generate' && (
                <div className="max-w-2xl space-y-6">
                    <Card className="p-6">
                        <h2 className="text-xl font-semibold mb-4">Generate Staff Accounts</h2>
                        <p className="text-gray-600 mb-6">
                            Create multiple staff accounts at once with specified validity periods.
                            Staff members can verify tickets and manage event check-ins.
                        </p>

                        <form onSubmit={handleSubmit(onSubmitGenerate)} className="space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <Input
                                    label="Number of Accounts"
                                    type="number"
                                    {...register('count', {
                                        required: 'Count is required',
                                        min: { value: 1, message: 'Minimum 1 account' },
                                        max: { value: 50, message: 'Maximum 50 accounts at once' },
                                    })}
                                    error={errors.count?.message}
                                />
                                <Input
                                    label="Validity (Hours)"
                                    type="number"
                                    {...register('validityHours', {
                                        required: 'Validity is required',
                                        min: { value: 1, message: 'Minimum 1 hour' },
                                        max: { value: 720, message: 'Maximum 30 days (720 hours)' },
                                    })}
                                    error={errors.validityHours?.message}
                                />
                            </div>

                            <div className="pt-4">
                                <Button type="submit" variant="primary" isLoading={isLoading}>
                                    Generate Accounts
                                </Button>
                            </div>
                        </form>

                        {error && (
                            <div className="mt-4 p-4 bg-red-50 text-red-700 rounded-md">
                                {error}
                            </div>
                        )}
                    </Card>

                    {/* Generated Credentials Display */}
                    {generatedResponse && (
                        <Card className="p-6 bg-green-50 border-green-200">
                            <h3 className="text-lg font-bold text-green-800 mb-2">
                                ✓ {generatedResponse.staffCount} Account(s) Generated Successfully
                            </h3>
                            <p className="text-green-700 mb-4">
                                Valid from <strong>{formatDateTime(generatedResponse.validFrom)}</strong> until{' '}
                                <strong>{formatDateTime(generatedResponse.validUntil)}</strong>
                            </p>
                            <p className="text-sm text-green-600 mb-4">
                                <strong>Important:</strong> Save these credentials securely. Passwords will not be shown again.
                            </p>

                            <div className="space-y-3 max-h-96 overflow-y-auto">
                                {generatedResponse.credentials.map((cred, index) => (
                                    <div
                                        key={cred.staffUserId}
                                        className="bg-white p-4 rounded-lg border border-green-100"
                                    >
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-sm font-medium text-gray-500">
                                                Staff #{index + 1}
                                            </span>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                            <div>
                                                <span className="text-gray-500">Username:</span>
                                                <p className="font-mono font-medium">{cred.username}</p>
                                            </div>
                                            <div>
                                                <span className="text-gray-500">Password:</span>
                                                <p className="font-mono font-bold text-green-700">{cred.password}</p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </Card>
                    )}
                </div>
            )}

            {/* Manage Tab */}
            {activeTab === 'manage' && (
                <div className="space-y-4">
                    {/* Filters */}
                    <div className="flex items-center justify-between">
                        <label className="flex items-center gap-2">
                            <input
                                type="checkbox"
                                checked={showActiveOnly}
                                onChange={(e) => {
                                    setShowActiveOnly(e.target.checked);
                                    setPage(0);
                                }}
                                className="rounded border-gray-300"
                            />
                            <span className="text-sm text-gray-700">Show active only</span>
                        </label>
                        <Button variant="outline" size="sm" onClick={fetchStaffMembers} isLoading={isLoadingStaff}>
                            Refresh
                        </Button>
                    </div>

                    {/* Staff Table */}
                    <div className="bg-white rounded-lg border overflow-hidden">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valid Until</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Last Login</th>
                                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {isLoadingStaff ? (
                                    <tr>
                                        <td colSpan={5} className="px-6 py-8 text-center text-gray-500">
                                            Loading...
                                        </td>
                                    </tr>
                                ) : staffMembers.length === 0 ? (
                                    <tr>
                                        <td colSpan={5} className="px-6 py-8 text-center text-gray-500">
                                            No staff members found
                                        </td>
                                    </tr>
                                ) : (
                                    staffMembers.map((staff) => (
                                        <tr key={staff.id} className={staff.isExpired ? 'bg-gray-50' : ''}>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div>
                                                    <p className="font-mono text-sm font-medium text-gray-900">{staff.username}</p>
                                                    <p className="text-xs text-gray-500">{staff.email}</p>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                {staff.isExpired ? (
                                                    <span className="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
                                                        Expired
                                                    </span>
                                                ) : staff.isActive ? (
                                                    <span className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                                                        Active
                                                    </span>
                                                ) : (
                                                    <span className="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">
                                                        Inactive
                                                    </span>
                                                )}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {formatDateTime(staff.validUntil)}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {staff.lastLogin ? formatDateTime(staff.lastLogin) : 'Never'}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                                <button
                                                    onClick={() => setExtendHours({ userId: staff.staffUserId, hours: 24 })}
                                                    className="text-blue-600 hover:text-blue-900"
                                                    disabled={actionLoading === staff.staffUserId}
                                                >
                                                    Extend
                                                </button>
                                                <button
                                                    onClick={() => handleResetPassword(staff.staffUserId)}
                                                    className="text-yellow-600 hover:text-yellow-900"
                                                    disabled={actionLoading === staff.staffUserId}
                                                >
                                                    Reset
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteStaff(staff.staffUserId, staff.username)}
                                                    className="text-red-600 hover:text-red-900"
                                                    disabled={actionLoading === staff.staffUserId}
                                                >
                                                    Delete
                                                </button>
                                            </td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    </div>

                    {/* Pagination */}
                    {totalPages > 1 && (
                        <div className="flex items-center justify-between">
                            <p className="text-sm text-gray-500">
                                Showing page {page + 1} of {totalPages}
                            </p>
                            <div className="flex gap-2">
                                <Button
                                    variant="outline"
                                    size="sm"
                                    onClick={() => setPage((p) => Math.max(0, p - 1))}
                                    disabled={page === 0}
                                >
                                    Previous
                                </Button>
                                <Button
                                    variant="outline"
                                    size="sm"
                                    onClick={() => setPage((p) => p + 1)}
                                    disabled={page >= totalPages - 1}
                                >
                                    Next
                                </Button>
                            </div>
                        </div>
                    )}
                </div>
            )}

            {/* Reset Password Confirmation Modal */}
            {confirmResetUserId && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 className="text-lg font-bold mb-4">Reset Password?</h3>
                        <p className="text-gray-600 mb-6">
                            Are you sure you want to reset the password for this staff member?
                            The old password will stop working immediately.
                        </p>
                        <div className="flex gap-3">
                            <Button
                                variant="outline"
                                className="flex-1"
                                onClick={() => setConfirmResetUserId(null)}
                            >
                                Cancel
                            </Button>
                            <Button
                                variant="primary"
                                className="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white"
                                onClick={executeResetPassword}
                                isLoading={!!actionLoading}
                            >
                                Confirm Reset
                            </Button>
                        </div>
                    </div>
                </div>
            )}

            {/* Success Modal */}
            {resetPasswordResult && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 className="text-lg font-bold mb-4 text-green-700">New Password Generated</h3>
                        <p className="text-gray-600 mb-4">
                            Please copy and share this password with the staff member.
                            <br />
                            <span className="text-sm text-red-500">It will not be shown again.</span>
                        </p>
                        <div className="bg-gray-100 p-4 rounded-lg mb-6 border border-gray-200 text-center">
                            <p className="font-mono text-xl font-bold tracking-wider select-all">
                                {resetPasswordResult.password}
                            </p>
                        </div>
                        <Button
                            variant="primary"
                            className="w-full"
                            onClick={() => setResetPasswordResult(null)}
                        >
                            Done
                        </Button>
                    </div>
                </div>
            )}

            {/* Extend Validity Modal */}
            {extendHours && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 className="text-lg font-bold mb-4">Extend Validity Period</h3>
                        <div className="mb-4">
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                Extend by (hours)
                            </label>
                            <input
                                type="number"
                                value={extendHours.hours}
                                onChange={(e) =>
                                    setExtendHours({ ...extendHours, hours: parseInt(e.target.value) || 0 })
                                }
                                min={1}
                                max={720}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                            />
                        </div>
                        <div className="flex gap-3">
                            <Button
                                variant="outline"
                                className="flex-1"
                                onClick={() => setExtendHours(null)}
                            >
                                Cancel
                            </Button>
                            <Button
                                variant="primary"
                                className="flex-1"
                                onClick={handleExtendValidity}
                                isLoading={actionLoading === extendHours.userId}
                            >
                                Extend
                            </Button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};
</file>

<file path="pages/organiser/OrganiserLandingPage.css">
/* Organiser Landing Page - Dark Theme (BookMyShow Inspired) */

.organiser-landing {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1419 100%);
  color: #ffffff;
  position: relative;
  overflow-x: hidden;
}

.organiser-landing::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
  pointer-events: none;
}

/* Hero Section */
.landing-hero {
  max-width: 1400px;
  margin: 0 auto;
  padding: 120px 24px 80px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 80px;
  align-items: center;
  position: relative;
  z-index: 1;
}

.hero-content {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.hero-badge {
  display: inline-block;
  padding: 8px 16px;
  background: rgba(99, 102, 241, 0.2);
  border: 1px solid rgba(99, 102, 241, 0.4);
  border-radius: 50px;
  font-size: 14px;
  font-weight: 600;
  color: #a5b4fc;
  width: fit-content;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

.hero-title {
  font-size: 64px;
  font-weight: 800;
  line-height: 1.1;
  margin: 0;
  background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.title-highlight {
  background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-description {
  font-size: 20px;
  line-height: 1.6;
  color: #cbd5e1;
  max-width: 560px;
  margin: 0;
}

/* Hero Actions */
.hero-actions {
  display: flex;
  gap: 20px;
  margin-top: 16px;
  flex-wrap: wrap;
}

.btn-primary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 18px 36px;
  font-size: 18px;
  font-weight: 700;
  text-decoration: none;
  border-radius: 12px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  border: none;
  position: relative;
  overflow: hidden;
  letter-spacing: 0.3px;
}

.btn-primary::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn-primary:hover::before {
  left: 100%;
}

.btn-icon {
  width: 24px;
  height: 24px;
  stroke-width: 2.5;
}

/* Create Event Button - Primary CTA */
.btn-create {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: #ffffff;
  box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
}

.btn-create:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(99, 102, 241, 0.6);
  background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
}

.btn-create:active {
  transform: translateY(0);
}

/* Browse Events Button - Secondary CTA */
.btn-browse {
  background: rgba(255, 255, 255, 0.1);
  color: #ffffff;
  border: 2px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.btn-browse:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.btn-browse:active {
  transform: translateY(0);
}

/* Hero Visual - Floating Cards */
.hero-visual {
  position: relative;
  height: 500px;
}

.floating-card {
  position: absolute;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 32px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: float 6s ease-in-out infinite;
}

.card-icon {
  font-size: 48px;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
}

.card-text {
  font-size: 16px;
  font-weight: 600;
  color: #e0e7ff;
  text-align: center;
}

.card-1 {
  top: 10%;
  left: 10%;
  animation-delay: 0s;
}

.card-2 {
  top: 50%;
  right: 10%;
  animation-delay: 2s;
}

.card-3 {
  bottom: 10%;
  left: 30%;
  animation-delay: 4s;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-20px) rotate(5deg);
  }
}

/* Features Section */
.landing-features {
  max-width: 1400px;
  margin: 0 auto;
  padding: 80px 24px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 40px;
  position: relative;
  z-index: 1;
}

.feature-item {
  text-align: center;
  padding: 40px 24px;
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 16px;
  transition: all 0.3s ease;
}

.feature-item:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(99, 102, 241, 0.4);
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
}

.feature-icon {
  font-size: 56px;
  margin-bottom: 20px;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
}

.feature-title {
  font-size: 24px;
  font-weight: 700;
  margin: 0 0 12px 0;
  color: #ffffff;
}

.feature-description {
  font-size: 16px;
  line-height: 1.6;
  color: #cbd5e1;
  margin: 0;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .landing-hero {
    grid-template-columns: 1fr;
    gap: 60px;
    padding: 80px 24px 60px;
  }

  .hero-visual {
    height: 400px;
  }

  .hero-title {
    font-size: 48px;
  }

  .hero-description {
    font-size: 18px;
  }
}

@media (max-width: 768px) {
  .landing-hero {
    padding: 60px 20px 40px;
  }

  .hero-title {
    font-size: 36px;
  }

  .hero-description {
    font-size: 16px;
  }

  .hero-actions {
    flex-direction: column;
  }

  .btn-primary {
    width: 100%;
    padding: 16px 32px;
    font-size: 16px;
  }

  .hero-visual {
    height: 300px;
  }

  .floating-card {
    padding: 24px;
  }

  .card-icon {
    font-size: 36px;
  }

  .landing-features {
    grid-template-columns: 1fr;
    padding: 60px 20px;
  }
}

@media (max-width: 480px) {
  .hero-title {
    font-size: 28px;
  }

  .hero-badge {
    font-size: 12px;
    padding: 6px 12px;
  }

  .btn-primary {
    padding: 14px 28px;
    font-size: 15px;
  }

  .btn-icon {
    width: 20px;
    height: 20px;
  }
}

/* Accessibility - High Contrast Mode Support */
@media (prefers-contrast: high) {
  .btn-create {
    background: #6366f1;
    border: 2px solid #ffffff;
  }

  .btn-browse {
    background: #ffffff;
    color: #0a0e27;
    border: 2px solid #ffffff;
  }

  .btn-browse:hover {
    background: #f3f4f6;
  }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  .floating-card {
    animation: none;
  }

  .btn-primary {
    transition: background-color 0.2s;
  }

  .btn-primary:hover {
    transform: none;
  }

  .feature-item:hover {
    transform: none;
  }
}
</file>

<file path="pages/organiser/OrganiserLandingPage.tsx">
import { Link } from 'react-router-dom';
import './OrganiserLandingPage.css';

export const OrganiserLandingPage = () => {
  return (
    <div className="organiser-landing">
      <div className="landing-hero">
        <div className="hero-content">
          <div className="hero-badge">Welcome to Event Platform</div>
          <h1 className="hero-title">
            Create & Manage
            <span className="title-highlight"> Unforgettable Events</span>
          </h1>
          <p className="hero-description">
            Transform your ideas into extraordinary experiences. Sell tickets, manage attendees,
            and grow your event business with our powerful platform.
          </p>
          
          <div className="hero-actions">
            <Link to="/events/create" className="btn-primary btn-create">
              <svg className="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 4v16m8-8H4" />
              </svg>
              Create Event
            </Link>
            
            <Link to="/dashboard" className="btn-primary btn-browse">
              <svg className="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path strokeLinecap="round" strokeLinejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
              </svg>
              Dashboard
            </Link>
          </div>
        </div>
        
        <div className="hero-visual">
          <div className="floating-card card-1">
            <div className="card-icon">🎫</div>
            <div className="card-text">Ticket Sales</div>
          </div>
          <div className="floating-card card-2">
            <div className="card-icon">📊</div>
            <div className="card-text">Analytics</div>
          </div>
          <div className="floating-card card-3">
            <div className="card-icon">✨</div>
            <div className="card-text">Manage Events</div>
          </div>
        </div>
      </div>
      
      <div className="landing-features">
        <div className="feature-item">
          <div className="feature-icon">🚀</div>
          <h3 className="feature-title">Quick Setup</h3>
          <p className="feature-description">Get started in minutes with our intuitive interface</p>
        </div>
        <div className="feature-item">
          <div className="feature-icon">💰</div>
          <h3 className="feature-title">Easy Payments</h3>
          <p className="feature-description">Secure payment processing with instant payouts</p>
        </div>
        <div className="feature-item">
          <div className="feature-icon">📈</div>
          <h3 className="feature-title">Real-time Analytics</h3>
          <p className="feature-description">Track sales, attendance, and revenue in real-time</p>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="pages/organiser/Settings.tsx">
import { Card } from '@/components/common/Card';
import { useAuth } from '@/hooks/useAuth';

export const Settings = () => {
  const { user } = useAuth();

  return (
    <div>
      <h1 className="text-3xl font-bold text-gray-900 mb-6">Settings</h1>
      
      <Card>
        <h2 className="text-xl font-semibold mb-4">Profile Information</h2>
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <p className="text-gray-900">{user?.email || '-'}</p>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Name</label>
            <p className="text-gray-900">{user?.name || '-'}</p>
          </div>
        </div>
      </Card>
    </div>
  );
};
</file>

<file path="pages/organiser/StaffManagement.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { eventsApi, ListEventResponseDto } from '@/api/endpoints/events';
import { Card } from '@/components/common/Card';
import { Button } from '@/components/common/Button';
import { format } from 'date-fns';

export const StaffManagement = () => {
    const navigate = useNavigate();
    const [events, setEvents] = useState<ListEventResponseDto[]>([]);
    const [isLoading, setIsLoading] = useState(true);
    const [page, setPage] = useState(0);
    const [totalPages, setTotalPages] = useState(0);

    useEffect(() => {
        const fetchEvents = async () => {
            setIsLoading(true);
            try {
                const response = await eventsApi.getAll(page, 10);
                setEvents(response.content);
                setTotalPages(response.totalPages);
            } catch (err) {
                console.error('Failed to fetch events:', err);
            } finally {
                setIsLoading(false);
            }
        };
        fetchEvents();
    }, [page]);

    const formatDate = (dateStr: string) => {
        try {
            return format(new Date(dateStr), 'PPp');
        } catch {
            return dateStr;
        }
    };

    const getStatusBadge = (status: string) => {
        const statusStyles: Record<string, string> = {
            DRAFT: 'bg-gray-100 text-gray-800',
            PUBLISHED: 'bg-green-100 text-green-800',
            CANCELLED: 'bg-red-100 text-red-800',
            COMPLETED: 'bg-blue-100 text-blue-800',
        };
        return (
            <span className={`px-2 py-1 text-xs font-medium rounded-full ${statusStyles[status] || 'bg-gray-100 text-gray-800'}`}>
                {status}
            </span>
        );
    };

    return (
        <div className="space-y-6">
            <div className="flex items-center justify-between">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Staff Management</h1>
                    <p className="text-gray-600 mt-1">
                        Select an event to manage its staff members
                    </p>
                </div>
            </div>

            {isLoading ? (
                <div className="flex items-center justify-center py-12">
                    <div className="animate-spin rounded-full h-8 w-8 border-4 border-gray-200 border-t-blue-600"></div>
                </div>
            ) : events.length === 0 ? (
                <Card className="p-8 text-center">
                    <div className="text-gray-500 mb-4">
                        <svg className="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <p className="text-lg font-medium">No events found</p>
                        <p className="text-sm">Create an event first to manage staff</p>
                    </div>
                    <Button variant="primary" onClick={() => navigate('/events/create')}>
                        Create Event
                    </Button>
                </Card>
            ) : (
                <div className="grid gap-4">
                    {events.map((event) => (
                        <Card
                            key={event.id}
                            className="p-4 hover:shadow-md transition-shadow cursor-pointer"
                            onClick={() => navigate(`/events/${event.id}/staff`)}
                        >
                            <div className="flex items-center justify-between">
                                <div className="flex-1">
                                    <div className="flex items-center gap-3 mb-2">
                                        <h3 className="text-lg font-semibold text-gray-900">{event.name}</h3>
                                        {getStatusBadge(event.eventStatus)}
                                    </div>
                                    <div className="text-sm text-gray-600 space-y-1">
                                        <p>
                                            <span className="font-medium">Date:</span> {formatDate(event.startTime)}
                                        </p>
                                        <p>
                                            <span className="font-medium">Venue:</span> {event.venue}
                                        </p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <Button
                                        variant="primary"
                                        size="sm"
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            navigate(`/events/${event.id}/staff`);
                                        }}
                                    >
                                        Manage Staff
                                    </Button>
                                </div>
                            </div>
                        </Card>
                    ))}
                </div>
            )}

            {/* Pagination */}
            {totalPages > 1 && (
                <div className="flex items-center justify-between pt-4">
                    <p className="text-sm text-gray-500">
                        Page {page + 1} of {totalPages}
                    </p>
                    <div className="flex gap-2">
                        <Button
                            variant="outline"
                            size="sm"
                            onClick={() => setPage((p) => Math.max(0, p - 1))}
                            disabled={page === 0}
                        >
                            Previous
                        </Button>
                        <Button
                            variant="outline"
                            size="sm"
                            onClick={() => setPage((p) => p + 1)}
                            disabled={page >= totalPages - 1}
                        >
                            Next
                        </Button>
                    </div>
                </div>
            )}
        </div>
    );
};
</file>

<file path="pages/organiser/Tickets.tsx">
import { Card } from '@/components/common/Card';

export const Tickets = () => {
  // TODO: Fetch all tickets using React Query

  return (
    <div>
      <h1 className="text-3xl font-bold text-gray-900 mb-6">All Tickets</h1>
      
      <Card>
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Ticket Number
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Event
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Price
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              <tr>
                <td colSpan={4} className="px-6 py-4 text-center text-gray-500">
                  No tickets found
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
};
</file>

<file path="pages/public/BrowseEvents.tsx">
import { useState, useEffect, useRef } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { publishedEventsApi, PublishedEventDto } from '@/api/endpoints/publishedEvents';
import { ProfileDropdown } from '@/components/common/ProfileDropdown';
import { useAuth } from '@/hooks/useAuth';

// Event type categories
const EVENT_CATEGORIES = [
  { id: 'PERFORMANCES', label: 'Performances', icon: '🎭' },
  { id: 'EXPERIENCES', label: 'Experiences', icon: '✨' },
  { id: 'PARTIES', label: 'Parties', icon: '🎉' },
  { id: 'SPORTS', label: 'Sports', icon: '⚽' },
  { id: 'CONFERENCES', label: 'Conferences', icon: '💼' },
];

export const BrowseEvents = () => {
  const { isAuthenticated, login } = useAuth();
  const [allEvents, setAllEvents] = useState<PublishedEventDto[]>([]);
  const [filteredEvents, setFilteredEvents] = useState<PublishedEventDto[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [page, setPage] = useState(0);
  // Removed unused totalPages state
  const navigate = useNavigate();

  // Autocomplete state
  const [suggestions, setSuggestions] = useState<PublishedEventDto[]>([]);
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [isSearching, setIsSearching] = useState(false);
  const searchRef = useRef<HTMLDivElement>(null);
  const debounceTimerRef = useRef<NodeJS.Timeout | null>(null);

  useEffect(() => {
    fetchEvents();
  }, [page]);

  // Close suggestions when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (searchRef.current && !searchRef.current.contains(event.target as Node)) {
        setShowSuggestions(false);
      }
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  const fetchEvents = async (search?: string) => {
    try {
      setIsLoading(true);
      const response = await publishedEventsApi.getAll(page, 100, search); // Fetch more events
      setAllEvents(response.content || []);
      setFilteredEvents(response.content || []);
    } catch (error) {
      console.error('Failed to fetch events:', error);
    } finally {
      setIsLoading(false);
    }
  };

  // Fetch autocomplete suggestions
  const fetchSuggestions = async (query: string) => {
    if (!query.trim()) {
      setSuggestions([]);
      setShowSuggestions(false);
      return;
    }

    try {
      setIsSearching(true);
      const response = await publishedEventsApi.getAll(0, 5, query);
      setSuggestions(response.content || []);
      setShowSuggestions(true);
    } catch (error) {
      console.error('Failed to fetch suggestions:', error);
    } finally {
      setIsSearching(false);
    }
  };

  // Handle search input change with debounce
  const handleSearchChange = (value: string) => {
    setSearchTerm(value);

    // Clear previous timer
    if (debounceTimerRef.current) {
      clearTimeout(debounceTimerRef.current);
    }

    // Set new timer for debounced search
    debounceTimerRef.current = setTimeout(() => {
      fetchSuggestions(value);
      // Also filter local events
      if (value.trim()) {
        const filtered = allEvents.filter(event =>
          event.name.toLowerCase().includes(value.toLowerCase()) ||
          event.venue.toLowerCase().includes(value.toLowerCase()) ||
          event.description.toLowerCase().includes(value.toLowerCase())
        );
        setFilteredEvents(filtered);
      } else {
        setFilteredEvents(allEvents);
      }
    }, 300);
  };

  // Handle search form submit
  const handleSearchSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setShowSuggestions(false);
    setPage(0);
    fetchEvents(searchTerm);
  };

  // Handle suggestion click
  const handleSuggestionClick = (event: PublishedEventDto) => {
    setShowSuggestions(false);
    navigate(`/published-events/${event.id}`);
  };

  // Clear search
  const handleClearSearch = () => {
    setSearchTerm('');
    setSuggestions([]);
    setShowSuggestions(false);
    setPage(0);
    setFilteredEvents(allEvents);
  };

  // Group events by category
  const getEventsByCategory = (categoryId: string) => {
    return filteredEvents.filter(event => event.eventType === categoryId);
  };

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const month = months[date.getMonth()];
    const day = date.getDate();
    return `${day} ${month}`;
  };

  const getMinPrice = (event: PublishedEventDto) => {
    if (!event.ticketTypes || event.ticketTypes.length === 0) return null;
    const prices = event.ticketTypes.map(t => t.price);
    return Math.min(...prices);
  };

  const getGradient = (index: number) => {
    const gradients = [
      'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
      'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
      'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
      'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
      'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
    ];
    return gradients[index % gradients.length];
  };

  // Highlight matching text in suggestions
  const highlightMatch = (text: string, query: string) => {
    if (!query.trim()) return text;

    const regex = new RegExp(`(${query})`, 'gi');
    const parts = text.split(regex);

    return parts.map((part, index) =>
      regex.test(part) ? (
        <span key={index} className="font-bold text-red-600">{part}</span>
      ) : (
        <span key={index}>{part}</span>
      )
    );
  };

  // Event Card Component
  const EventCard = ({ event, index }: { event: PublishedEventDto; index: number }) => {
    const minPrice = getMinPrice(event);
    return (
      <Link
        to={`/published-events/${event.id}`}
        className="group cursor-pointer flex-shrink-0"
        style={{ width: '280px' }}
      >
        <div className="bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
          <div
            className="h-64 relative overflow-hidden"
            style={{ background: getGradient(index) }}
          >
            <div className="absolute inset-0 bg-black bg-opacity-20 group-hover:bg-opacity-10 transition-all"></div>
            <div className="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
              <h3 className="text-white font-bold text-lg line-clamp-2 mb-1">
                {event.name}
              </h3>
            </div>
          </div>

          <div className="p-4">
            <div className="flex items-start mb-2">
              <svg className="w-4 h-4 text-gray-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <span className="text-sm text-gray-600 line-clamp-1">{event.venue}</span>
            </div>

            <div className="flex items-center mb-3">
              <svg className="w-4 h-4 text-gray-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <span className="text-sm text-gray-600">
                {formatDate(event.startTime)}
              </span>
            </div>

            {minPrice !== null && (
              <div className="flex items-center justify-between pt-3 border-t">
                <span className="text-xs text-gray-500">Starting from</span>
                <span className="text-lg font-bold text-red-600">₹{minPrice}</span>
              </div>
            )}
          </div>
        </div>
      </Link>
    );
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white shadow-sm sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex items-center justify-between">
            <Link to="/" className="flex items-center space-x-2">
              <div className="text-2xl font-bold text-red-600">EventHub</div>
            </Link>

            {/* Search Bar with Autocomplete */}
            <div className="flex-1 max-w-2xl mx-8" ref={searchRef}>
              <div className="relative">
                <input
                  type="text"
                  value={searchTerm}
                  onChange={(e) => handleSearchChange(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleSearchSubmit(e)}
                  placeholder="Search for Events, Venues..."
                  className="w-full px-4 py-2.5 pl-12 pr-10 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
                />

                <svg
                  className="absolute left-4 top-3 w-5 h-5 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>

                {searchTerm && (
                  <button
                    onClick={handleClearSearch}
                    className="absolute right-3 top-3 text-gray-400 hover:text-gray-600"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                )}

                {isSearching && (
                  <div className="absolute right-10 top-3">
                    <div className="animate-spin rounded-full h-5 w-5 border-2 border-gray-300 border-t-red-600"></div>
                  </div>
                )}

                {/* Autocomplete Suggestions */}
                {showSuggestions && suggestions.length > 0 && (
                  <div className="absolute top-full mt-2 w-full bg-white rounded-lg shadow-lg border border-gray-200 max-h-96 overflow-y-auto z-50">
                    {suggestions.map((event, index) => (
                      <button
                        key={event.id}
                        onClick={() => handleSuggestionClick(event)}
                        className="w-full px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 text-left transition-colors"
                      >
                        <div className="flex items-start space-x-3">
                          <div
                            className="w-12 h-12 rounded flex-shrink-0"
                            style={{ background: getGradient(index) }}
                          ></div>

                          <div className="flex-1 min-w-0">
                            <h3 className="font-semibold text-gray-900 truncate">
                              {highlightMatch(event.name, searchTerm)}
                            </h3>
                            <div className="flex items-center text-sm text-gray-500 mt-1">
                              <svg className="w-4 h-4 mr-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                              </svg>
                              <span className="truncate">{highlightMatch(event.venue, searchTerm)}</span>
                            </div>
                          </div>
                        </div>
                      </button>
                    ))}

                    <button
                      onClick={handleSearchSubmit}
                      className="w-full px-4 py-3 text-center text-red-600 font-medium hover:bg-red-50 transition-colors"
                    >
                      View all results for "{searchTerm}"
                    </button>
                  </div>
                )}

                {showSuggestions && searchTerm && suggestions.length === 0 && !isSearching && (
                  <div className="absolute top-full mt-2 w-full bg-white rounded-lg shadow-lg border border-gray-200 p-4 text-center text-gray-500 z-50">
                    No events found for "{searchTerm}"
                  </div>
                )}
              </div>
            </div>

            <div className="flex items-center space-x-4">
              {isAuthenticated ? (
                <>
                  <ProfileDropdown />
                </>
              ) : (
                <button
                  onClick={login}
                  className="px-5 py-2 border border-red-600 text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium text-sm"
                >
                  Login / Sign up
                </button>
              )}
            </div>
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Hero Banner */}
        <div className="mb-8 rounded-2xl overflow-hidden bg-gradient-to-r from-red-600 to-pink-600 p-8 text-white">
          <h1 className="text-4xl font-bold mb-2">Discover Amazing Events</h1>
          <p className="text-lg opacity-90">Find the best events happening around you</p>
          {searchTerm && (
            <div className="mt-4 flex items-center space-x-2">
              <span className="text-sm opacity-90">Showing results for:</span>
              <span className="font-semibold bg-white/20 px-3 py-1 rounded-full">{searchTerm}</span>
              <button
                onClick={handleClearSearch}
                className="text-sm underline hover:no-underline"
              >
                Clear search
              </button>
            </div>
          )}
        </div>

        {/* Loading State */}
        {isLoading ? (
          <div className="flex justify-center items-center py-20">
            <div className="animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-red-600"></div>
          </div>
        ) : filteredEvents.length === 0 ? (
          <div className="text-center py-20">
            <svg className="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 12h.01M12 12h.01M12 12h.01M12 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 className="text-xl font-medium text-gray-900 mb-2">No events found</h3>
            <p className="text-gray-500 mb-4">
              {searchTerm ? `No events match "${searchTerm}"` : 'No events available at the moment'}
            </p>
            {searchTerm && (
              <button
                onClick={handleClearSearch}
                className="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
              >
                View All Events
              </button>
            )}
          </div>
        ) : (
          <>
            {/* Events by Category - Horizontal Scroll */}
            {EVENT_CATEGORIES.map((category) => {
              const categoryEvents = getEventsByCategory(category.id);

              if (categoryEvents.length === 0) return null;

              return (
                <div key={category.id} className="mb-12">
                  <div className="flex items-center justify-between mb-4">
                    <h2 className="text-2xl font-bold text-gray-900 flex items-center">
                      <span className="text-3xl mr-2">{category.icon}</span>
                      {category.label}
                    </h2>
                    <span className="text-sm text-gray-500">
                      {categoryEvents.length} event{categoryEvents.length !== 1 ? 's' : ''}
                    </span>
                  </div>

                  {/* Horizontal Scrollable Container */}
                  <div className="overflow-x-auto pb-4 -mx-4 px-4 scrollbar-hide">
                    <div className="flex space-x-4" style={{ minWidth: 'min-content' }}>
                      {categoryEvents.map((event, index) => (
                        <EventCard key={event.id} event={event} index={index} />
                      ))}
                    </div>
                  </div>
                </div>
              );
            })}
          </>
        )}
      </main>

      <style>{`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `}</style>
    </div>
  );
};
</file>

<file path="pages/public/MyTickets.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Card } from '@/components/common/Card';
import { Badge } from '@/components/common/Badge';
import { Button } from '@/components/common/Button';
import { Spinner } from '@/components/feedback/Spinner';
import { ticketsApi, TicketPurchasedDto, QrCodeDetails } from '@/api/endpoints/tickets';
import { formatDate } from '@/utils/formatters';

export const MyTickets = () => {
  const navigate = useNavigate();
  const [tickets, setTickets] = useState<TicketPurchasedDto[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [selectedTicket, setSelectedTicket] = useState<string | null>(null);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    fetchTickets();
  }, []);

  const fetchTickets = async () => {
    try {
      setIsLoading(true);
      setError(null);
      const response = await ticketsApi.listMyTickets(0, 50);
      setTickets(response.content || []);
    } catch (err: any) {
      console.error('Failed to fetch tickets:', err);
      setError(err.message || 'Failed to load tickets');
    } finally {
      setIsLoading(false);
    }
  };

  // Group tickets by event
  const groupedTickets = tickets.reduce((acc, ticket) => {
    const eventId = ticket.event.id;
    if (!acc[eventId]) {
      acc[eventId] = {
        event: ticket.event,
        tickets: [],
      };
    }
    acc[eventId].tickets.push(ticket);
    return acc;
  }, {} as Record<string, { event: any; tickets: TicketPurchasedDto[] }>);

  const getStatusVariant = (status: string): 'success' | 'warning' | 'danger' | 'info' | 'default' => {
    switch (status) {
      case 'PURCHASED':
        return 'success';
      case 'USED':
        return 'info';
      case 'CANCELLED':
        return 'danger';
      case 'EXPIRED':
        return 'warning';
      default:
        return 'default';
    }
  };

  const handleViewTicket = (ticketId: string) => {
    setSelectedTicket(ticketId);
  };

  const handleCloseTicket = () => {
    setSelectedTicket(null);
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50">
        <header className="bg-white shadow-sm">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <button
              onClick={() => navigate('/')}
              className="text-gray-700 hover:text-gray-900"
            >
              ← Back to Home
            </button>
          </div>
        </header>
        <div className="flex justify-center items-center min-h-64 mt-20">
          <Spinner size="lg" />
        </div>
      </div>
    );
  }

  if (selectedTicket) {
    return <TicketDetailsView ticketId={selectedTicket} onClose={handleCloseTicket} />;
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <button
            onClick={() => navigate('/')}
            className="text-gray-700 hover:text-gray-900 flex items-center"
          >
            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
            Back to Home
          </button>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h1 className="text-3xl font-bold mb-6">Your Tickets</h1>

        {error && (
          <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
            <p className="text-red-800">{error}</p>
          </div>
        )}

        {tickets.length === 0 ? (
          <Card>
            <div className="text-center py-12">
              <svg className="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
              </svg>
              <h3 className="text-xl font-medium text-gray-900 mb-2">No tickets yet</h3>
              <p className="text-gray-500 mb-6">Book your first event to see tickets here</p>
              <Button onClick={() => navigate('/')}>Browse Events</Button>
            </div>
          </Card>
        ) : (
          <div className="space-y-8">
            {Object.values(groupedTickets).map(({ event, tickets: eventTickets }) => (
              <Card key={event.id}>
                <div className="mb-4 pb-4 border-b">
                  <h2 className="text-2xl font-bold text-gray-900">{event.name}</h2>
                  <div className="flex items-center text-sm text-gray-600 mt-2">
                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    {formatDate(event.startTime, 'PPp')}
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {eventTickets.map((ticket) => (
                    <div
                      key={ticket.id}
                      className="border border-gray-200 rounded-lg p-4 hover:border-blue-500 hover:shadow-md transition-all cursor-pointer"
                      onClick={() => handleViewTicket(ticket.id)}
                    >
                      <div className="flex justify-between items-start mb-3">
                        <div className="flex-1">
                          <h3 className="font-semibold text-gray-900">{ticket.ticketType.name}</h3>
                          <p className="text-2xl font-bold text-blue-600 mt-1">₹{ticket.price}</p>
                        </div>
                        <Badge variant={getStatusVariant(ticket.status)}>
                          {ticket.status}
                        </Badge>
                      </div>

                      <div className="text-sm text-gray-500 space-y-1">
                        <div className="flex items-center">
                          <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                          </svg>
                          Ticket ID: {ticket.id.substring(0, 8)}...
                        </div>
                      </div>

                      <Button
                        variant="outline"
                        size="sm"
                        className="w-full mt-3"
                        onClick={(e) => {
                          e.stopPropagation();
                          handleViewTicket(ticket.id);
                        }}
                      >
                        View Ticket
                      </Button>
                    </div>
                  ))}
                </div>
              </Card>
            ))}
          </div>
        )}
      </main>
    </div>
  );
};

// ============================================================================
// TICKET DETAILS VIEW COMPONENT
// ============================================================================

interface TicketDetailsViewProps {
  ticketId: string;
  onClose: () => void;
}

const TicketDetailsView = ({ ticketId, onClose }: TicketDetailsViewProps) => {
  const [ticketDetails, setTicketDetails] = useState<any>(null);
  const [qrDetails, setQrDetails] = useState<QrCodeDetails | null>(null);
  const [qrImage, setQrImage] = useState<string | null>(null);
  const [isLoadingTicket, setIsLoadingTicket] = useState(true);
  const [isLoadingQr, setIsLoadingQr] = useState(false);
  const [isGeneratingQr, setIsGeneratingQr] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    fetchTicketDetails();
    fetchQrDetails();
  }, [ticketId]);

  const fetchTicketDetails = async () => {
    try {
      setIsLoadingTicket(true);
      const details = await ticketsApi.getTicketDetails(ticketId);
      setTicketDetails(details);
    } catch (err: any) {
      console.error('Failed to fetch ticket details:', err);
      setError(err.message || 'Failed to load ticket details');
    } finally {
      setIsLoadingTicket(false);
    }
  };

  const fetchQrDetails = async () => {
    try {
      setIsLoadingQr(true);
      const qr = await ticketsApi.getQrCodeDetails(ticketId);
      setQrDetails(qr);
    } catch (err: any) {
      console.error('Failed to fetch QR details:', err);
      // Don't set error - QR might not exist yet
    } finally {
      setIsLoadingQr(false);
    }
  };

  const handleGenerateQr = async () => {
    try {
      setIsGeneratingQr(true);
      setError(null);

      // Generate QR image
      const blob = await ticketsApi.generateQrCode(ticketId);
      const imageUrl = URL.createObjectURL(blob);
      setQrImage(imageUrl);

      // Refresh QR details
      await fetchQrDetails();
    } catch (err: any) {
      console.error('Failed to generate QR:', err);
      
      // Parse error messages from backend
      let errorMessage = 'Failed to generate QR code';
      
      if (err.message) {
        const msg = err.message.toLowerCase();
        if (msg.includes('cancelled')) {
          errorMessage = 'Cannot generate QR code - Ticket has been cancelled';
        } else if (msg.includes('used')) {
          errorMessage = 'Cannot generate QR code - Ticket has already been used';
        } else if (msg.includes('expired')) {
          errorMessage = 'Cannot generate QR code - Ticket has expired';
        } else if (msg.includes('invalid')) {
          errorMessage = 'Cannot generate QR code - Ticket is invalid';
        } else {
          errorMessage = err.message;
        }
      }
      
      setError(errorMessage);
    } finally {
      setIsGeneratingQr(false);
    }
  };

  const getStatusVariant = (status: string): 'success' | 'warning' | 'danger' | 'info' | 'default' => {
    switch (status) {
      case 'PURCHASED':
        return 'success';
      case 'USED':
        return 'info';
      case 'CANCELLED':
        return 'danger';
      case 'EXPIRED':
        return 'warning';
      default:
        return 'default';
    }
  };

  const getQrStatusVariant = (status: string): 'success' | 'warning' | 'danger' => {
    switch (status) {
      case 'ACTIVE':
        return 'success';
      case 'EXPIRED':
        return 'warning';
      case 'USED':
        return 'danger';
      default:
        return 'warning';
    }
  };

  if (isLoadingTicket) {
    return (
      <div className="min-h-screen bg-gray-50 flex justify-center items-center">
        <Spinner size="lg" />
      </div>
    );
  }

  if (!ticketDetails) {
    return (
      <div className="min-h-screen bg-gray-50 flex flex-col justify-center items-center">
        <p className="text-red-600 mb-4">Ticket not found</p>
        <Button onClick={onClose}>Back to Tickets</Button>
      </div>
    );
  }

  const canGenerateQr = ticketDetails.status === 'PURCHASED';

  return (
    <div className="min-h-screen bg-gray-50">
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <button
            onClick={onClose}
            className="text-gray-700 hover:text-gray-900 flex items-center"
          >
            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
            Back to Tickets
          </button>
        </div>
      </header>

      <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Card>
          <div className="mb-6">
            <div className="flex justify-between items-start mb-4">
              <div>
                <h1 className="text-3xl font-bold text-gray-900 mb-2">
                  {ticketDetails.ticketType.name}
                </h1>
                <Badge variant={getStatusVariant(ticketDetails.status)}>
                  {ticketDetails.status}
                </Badge>
              </div>
              <div className="text-right">
                <p className="text-3xl font-bold text-blue-600">₹{ticketDetails.price}</p>
              </div>
            </div>

            <div className="border-t pt-4 space-y-3">
              <div>
                <label className="text-sm font-medium text-gray-500">Ticket ID</label>
                <p className="text-gray-900 font-mono">{ticketDetails.id}</p>
              </div>
              <div>
                <label className="text-sm font-medium text-gray-500">Purchased At</label>
                <p className="text-gray-900">{formatDate(ticketDetails.purchasedAt, 'PPp')}</p>
              </div>
            </div>
          </div>

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
              <p className="text-red-800">{error}</p>
            </div>
          )}

          {/* QR Code Section */}
          <div className="border-t pt-6">
            <h2 className="text-xl font-bold mb-4">Entry QR Code</h2>

            {!canGenerateQr ? (
              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                <div className="flex items-start">
                  <svg className="w-6 h-6 text-yellow-600 mr-3 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                  <div>
                    <h3 className="font-semibold text-yellow-900 mb-1">QR Code Not Available</h3>
                    <p className="text-yellow-800 text-sm">
                      {ticketDetails.status === 'CANCELLED' && 'This ticket has been cancelled. QR codes cannot be generated for cancelled tickets.'}
                      {ticketDetails.status === 'USED' && 'This ticket has already been used for entry. QR codes are single-use only.'}
                      {ticketDetails.status === 'EXPIRED' && 'This ticket has expired. QR codes cannot be generated for expired tickets.'}
                      {ticketDetails.status === 'INVALID' && 'This ticket is invalid. QR codes cannot be generated.'}
                    </p>
                  </div>
                </div>
              </div>
            ) : (
              <>
                {/* QR Metadata (Read-only) */}
                {isLoadingQr ? (
                  <div className="flex justify-center py-4">
                    <Spinner />
                  </div>
                ) : qrDetails ? (
                  <div className="bg-gray-50 rounded-lg p-4 mb-4">
                    <div className="flex justify-between items-center">
                      <div>
                        <p className="text-sm font-medium text-gray-500">QR Status</p>
                        <Badge variant={getQrStatusVariant(qrDetails.qrCodeStatus)}>
                          {qrDetails.qrCodeStatus}
                        </Badge>
                      </div>
                      <div>
                        <p className="text-sm font-medium text-gray-500">Public Code</p>
                        <p className="font-mono text-lg font-bold">{qrDetails.publicCode}</p>
                      </div>
                    </div>
                    <p className="text-xs text-gray-500 mt-2">
                      Generated: {formatDate(qrDetails.generatedDateTime, 'PPp')}
                    </p>
                  </div>
                ) : (
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <p className="text-blue-800">No QR code generated yet. Click below to generate.</p>
                  </div>
                )}

                {/* QR Image Display */}
                {qrImage ? (
                  <div className="text-center">
                    <img
                      src={qrImage}
                      alt="Ticket QR Code"
                      className="mx-auto border-4 border-gray-300 rounded-lg"
                      style={{ width: '300px', height: '300px' }}
                    />
                    {qrDetails && (
                      <div className="mt-4 p-4 bg-gray-50 rounded-lg">
                        <p className="text-sm text-gray-600">Manual Entry Code:</p>
                        <p className="text-2xl font-bold font-mono">{qrDetails.publicCode}</p>
                      </div>
                    )}
                  </div>
                ) : (
                  <Button
                    onClick={handleGenerateQr}
                    isLoading={isGeneratingQr}
                    className="w-full"
                    size="lg"
                  >
                    {qrDetails?.qrCodeStatus === 'EXPIRED'
                      ? 'Regenerate QR Code'
                      : 'Generate QR Code'}
                  </Button>
                )}

                <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                  <h3 className="font-semibold text-blue-900 mb-2">How to use:</h3>
                  <ul className="text-sm text-blue-800 space-y-1">
                    <li>• Click "Generate QR Code" when you arrive at the venue</li>
                    <li>• Show the QR code to the entry scanner</li>
                    <li>• Or provide the manual code to venue staff</li>
                    <li>• QR codes are valid for a limited time</li>
                  </ul>
                </div>
              </>
            )}
          </div>
        </Card>
      </main>
    </div>
  );
};
</file>

<file path="pages/public/PublishedEventDetails.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate, Link } from 'react-router-dom';
import { publishedEventsApi, PublishedEventDto } from '@/api/endpoints/publishedEvents';
import { ticketsApi } from '@/api/endpoints/tickets';
import { Button } from '@/components/common/Button';
import { useAuth } from '@/hooks/useAuth';

export const PublishedEventDetails = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { isAuthenticated, login } = useAuth();
  const [event, setEvent] = useState<PublishedEventDto | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [purchasingTicketType, setPurchasingTicketType] = useState<number | null>(null);
  const [purchaseSuccess, setPurchaseSuccess] = useState(false);

  useEffect(() => {
    const fetchEvent = async () => {
      if (!id) return;

      try {
        setIsLoading(true);
        const eventData = await publishedEventsApi.getById(id);
        setEvent(eventData);
      } catch (err: any) {
        console.error('Failed to fetch event:', err);
        setError(err.message || 'Failed to load event');
      } finally {
        setIsLoading(false);
      }
    };

    fetchEvent();
  }, [id]);

  const handlePurchase = async (ticketTypeId: number) => {
    if (!isAuthenticated) {
      // Redirect to login
      login();
      return;
    }

    try {
      setPurchasingTicketType(ticketTypeId);
      setError(null);

      // Purchase ticket
      await ticketsApi.purchaseTicket(ticketTypeId);

      // Show success message
      setPurchaseSuccess(true);

      // Redirect to my tickets after 2 seconds
      setTimeout(() => {
        navigate('/my-tickets');
      }, 2000);
    } catch (err: any) {
      console.error('Failed to purchase ticket:', err);
      setError(err.message || 'Failed to purchase ticket');
    } finally {
      setPurchasingTicketType(null);
    }
  };

  const formatDateTime = (dateString: string) => {
    const date = new Date(dateString);
    const options: Intl.DateTimeFormatOptions = {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    };
    return date.toLocaleDateString('en-US', options);
  };

  const isSalesActive = (event: PublishedEventDto): boolean => {
    const now = new Date();
    const salesStart = event.salesStartDate ? new Date(event.salesStartDate) : null;
    const salesEnd = event.salesEndDate ? new Date(event.salesEndDate) : null;

    if (salesStart && now < salesStart) return false;
    if (salesEnd && now > salesEnd) return false;
    return true;
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex justify-center items-center">
        <div className="animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-red-600"></div>
      </div>
    );
  }

  if (error || !event) {
    return (
      <div className="min-h-screen bg-gray-50 flex flex-col justify-center items-center">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-gray-900 mb-2">Event Not Found</h2>
          <p className="text-gray-500 mb-6">{error || 'The event you are looking for does not exist.'}</p>
          <button
            onClick={() => navigate('/')}
            className="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
          >
            Back to Events
          </button>
        </div>
      </div>
    );
  }

  const salesActive = isSalesActive(event);

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex items-center justify-between">
            <Link to="/" className="text-2xl font-bold text-red-600">EventHub</Link>
            <button
              onClick={() => navigate('/')}
              className="px-4 py-2 text-gray-700 hover:text-gray-900"
            >
              ← Back to Events
            </button>
          </div>
        </div>
      </header>

      {/* Success Message */}
      {purchaseSuccess && (
        <div className="bg-green-50 border-b border-green-200 py-4">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex items-center">
              <svg className="w-6 h-6 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div>
                <p className="text-green-800 font-semibold">Ticket purchased successfully!</p>
                <p className="text-green-600 text-sm">Redirecting to your tickets...</p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Error Message */}
      {error && !purchaseSuccess && (
        <div className="bg-red-50 border-b border-red-200 py-4">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex items-center">
              <svg className="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p className="text-red-800">{error}</p>
            </div>
          </div>
        </div>
      )}

      {/* Event Banner */}
      <div className="bg-gradient-to-r from-purple-600 to-pink-600 h-80 relative">
        <div className="absolute inset-0 bg-black bg-opacity-30"></div>
        <div className="absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-black/80 to-transparent">
          <div className="max-w-7xl mx-auto">
            <h1 className="text-4xl md:text-5xl font-bold text-white mb-2">{event.name}</h1>
            <div className="flex items-center text-white text-lg">
              <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              {event.venue}
            </div>
          </div>
        </div>
      </div>

      {/* Event Details */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Main Content */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
              <h2 className="text-2xl font-bold mb-4">About the Event</h2>
              <p className="text-gray-700 whitespace-pre-wrap">{event.description}</p>
            </div>

            <div className="bg-white rounded-lg shadow-md p-6">
              <h2 className="text-2xl font-bold mb-4">Event Schedule</h2>
              <div className="space-y-4">
                <div className="flex items-start">
                  <svg className="w-6 h-6 text-green-600 mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <div>
                    <h3 className="font-semibold text-gray-900">Event Starts</h3>
                    <p className="text-gray-600">{formatDateTime(event.startTime)}</p>
                  </div>
                </div>
                <div className="flex items-start">
                  <svg className="w-6 h-6 text-red-600 mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <div>
                    <h3 className="font-semibold text-gray-900">Event Ends</h3>
                    <p className="text-gray-600">{formatDateTime(event.endTime)}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Sidebar - Tickets */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-lg shadow-md p-6 sticky top-8">
              <h2 className="text-2xl font-bold mb-4">Tickets</h2>

              {!salesActive && (
                <div className="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                  <p className="text-yellow-800 text-sm font-medium">
                    {event.salesStartDate && new Date() < new Date(event.salesStartDate)
                      ? `Sales start on ${new Date(event.salesStartDate).toLocaleDateString()}`
                      : 'Ticket sales have ended'}
                  </p>
                </div>
              )}

              <div className="space-y-4">
                {event.ticketTypes.map((ticket) => {
                  const isSoldOut = ticket.totalAvailable !== undefined && ticket.totalAvailable <= 0;
                  const isPurchasing = purchasingTicketType === ticket.id;

                  return (
                    <div key={ticket.id} className="border border-gray-200 rounded-lg p-4 hover:border-red-500 transition-colors">
                      <div className="flex justify-between items-start mb-2">
                        <h3 className="font-semibold text-lg">{ticket.name}</h3>
                        <span className="text-2xl font-bold text-red-600">₹{ticket.price}</span>
                      </div>

                      {ticket.totalAvailable !== undefined && (
                        <p className="text-sm text-gray-500 mb-3">
                          {isSoldOut ? (
                            <span className="text-red-600 font-semibold">Sold Out</span>
                          ) : (
                            `${ticket.totalAvailable} tickets available`
                          )}
                        </p>
                      )}

                      <Button
                        onClick={() => handlePurchase(ticket.id)}
                        disabled={!salesActive || isSoldOut || isPurchasing || purchaseSuccess}
                        isLoading={isPurchasing}
                        className="w-full"
                      >
                        {isSoldOut
                          ? 'Sold Out'
                          : !salesActive
                          ? 'Not Available'
                          : isPurchasing
                          ? 'Processing...'
                          : isAuthenticated
                          ? 'Buy Now'
                          : 'Login to Buy'}
                      </Button>
                    </div>
                  );
                })}
              </div>

              {event.salesStartDate && event.salesEndDate && (
                <div className="mt-6 pt-6 border-t">
                  <h3 className="font-semibold text-gray-900 mb-2">Sales Period</h3>
                  <p className="text-sm text-gray-600">
                    From: {new Date(event.salesStartDate).toLocaleDateString()}
                  </p>
                  <p className="text-sm text-gray-600">
                    Until: {new Date(event.salesEndDate).toLocaleDateString()}
                  </p>
                </div>
              )}

              {isAuthenticated && (
                <div className="mt-6 pt-6 border-t">
                  <Link
                    to="/my-tickets"
                    className="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center"
                  >
                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                    </svg>
                    View Your Tickets →
                  </Link>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="pages/shared/NotFound.tsx">
import { Link } from 'react-router-dom';
import { Button } from '@/components/common/Button';

export const NotFound = () => {
  return (
    <div className="flex items-center justify-center min-h-screen bg-gray-50">
      <div className="text-center">
        <h1 className="text-6xl font-bold text-gray-900 mb-4">404</h1>
        <h2 className="text-2xl font-semibold text-gray-700 mb-4">Page Not Found</h2>
        <p className="text-gray-500 mb-6">The page you're looking for doesn't exist.</p>
        <Link to="/">
          <Button>Go to Dashboard</Button>
        </Link>
      </div>
    </div>
  );
};
</file>

<file path="pages/shared/Unauthorized.tsx">
import { Link } from 'react-router-dom';
import { useAuth } from '@/hooks/useAuth';
import { getDefaultRedirectForRole } from '@/utils/roles';

export const Unauthorized = () => {
    const { user, isAuthenticated } = useAuth();
    const redirectPath = getDefaultRedirectForRole(user);

    return (
        <div className="min-h-screen bg-gray-50 flex items-center justify-center px-4">
            <div className="max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center">
                {/* Icon */}
                <div className="mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-6">
                    <svg className="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>

                {/* Title */}
                <h1 className="text-2xl font-bold text-gray-900 mb-2">Access Denied</h1>

                {/* Message */}
                <p className="text-gray-600 mb-6">
                    You are not authorised to access staff validation features.
                </p>

                {/* Details */}
                <div className="bg-gray-50 rounded-lg p-4 mb-6 text-sm text-gray-500">
                    <p>
                        Staff validation is restricted to users with the <strong>STAFF</strong> role.
                    </p>
                    {isAuthenticated && user && (
                        <p className="mt-2">
                            Your current role: <span className="font-medium text-gray-700">{user.roles?.join(', ') || 'Unknown'}</span>
                        </p>
                    )}
                </div>

                {/* Actions */}
                <div className="space-y-3">
                    <Link
                        to={redirectPath}
                        className="block w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
                    >
                        Go to My Dashboard
                    </Link>
                    <Link
                        to="/"
                        className="block w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                    >
                        Browse Events
                    </Link>
                </div>
            </div>
        </div>
    );
};
</file>

<file path="pages/staff/StaffValidation.tsx">
import { useState, useEffect } from 'react';
import { staffValidationApi } from '@/api/endpoints/staff';
import {
    TicketValidationResponse,
    StaffValidationStats,
} from '@/types';
import { Card } from '@/components/common/Card';
import { QRScanner } from '@/components/QRScanner';
import { format } from 'date-fns';
import { useAuth } from '@/context/AuthContext';

export const StaffValidation = () => {
    const { user } = useAuth();
    const [validationResult, setValidationResult] = useState<TicketValidationResponse | null>(null);
    const [error, setError] = useState<string | null>(null);
    // Remove local manual stats since QRScanner handles it internally or we can keep it separate?
    // The prompt said "Update `src/pages/staff/StaffValidation.tsx` to use `QRScanner`".
    // QRScanner now handles the mode switching and validation calls.

    // Stats & History
    const [stats, setStats] = useState<StaffValidationStats | null>(null);
    const [history, setHistory] = useState<TicketValidationResponse[]>([]);

    useEffect(() => {
        fetchStats();
    }, []);

    const fetchStats = async () => {
        try {
            const data = await staffValidationApi.getMyStats();
            setStats(data);
        } catch (err) {
            console.error('Failed to fetch stats', err);
        }
    };

    const handleValidationComplete = (result: TicketValidationResponse) => {
        setValidationResult(result);
        setError(null);
        // Add to history
        setHistory(prev => [result, ...prev].slice(0, 10));
        // Refresh stats
        fetchStats();
    };

    const handleError = (errorMessage: string) => {
        setError(errorMessage);
        setValidationResult(null);
    };



    return (
        <div className="max-w-4xl mx-auto space-y-6 p-4">
            {/* Header & Stats */}
            <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Ticket Validation</h1>
                    <p className="text-gray-600">
                        Event: <span className="font-semibold text-gray-900">
                            {stats ? (stats.eventName || 'Unknown Event') : 'Loading Event...'}
                        </span>
                    </p>
                </div>
                <div className="flex items-center gap-4">
                    <div className="text-right">
                        <p className="text-sm text-gray-500">Staff Member</p>
                        <p className="font-medium text-gray-900">{user?.username || user?.name || 'Staff'}</p>
                    </div>
                    {stats && (
                        <div className="bg-blue-50 px-4 py-2 rounded-lg border border-blue-100">
                            <p className="text-xs text-blue-600 font-semibold uppercase tracking-wider">Validated</p>
                            <p className="text-2xl font-bold text-blue-900">{stats.validatedCount}</p>
                        </div>
                    )}
                </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Left Column: Scanner Component */}
                <div>
                    <QRScanner
                        onValidationComplete={handleValidationComplete}
                        onError={handleError}
                    />
                </div>

                {/* Right Column: Results & History */}
                <div className="space-y-6">
                    {/* Result Card */}
                    {(validationResult || error) && (
                        <Card className={`p-6 border-l-4 ${validationResult?.message === 'Ticket validated successfully' // Or check if success is implied
                            ? 'border-l-green-500 shadow-md'
                            : 'border-l-red-500 shadow-md'
                            }`}>
                            {validationResult ? (
                                <div className="space-y-4">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-bold text-green-700">Valid Ticket</h2>
                                        <span className="p-2 bg-green-100 text-green-700 rounded-full">
                                            <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                        </span>
                                    </div>

                                    <div className="space-y-3">
                                        <div className="p-3 bg-gray-50 rounded-lg">
                                            <p className="text-xs text-gray-500 uppercase">Attendee</p>
                                            <p className="font-bold text-lg text-gray-900">{validationResult.attendeeName}</p>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="p-3 bg-gray-50 rounded-lg">
                                                <p className="text-xs text-gray-500 uppercase">Type</p>
                                                <p className="font-semibold text-gray-900">{validationResult.ticketTypeName}</p>
                                            </div>
                                            <div className="p-3 bg-gray-50 rounded-lg">
                                                <p className="text-xs text-gray-500 uppercase">Time</p>
                                                <p className="font-medium text-gray-900">{format(new Date(), 'h:mm a')}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <p className="text-center text-sm text-green-600 font-medium">
                                        {validationResult.message}
                                    </p>
                                </div>
                            ) : (
                                <div className="space-y-3 text-center py-4">
                                    <div className="mx-auto w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center">
                                        <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </div>
                                    <h2 className="text-lg font-bold text-red-800">Validation Failed</h2>
                                    <p className="text-red-600">{error}</p>
                                </div>
                            )}
                        </Card>
                    )}

                    {/* Recent List */}
                    <Card className="overflow-hidden">
                        <div className="bg-gray-50 px-4 py-3 border-b border-gray-100">
                            <h3 className="font-semibold text-gray-900">Recent Validations</h3>
                        </div>
                        <div className="max-h-[400px] overflow-y-auto divide-y divide-gray-100">
                            {history.length === 0 ? (
                                <p className="text-gray-500 text-center py-8 text-sm">No recent scans</p>
                            ) : (
                                history.map((record, i) => (
                                    <div key={i} className="p-4 hover:bg-gray-50 transition-colors flex justify-between items-center">
                                        <div>
                                            <p className="font-medium text-gray-900">{record.attendeeName}</p>
                                            <p className="text-xs text-gray-500">{record.ticketTypeName}</p>
                                        </div>
                                        <div className="text-right">
                                            <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${record.message === 'Ticket validated successfully'
                                                ? 'bg-green-100 text-green-800'
                                                : 'bg-red-100 text-red-800'
                                                }`}>
                                                {record.message === 'Ticket validated successfully' ? 'Valid' : 'Invalid'}
                                            </span>
                                            <p className="text-xs text-gray-400 mt-1">
                                                {format(new Date(record.validatedAt || new Date()), 'h:mm a')}
                                            </p>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </Card>
                </div>
            </div>
        </div>
    );
};
</file>

<file path="routes/GlobalRouteGuard.tsx">
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '@/hooks/useAuth';
import { isStaff } from '@/utils/roles';

interface GlobalRouteGuardProps {
    children: React.ReactNode;
}

/**
 * Global Route Guard that enforces STAFF isolation.
 * 
 * RULE: If user has STAFF role, they can ONLY access routes starting with /staff
 * All other routes redirect to /staff/validation
 * 
 * This guard should wrap the entire router to catch:
 * - Direct URL entry
 * - Browser back/forward navigation
 * - Any programmatic navigation attempts
 */
export const GlobalRouteGuard = ({ children }: GlobalRouteGuardProps) => {
    const { user, isAuthenticated } = useAuth();
    const location = useLocation();

    // Not authenticated - let individual routes handle this
    if (!isAuthenticated || !user) {
        return <>{children}</>;
    }

    const userIsStaff = isStaff(user);
    const currentPath = location.pathname;

    // 🔒 STAFF ISOLATION RULE:
    // If user has STAFF role, ONLY allow /staff/* routes
    if (userIsStaff) {
        // Allow: /staff/validation, /staff/*, /callback, /unauthorized
        const allowedPaths = ['/staff', '/callback', '/unauthorized'];
        const isAllowed = allowedPaths.some(path => currentPath.startsWith(path));

        if (!isAllowed) {
            console.log(`[GlobalRouteGuard] Staff user blocked from ${currentPath}, redirecting to /staff/validation`);
            return <Navigate to="/staff/validation" replace />;
        }
    }

    return <>{children}</>;
};
</file>

<file path="routes/index.tsx">
import { createBrowserRouter, RouterProvider, Outlet, Navigate, useLocation } from 'react-router-dom';
import { ProtectedRoute } from './ProtectedRoute';
import { RoleProtectedRoute } from './RoleProtectedRoute';
import { StaffProtectedRoute } from './StaffProtectedRoute';
import { PageContainer } from '@/components/layout/PageContainer';
import { StaffLayout } from '@/components/layout/StaffLayout';
import { useAuth } from '@/hooks/useAuth';
import { isStaff } from '@/utils/roles';

// Public Pages
import { BrowseEvents } from '@/pages/public/BrowseEvents';
import { PublishedEventDetails } from '@/pages/public/PublishedEventDetails';
import { MyTickets } from '@/pages/public/MyTickets';

// Auth Pages
import { Callback } from '@/pages/auth/Callback';

// Organiser Pages
import { OrganiserLandingPage } from '@/pages/organiser/OrganiserLandingPage';
import { Dashboard } from '@/pages/organiser/Dashboard';
import { EventList } from '@/pages/organiser/Events/EventList';
import { EventCreate } from '@/pages/organiser/Events/EventCreate';
import { EventEdit } from '@/pages/organiser/Events/EventEdit';
import { EventDetails } from '@/pages/organiser/Events/EventDetails';
import { EventTickets } from '@/pages/organiser/Events/EventTickets';
import { Tickets } from '@/pages/organiser/Tickets';
import { Analytics } from '@/pages/organiser/Analytics';
import { Settings } from '@/pages/organiser/Settings';
import { StaffManagement } from '@/pages/organiser/StaffManagement';
import { EventStaffManagement } from '@/pages/organiser/EventStaffManagement';
import { EventDashboard } from '@/pages/organiser/EventDashboard';

// Staff Pages
import { StaffValidation } from '@/pages/staff/StaffValidation';

// Shared Pages
import { NotFound } from '@/pages/shared/NotFound';
import { Unauthorized } from '@/pages/shared/Unauthorized';

/**
 * Global Route Guard Component
 * Enforces STAFF isolation at the root level
 */
const GlobalRouteGuard = () => {
  const { user, isAuthenticated } = useAuth();
  const location = useLocation();

  // If authenticated and user is STAFF
  if (isAuthenticated && user && isStaff(user)) {
    const currentPath = location.pathname;

    // Allow: /staff/*, /callback, /unauthorized
    const allowedPaths = ['/staff', '/callback', '/unauthorized'];
    const isAllowed = allowedPaths.some(path => currentPath.startsWith(path));

    if (!isAllowed) {
      console.log(`[GlobalRouteGuard] Staff user blocked from ${currentPath}`);
      return <Navigate to="/staff/validation" replace />;
    }
  }

  return <Outlet />;
};

/**
 * Staff Blocker - Prevents staff from accessing non-staff public routes
 */
const BlockStaffFromPublic = ({ children }: { children: React.ReactNode }) => {
  const { user, isAuthenticated } = useAuth();

  if (isAuthenticated && user && isStaff(user)) {
    return <Navigate to="/staff/validation" replace />;
  }

  return <>{children}</>;
};

const router = createBrowserRouter([
  {
    // Root layout with GlobalRouteGuard
    element: <GlobalRouteGuard />,
    children: [
      // ===== AUTH =====
      {
        path: '/callback',
        element: <Callback />,
      },

      // ===== PUBLIC PAGES (blocked for STAFF) =====
      {
        path: '/',
        element: <BlockStaffFromPublic><BrowseEvents /></BlockStaffFromPublic>,
      },
      {
        path: '/published-events/:id',
        element: <BlockStaffFromPublic><PublishedEventDetails /></BlockStaffFromPublic>,
      },

      // ===== UNAUTHORIZED =====
      {
        path: '/unauthorized',
        element: <Unauthorized />,
      },

      // ===== ATTENDEE PAGES (blocked for STAFF) =====
      {
        path: '/my-tickets',
        element: (
          <BlockStaffFromPublic>
            <ProtectedRoute><MyTickets /></ProtectedRoute>
          </BlockStaffFromPublic>
        ),
      },

      // ===== ORGANISER LANDING (blocked for STAFF) =====
      {
        path: '/organiser',
        element: (
          <BlockStaffFromPublic>
            <ProtectedRoute><OrganiserLandingPage /></ProtectedRoute>
          </BlockStaffFromPublic>
        ),
      },

      // ===== ORGANISER-ONLY ROUTES (blocked for STAFF via RoleProtectedRoute) =====
      {
        element: (
          <RoleProtectedRoute allowedRoles={['ROLE_ORGANISER']}>
            <PageContainer />
          </RoleProtectedRoute>
        ),
        children: [
          { path: '/dashboard', element: <Dashboard /> },
          { path: '/events/:eventId/dashboard', element: <EventDashboard /> },
          { path: '/events', element: <EventList /> },
          { path: '/events/create', element: <EventCreate /> },
          { path: '/events/:id', element: <EventDetails /> },
          { path: '/events/:id/edit', element: <EventEdit /> },
          { path: '/events/:id/tickets', element: <EventTickets /> },
          { path: '/tickets', element: <Tickets /> },
          { path: '/analytics', element: <Analytics /> },
          { path: '/settings', element: <Settings /> },
          { path: '/staff', element: <StaffManagement /> },
          { path: '/events/:eventId/staff', element: <EventStaffManagement /> },
        ],
      },

      // ===== STAFF-ONLY ROUTES (ISOLATED EXPERIENCE) =====
      {
        element: (
          <StaffProtectedRoute>
            <StaffLayout />
          </StaffProtectedRoute>
        ),
        children: [
          {
            path: '/staff/validation',
            element: <StaffValidation />,
          },
        ],
      },

      // ===== 404 =====
      {
        path: '*',
        element: <NotFound />,
      },
    ],
  },
]);

export const AppRoutes = () => {
  return <RouterProvider router={router} />;
};
</file>

<file path="routes/ProtectedRoute.tsx">
import { useAuth } from '@/hooks/useAuth';
import { ReactNode, useEffect, useState } from 'react';
import { redirectToKeycloakLogin } from '@/services/keycloakService';

interface ProtectedRouteProps {
  children: ReactNode;
}

export const ProtectedRoute = ({ children }: ProtectedRouteProps) => {
  const { isAuthenticated } = useAuth();
  const [isChecking, setIsChecking] = useState(true);

  useEffect(() => {
    // Give auth context time to initialize
    const timer = setTimeout(() => {
      setIsChecking(false);
      
      // Only redirect if still not authenticated after check
      if (!isAuthenticated) {
        redirectToKeycloakLogin();
      }
    }, 100);

    return () => clearTimeout(timer);
  }, [isAuthenticated]);

  // Show loading while checking authentication
  if (isChecking) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Loading...</p>
        </div>
      </div>
    );
  }

  // If not authenticated after check, show loading while redirecting
  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Redirecting to login...</p>
        </div>
      </div>
    );
  }

  return <>{children}</>;
};
</file>

<file path="routes/RoleProtectedRoute.tsx">
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '@/hooks/useAuth';
import { isStaff, isOrganiser } from '@/utils/roles';

interface RoleProtectedRouteProps {
    children: React.ReactNode;
    allowedRoles: string[];
}

/**
 * Role-based route protection with STAFF PRIORITY RULE:
 * - If user has ROLE_STAFF (even with other roles), they are ONLY allowed on staff routes
 * - ORGANISER routes are blocked for any user with ROLE_STAFF
 */
export const RoleProtectedRoute = ({ children, allowedRoles }: RoleProtectedRouteProps) => {
    const { user, isAuthenticated } = useAuth();
    const location = useLocation();

    // Not authenticated - redirect to login/home
    if (!isAuthenticated || !user) {
        return <Navigate to="/" state={{ from: location }} replace />;
    }

    const userRoles = user.roles || [];
    const userIsStaff = isStaff(user);
    const userIsOrganiser = isOrganiser(user);

    // 🔒 STAFF PRIORITY RULE:
    // If user has ROLE_STAFF (regardless of other roles), they are ONLY allowed on STAFF routes
    // Any attempt to access ORGANISER routes while having STAFF role → redirect to staff validation
    if (userIsStaff) {
        // Staff trying to access organiser-only routes
        if (allowedRoles.includes('ROLE_ORGANISER') && !allowedRoles.includes('ROLE_STAFF')) {
            return <Navigate to="/staff/validation" replace />;
        }
    }

    // Standard role check for the route
    const hasRequiredRole = userRoles.some(role => allowedRoles.includes(role));

    if (!hasRequiredRole) {
        // Determine redirect based on user's role
        if (userIsStaff) {
            return <Navigate to="/staff/validation" replace />;
        } else if (userIsOrganiser) {
            return <Navigate to="/dashboard" replace />;
        } else {
            return <Navigate to="/" replace />;
        }
    }

    return <>{children}</>;
};
</file>

<file path="routes/StaffProtectedRoute.tsx">
import { Navigate } from 'react-router-dom';
import { useAuth } from '@/hooks/useAuth';
import { isStaff } from '@/utils/roles';

interface StaffProtectedRouteProps {
    children: React.ReactNode;
}

/**
 * Route guard that ONLY allows STAFF role.
 * - STAFF → renders children
 * - ORGANISER / ATTENDEE / unauthenticated → redirects to /unauthorized
 */
export const StaffProtectedRoute = ({ children }: StaffProtectedRouteProps) => {
    const { user, isAuthenticated } = useAuth();

    // Not authenticated → redirect to home
    if (!isAuthenticated || !user) {
        return <Navigate to="/" replace />;
    }

    // Not a staff member → redirect to unauthorized
    if (!isStaff(user)) {
        return <Navigate to="/unauthorized" replace />;
    }

    // Staff user → render children
    return <>{children}</>;
};
</file>

<file path="services/keycloakService.ts">
import { keycloakConfig, keycloakEndpoints } from '@/config/keycloak';

// Generate a random state for CSRF protection
const generateState = (): string => {
  return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
};

// Generate PKCE code verifier and challenge
const generateCodeVerifier = (): string => {
  const array = new Uint8Array(32);
  crypto.getRandomValues(array);
  return btoa(String.fromCharCode(...array))
    .replace(/\+/g, '-')
    .replace(/\//g, '_')
    .replace(/=/g, '');
};

const generateCodeChallenge = async (verifier: string): Promise<string> => {
  const encoder = new TextEncoder();
  const data = encoder.encode(verifier);
  const digest = await crypto.subtle.digest('SHA-256', data);
  return btoa(String.fromCharCode(...new Uint8Array(digest)))
    .replace(/\+/g, '-')
    .replace(/\//g, '_')
    .replace(/=/g, '');
};

/**
 * Redirect user to Keycloak login page
 */
export const redirectToKeycloakLogin = async (options?: { prompt?: string }): Promise<void> => {
  const state = generateState();
  const codeVerifier = generateCodeVerifier();

  // 🔥 FIX: Store in localStorage instead of sessionStorage
  localStorage.setItem('kc_state', state);
  localStorage.setItem('kc_code_verifier', codeVerifier);

  // Generate code challenge
  const codeChallenge = await generateCodeChallenge(codeVerifier);

  const searchParamsObj: Record<string, string> = {
    client_id: keycloakConfig.clientId,
    redirect_uri: keycloakConfig.redirectUri,
    response_type: 'code',
    scope: 'openid profile email',
    state: state,
    code_challenge: codeChallenge,
    code_challenge_method: 'S256',
  };

  // Add optional prompt parameter (e.g., 'login')
  if (options?.prompt) {
    searchParamsObj.prompt = options.prompt;
  }

  const params = new URLSearchParams(searchParamsObj);

  console.log('Redirecting to Keycloak with state:', state);
  window.location.href = `${keycloakEndpoints.authorization}?${params.toString()}`;
};

/**
 * Exchange authorization code for access token
 */
export const exchangeCodeForToken = async (code: string, state: string): Promise<string> => {
  console.log('Exchanging code for token, received state:', state);

  // 🔥 FIX: Get from localStorage
  const storedState = localStorage.getItem('kc_state');
  console.log('Stored state:', storedState);

  if (state !== storedState) {
    console.error('State mismatch! Received:', state, 'Expected:', storedState);
    throw new Error('Invalid state parameter - possible CSRF attack');
  }

  const codeVerifier = localStorage.getItem('kc_code_verifier');
  if (!codeVerifier) {
    throw new Error('Code verifier not found');
  }

  // Clean up localStorage
  localStorage.removeItem('kc_state');
  localStorage.removeItem('kc_code_verifier');

  // Exchange code for token
  const params = new URLSearchParams({
    grant_type: 'authorization_code',
    client_id: keycloakConfig.clientId,
    code: code,
    redirect_uri: keycloakConfig.redirectUri,
    code_verifier: codeVerifier,
  });

  console.log('Requesting token from Keycloak...');
  const response = await fetch(keycloakEndpoints.token, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: params.toString(),
  });

  if (!response.ok) {
    const error = await response.json();
    console.error('Token exchange failed:', error);
    throw new Error(error.error_description || 'Failed to exchange code for token');
  }

  const data = await response.json();
  console.log('Token received successfully');
  return data.access_token;
};

/**
 * Get user info from Keycloak
 */
export const getUserInfo = async (accessToken: string): Promise<any> => {
  const response = await fetch(keycloakEndpoints.userInfo, {
    headers: {
      Authorization: `Bearer ${accessToken}`,
    },
  });

  if (!response.ok) {
    throw new Error('Failed to get user info');
  }

  return response.json();
};

/**
 * Logout from Keycloak
 */
export const logoutFromKeycloak = (): void => {
  const params = new URLSearchParams({
    client_id: keycloakConfig.clientId,
    post_logout_redirect_uri: window.location.origin,
  });

  // Clear local storage
  localStorage.removeItem('keycloak_token');
  localStorage.removeItem('keycloak_user');
  localStorage.removeItem('kc_state');
  localStorage.removeItem('kc_code_verifier');

  // Redirect to Keycloak logout
  window.location.href = `${keycloakEndpoints.logout}?${params.toString()}`;
};

/**
 * Login with Keycloak
 */
export const loginWithKeycloak = () => {
  redirectToKeycloakLogin();
};
</file>

<file path="types/analytics.ts">
export interface TicketTypeAnalyticsDto {
    ticketTypeId: number;
    ticketTypeName: string;
    price: number;
    totalAvailable: number;
    ticketsSold: number;
    revenue: number;
    attendeesValidated: number;
    attendanceRate: number;
    remainingTickets: number;
}

export interface EventAnalyticsDto {
    eventId: string;
    eventName: string;
    eventStatus: string;
    eventType: string | null;
    venue: string;
    startTime: string;
    endTime: string;
    totalTicketsSold: number;
    totalRevenue: number;
    totalAttendeesValidated: number;
    overallAttendanceRate: number;
    ticketTypeAnalytics: TicketTypeAnalyticsDto[];
}

export interface OrganiserCompleteAnalyticsDto {
    organiserId: string;
    organiserName: string;
    organiserEmail: string;
    totalEvents: number;
    publishedEvents: number;
    draftEvents: number;
    totalTicketsSold: number;
    totalRevenue: number;
    totalAttendeesValidated: number;
    averageAttendanceRate: number;
    eventAnalytics: EventAnalyticsDto[];
    mostRevenueEvent: EventAnalyticsDto | null;
    mostTicketsSoldEvent: EventAnalyticsDto | null;
    bestAttendanceRateEvent: EventAnalyticsDto | null;
}

export interface AnalyticsSummary {
    organiserId: string;
    organiserName: string;
    totalEvents: number;
    publishedEvents: number;
    draftEvents: number;
    totalTicketsSold: number;
    totalRevenue: number;
    totalAttendeesValidated: number;
    averageAttendanceRate: number;
}

export interface TicketTypePerformanceDto {
    ticketTypeName: string;
    totalSold: number;
    totalRevenue: number;
    totalValidated: number;
    averagePrice: number;
    numberOfEvents: number;
}
</file>

<file path="types/index.ts">
// Add to existing types in types/index.ts:

// Existing types...
export interface User {
  id: string;
  email: string;
  name: string;
  username?: string;
  roles: string[];
}

export interface StaffCredentialItem {
  staffUserId: string;
  username: string;
  password: string;
  email: string;
  validFrom: string;
  validUntil: string;
}

export interface StaffGenerationResponse {
  message: string;
  organiserId: string;
  eventId: string;
  staffCount: number;
  validityHours: number;
  validFrom: string;
  validUntil: string;
  credentials: StaffCredentialItem[];
}

export interface StaffGenerationRequest {
  count: number;
  validityHours: number;
}

export interface StaffMemberDto {
  id: number;
  staffUserId: string;
  username: string;
  email: string;
  isActive: boolean;
  validFrom: string;
  validUntil: string;
  isExpired: boolean;
  createdAt: string;
  lastLogin?: string;
}

export interface PasswordResetResponse {
  newPassword: string;
}

export interface ExtendValidityResponse {
  newValidUntil: string;
}

export interface ApiError {
  message: string;
  status?: number;
  errors?: Record<string, string[]>;
}

export interface PaginatedResponse<T> {
  content: T[];
  totalElements: number;
  totalPages: number;
  page: number;
  size: number;
}

// ADD THESE NEW TYPES:
export interface TicketTypeDto {
  id: number;
  name: string;
  price: number;
  description?: string;
  totalAvailable?: number;
  createdAt?: string;
  updatedAt?: string;
}

export interface EventDto {
  id: string;
  name: string;
  description: string;
  startTime: string;
  endTime: string;
  venue: string;
  salesStartDate?: string;
  salesEndDate?: string;
  eventStatus: 'DRAFT' | 'PUBLISHED' | 'CANCELLED' | 'COMPLETED';
  ticketTypes: TicketTypeDto[];
  createdAt: string;
  updatedAt: string;
}

export interface ListEventDto {
  id: string;
  name: string;
  description: string;
  startTime: string;
  endTime: string;
  venue: string;
  salesStartDate?: string;
  salesEndDate?: string;
  eventStatus: 'DRAFT' | 'PUBLISHED' | 'CANCELLED' | 'COMPLETED';
  ticketTypes: ListEventTicketTypeDto[];
}

export interface ListEventTicketTypeDto {
  id: number;
  name: string;
  price: number;
  totalAvailable?: number;
}

// Staff Validation Types
export interface TicketValidationResponse {
  validationId: string;
  ticketId: string;
  ticketTypeName: string;
  attendeeName: string;
  attendeeEmail: string;
  eventName: string;
  validatedAt: string;
  validatedBy: string;
  message: string;
}

export interface TicketSearchResult {
  ticketId: string;
  qrCode: string; // The publicCode used for validation
  attendeeName: string;
  attendeeEmail: string;
  ticketType: string;
  status: 'PURCHASED' | 'USED' | 'CANCELLED' | 'EXPIRED' | 'INVALID';
  price: number;
}

export interface StaffValidationStats {
  staffUserId: string;
  staffUsername: string;
  validatedCount: number;
  eventName: string;
}

// Organiser Dashboard Types
export interface EventValidationStats {
  eventId: string;
  eventName: string;
  totalTicketsSold: number;
  totalValidated: number;
  remainingAttendees: number;
  totalRevenue: number;
  revenueByTicketType?: {
    ticketTypeId: number;
    ticketTypeName: string;
    ticketsSold: number;
    revenue: number;
    averagePrice: number;
  }[];
}

export interface OrganiserOverview {
  organiserId: string;
  organiserName: string;
  organiserEmail: string;
  totalEvents: number;
  publishedEvents: number;
  draftEvents: number;
  totalTicketsSold: number;
  totalRevenue: number;
  totalAttendees: number;
  averageRevenuePerEvent: number;
  averageTicketsPerEvent: number;
}

export interface TicketTypeAttendance {
  ticketTypeId: number;
  ticketTypeName: string;
  validatedCount: number;
}

export interface ValidationHistory {
  validationId: string;
  ticketId: string;
  ticketTypeName: string;
  attendeeName: string;
  attendeeEmail: string;
  validationMethod: 'QR' | 'MANUAL';
  validationStatus: 'VALID' | 'INVALID' | 'EXPIRED';
  validatedAt: string;
}
</file>

<file path="utils/constants.ts">
// Application constants

// Application constants

export const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/api/v1';

export const ROUTES = {
  DASHBOARD: '/',
  EVENTS: '/events',
  EVENT_CREATE: '/events/create',
  EVENT_EDIT: '/events/:id/edit',
  EVENT_DETAILS: '/events/:id',
  EVENT_TICKETS: '/events/:id/tickets',
  TICKETS: '/tickets',
  ANALYTICS: '/analytics',
  SETTINGS: '/settings',
} as const;
</file>

<file path="utils/formatters.ts">
import { format, isValid } from 'date-fns';

export const formatDate = (date: string | Date, formatStr: string = 'PP'): string => {
  try {
    let dateObj: Date;

    if (typeof date === 'string') {
      // Direct parsing for ISO-8601 strings
      dateObj = new Date(date);
    } else {
      dateObj = date;
    }

    if (!isValid(dateObj) || isNaN(dateObj.getTime())) {
      return 'Invalid date';
    }

    return format(dateObj, formatStr);
  } catch (error) {
    console.error('Date formatting error:', error, date);
    return typeof date === 'string' ? date : 'Invalid date';
  }
};

export const formatCurrency = (amount: number, currency: string = 'USD'): string => {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency,
  }).format(amount);
};

export const formatNumber = (num: number): string => {
  return new Intl.NumberFormat('en-US').format(num);
};
</file>

<file path="utils/jwt.ts">
export const parseJwt = (token: string) => {
  try {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
      window
        .atob(base64)
        .split('')
        .map(function (c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        })
        .join('')
    );

    return JSON.parse(jsonPayload);
  } catch (e) {
    console.error('Failed to parse JWT', e);
    return null;
  }
};
</file>

<file path="utils/roles.ts">
import { User } from '@/types';

// Role Constants
export const ROLES = {
    ORGANISER: 'ROLE_ORGANISER',
    STAFF: 'ROLE_STAFF',
    ATTENDEE: 'ROLE_ATTENDEE',
} as const;

export type RoleType = typeof ROLES[keyof typeof ROLES];

/**
 * Check if user has a specific role
 */
export const hasRole = (user: User | null, role: RoleType): boolean => {
    if (!user || !user.roles) return false;
    return user.roles.includes(role);
};

/**
 * Check if user has STAFF role
 * ⚠️ PRIORITY RULE: If user has STAFF role, they are isolated to staff features ONLY
 */
export const isStaff = (user: User | null): boolean => {
    return hasRole(user, ROLES.STAFF);
};

/**
 * Check if user is an Organiser (and NOT a Staff member)
 * Returns false if user has STAFF role (even if they also have ORGANISER role)
 */
export const isOrganiser = (user: User | null): boolean => {
    return hasRole(user, ROLES.ORGANISER);
};

/**
 * Check if user is a pure Organiser (has ORGANISER but NOT STAFF)
 */
export const isPureOrganiser = (user: User | null): boolean => {
    return hasRole(user, ROLES.ORGANISER) && !hasRole(user, ROLES.STAFF);
};

/**
 * Check if user is an Attendee
 */
export const isAttendee = (user: User | null): boolean => {
    return hasRole(user, ROLES.ATTENDEE);
};

/**
 * Get the effective role of the user
 * STAFF takes absolute priority - if user has STAFF, that's their effective role
 */
export const getEffectiveRole = (user: User | null): RoleType | null => {
    if (!user || !user.roles) return null;

    // STAFF takes priority over everything
    if (isStaff(user)) return ROLES.STAFF;
    if (isOrganiser(user)) return ROLES.ORGANISER;
    if (isAttendee(user)) return ROLES.ATTENDEE;

    return null;
};

/**
 * Get the default redirect path based on user's effective role
 */
export const getDefaultRedirectForRole = (user: User | null): string => {
    const effectiveRole = getEffectiveRole(user);

    switch (effectiveRole) {
        case ROLES.STAFF:
            return '/staff/validation';
        case ROLES.ORGANISER:
            return '/dashboard';
        default:
            return '/';
    }
};
</file>

<file path="utils/validators.ts">
// Validation utilities

export const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

export const validateEmail = (email: string): boolean => {
  return emailRegex.test(email);
};

export const validateRequired = (value: string | number | null | undefined): boolean => {
  if (typeof value === 'string') {
    return value.trim().length > 0;
  }
  return value !== null && value !== undefined;
};

export const validateMinLength = (value: string, min: number): boolean => {
  return value.length >= min;
};

export const validateMaxLength = (value: string, max: number): boolean => {
  return value.length <= max;
};

export const validatePrice = (price: number): boolean => {
  return price >= 0 && price <= 999999.99;
};
</file>

<file path="App.tsx">
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { AuthProvider } from '@/context/AuthContext';
import { ErrorBoundary } from '@/components/feedback/ErrorBoundary';
import { AppRoutes } from '@/routes';

// Create a client for React Query
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false,
      retry: 1,
    },
  },
});

function App() {
  return (
    <ErrorBoundary>
      <QueryClientProvider client={queryClient}>
        <AuthProvider>
          <AppRoutes />
        </AuthProvider>
      </QueryClientProvider>
    </ErrorBoundary>
  );
}

export default App;
</file>

<file path="index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
</file>

<file path="main.tsx">
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
</file>

<file path="vite-env.d.ts">
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_API_BASE_URL: string
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}
</file>

</files>
